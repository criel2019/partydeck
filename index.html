<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover">
<title>파티덱 - P2P 미니게임</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a0a12">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700;900&family=Oswald:wght@500;600;700&family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/games/mafia.css?v=3">
<link rel="stylesheet" href="css/games/truth.css">
<link rel="stylesheet" href="css/games/quickdraw.css">
<link rel="stylesheet" href="css/games/roulette.css">
<link rel="stylesheet" href="css/games/lottery.css">
<link rel="stylesheet" href="css/games/updown.css">
<link rel="stylesheet" href="css/games/yahtzee.css">
<link rel="stylesheet" href="css/games/ecard.css">
<link rel="stylesheet" href="css/games/sutda.css">
<link rel="stylesheet" href="css/games/fortress.css?v=7">
<link rel="stylesheet" href="css/games/bombshot.css">
<link rel="stylesheet" href="css/games/stairs.css">
<link rel="stylesheet" href="css/games/tetris.css">
<link rel="stylesheet" href="css/games/jewel.css">
<link rel="stylesheet" href="css/games/colorchain.css">
<link rel="stylesheet" href="css/games/slinkystairs.css">
<link rel="stylesheet" href="css/games/pupil.css">
<link rel="stylesheet" href="css/games/blackjack.css">
<link rel="stylesheet" href="css/games/tamagotchi.css">
<link rel="stylesheet" href="css/games/idol.css?v=20260301e">
<link rel="stylesheet" href="css/games/drinkpoker.css">
<link rel="stylesheet" href="css/games/kingstagram.css">
<link rel="stylesheet" href="css/games/mobile.css">
</head>
<body>

<div class="toast" id="toast"></div>

<!-- LOADING -->
<div class="screen active" id="loadingScreen">
  <div class="logo-icon">🎲</div>
  <div class="logo-title">파티덱</div>
  <div class="loading-text" id="loadingText">연결 준비 중...</div>
  <div class="loading-bar"><div class="loading-bar-inner" id="loadingBar"></div></div>
</div>

<!-- MAIN MENU -->
<div class="screen" id="mainMenu">
  <div class="logo-area">
    <div class="logo-icon">🎲</div>
    <div class="logo-title">파티덱</div>
    <div class="logo-sub">서버 없이 즐기는 P2P 미니게임</div>
  </div>

  <div class="menu-card">
    <div class="profile-section">
      <div class="avatar" id="myAvatar" onclick="cycleAvatar()">😎</div>
      <div class="profile-info">
        <input class="input-field" id="nameInput" placeholder="닉네임 입력" maxlength="8" style="padding:10px 12px; font-size:15px; font-weight:700;">
        <div class="profile-stats" id="profileStats">전적 로딩 중...</div>
      </div>
    </div>

    <div class="economy-bar">
      <div class="eco-item eco-gold"><span class="eco-icon">🪙</span><span class="eco-value" id="mmGold">0</span></div>
      <div class="eco-item eco-energy"><span class="eco-icon">⚡</span><span class="eco-value" id="mmEnergy">0/10</span><span class="eco-countdown" id="energyCountdown">MAX</span></div>
      <div class="eco-item eco-diamond" onclick="openDiamondShop()" style="cursor:pointer;"><span class="eco-icon">💎</span><span class="eco-value" id="mmDiamond">0</span></div>
    </div>
  </div>

  <button class="btn btn-primary" onclick="createRoom()">🏠 방 만들기</button>

  <div class="join-row">
    <input class="input-field" id="joinCodeInput" placeholder="방 코드 입력" maxlength="6" style="text-transform:uppercase; text-align:center; letter-spacing:4px; font-weight:700; flex:1;">
    <button class="btn btn-accent2 btn-small" onclick="joinRoom()" style="width:auto; padding:14px 20px;">참가</button>
  </div>

  <button class="tama-menu-btn" id="tamaMenuBtn" onclick="tamaQuickAccess()">🥚 내 다마고치 키우기</button>

  <button class="btn btn-accent2" onclick="startPracticeMode()" style="max-width:380px;">🤖 연습 모드 (AI 대전)</button>

  <button class="btn btn-secondary" onclick="shareApp()" style="max-width:380px;">📱 앱 공유 (QR 코드)</button>

  <!-- Debug Preview Toggle -->
  <button class="btn btn-debug-toggle" id="debugToggleBtn" onclick="toggleDebugMode()">🛠 디버그 미리보기</button>
  <div class="debug-game-selector" id="debugGameSelector" style="display:none;">
    <div class="debug-selector-title">게임 선택 (1인 미리보기)</div>
    <div class="debug-game-grid">
      <button class="debug-game-btn" onclick="debugGame('poker')">🃏 홀덤</button>
      <button class="debug-game-btn" onclick="debugGame('mafia')">🕵️ 마피아</button>
      <button class="debug-game-btn" onclick="debugGame('sutda')">🎴 섯다</button>
      <button class="debug-game-btn" onclick="debugGame('quickdraw')">🤠 총잡이</button>
      <button class="debug-game-btn" onclick="debugGame('roulette')">🔫 룰렛</button>
      <button class="debug-game-btn" onclick="debugGame('lottery')">🎰 뽑기</button>
      <button class="debug-game-btn" onclick="debugGame('ecard')">👑 E카드</button>
      <button class="debug-game-btn" onclick="debugGame('yahtzee')">🎲 야추</button>
      <button class="debug-game-btn" onclick="debugGame('updown')">🃏 업다운</button>
      <button class="debug-game-btn" onclick="debugGame('truth')">⭕ 진실게임</button>
      <button class="debug-game-btn" onclick="debugGame('fortress')">🏰 요새</button>
      <button class="debug-game-btn" disabled style="opacity:0.35;pointer-events:none;">🪜 무한계단</button>
      <button class="debug-game-btn" disabled style="opacity:0.35;pointer-events:none;">🧩 테트리스</button>
      <button class="debug-game-btn" onclick="debugGame('jewel')">💎 보석맞추기</button>
      <button class="debug-game-btn" onclick="debugGame('colorchain')">🔗 컬러체인</button>
      <button class="debug-game-btn" onclick="debugGame('slinkystairs')">🌀 슬링키</button>
      <button class="debug-game-btn" onclick="debugGame('pupil')">👁 동공탐지</button>
      <button class="debug-game-btn" onclick="debugGame('blackjack')">🃏 블랙잭</button>
      <button class="debug-game-btn" onclick="debugGame('tamagotchi')">🐉 다마고치</button>
      <button class="debug-game-btn" onclick="debugGame('idol')">🎤 아이돌</button>
      <button class="debug-game-btn" onclick="idolEventScreenShow()">📺 전광판테스트</button>
      <button class="debug-game-btn" onclick="debugGame('drinkpoker')">🍶 술피하기</button>
      <button class="debug-game-btn" onclick="debugGame('kingstagram')">👑 킹스타그램</button>
    </div>
  </div>

  <div class="ad-banner">📢 광고 영역 (AdSense / AdMob)</div>

  <div id="buildFooter" class="build-footer"></div>
</div>

<!-- PRACTICE MODE SELECT -->
<div class="screen" id="practiceSelect">
  <div class="lobby-header">
    <button class="back-btn" onclick="leavePracticeMode()">←</button>
    <div style="font-family:'Black Han Sans'; font-size:20px;">🤖 연습 모드</div>
    <div style="width:40px;"></div>
  </div>
  <div class="practice-content">
    <div class="practice-desc">AI 상대와 연습 플레이</div>
    <div class="practice-game-grid">
      <button class="practice-game-btn" onclick="startPracticeGame('poker')">🃏 포커</button>
      <button class="practice-game-btn" onclick="startPracticeGame('mafia')">🕵️ 마피아</button>
      <button class="practice-game-btn" onclick="startPracticeGame('sutda')">🎴 섯다</button>
      <button class="practice-game-btn" onclick="startPracticeGame('quickdraw')">🤠 총잡이</button>
      <button class="practice-game-btn" onclick="startPracticeGame('roulette')">🔫 룰렛</button>
      <button class="practice-game-btn" onclick="startPracticeGame('lottery')">🎰 뽑기</button>
      <button class="practice-game-btn" onclick="startPracticeGame('ecard')">👑 E카드</button>
      <button class="practice-game-btn" onclick="startPracticeGame('yahtzee')">🎲 야추</button>
      <button class="practice-game-btn" onclick="startPracticeGame('updown')">🃏 업다운</button>
      <button class="practice-game-btn" onclick="startPracticeGame('truth')">⭕ 진실게임</button>
      <button class="practice-game-btn" onclick="startPracticeGame('fortress')">🏰 요새</button>
      <button class="practice-game-btn" onclick="startPracticeGame('bombshot')">🍺 폭탄주</button>
      <button class="practice-game-btn" onclick="startPracticeGame('blackjack')">🃏 블랙잭</button>
      <button class="practice-game-btn" disabled style="opacity:0.35;pointer-events:none;">🪜 무한계단</button>
      <button class="practice-game-btn" disabled style="opacity:0.35;pointer-events:none;">🧩 테트리스</button>
      <button class="practice-game-btn" onclick="startPracticeGame('jewel')">💎 보석맞추기</button>
      <button class="practice-game-btn" onclick="startPracticeGame('colorchain')">🔗 컬러체인</button>
      <button class="practice-game-btn" onclick="startPracticeGame('slinkystairs')">🌀 슬링키</button>
      <button class="practice-game-btn" onclick="startPracticeGame('idol')">🎤 아이돌</button>
      <button class="practice-game-btn" onclick="startPracticeGame('drinkpoker')">🍶 술피하기</button>
      <button class="practice-game-btn" onclick="startPracticeGame('kingstagram')">👑 킹스타그램</button>
    </div>
  </div>
</div>

<!-- LOBBY -->
<div class="screen" id="lobby">
  <div class="lobby-header">
    <button class="back-btn" onclick="leaveLobby()">←</button>
    <div style="font-family:'Black Han Sans'; font-size:20px;">대기실</div>
    <div style="width:40px;"></div>
  </div>

  <div class="lobby-content">
    <div class="lobby-currency-bar">
      <div class="eco-item eco-gold eco-sm"><span class="eco-icon">🪙</span><span class="eco-value" id="lobbyGold">0</span></div>
      <div class="eco-item eco-energy eco-sm"><span class="eco-icon">⚡</span><span class="eco-value" id="lobbyEnergy">0/10</span></div>
    </div>
    <div class="room-code-display">
      <div class="room-code-label">방 코드를 친구에게 공유하세요</div>
      <div class="room-code" id="roomCodeDisplay" onclick="copyRoomCode()">------</div>
      <div class="room-code-hint">탭하여 복사</div>
      <div class="share-btn-row">
        <button class="share-btn" onclick="copyRoomCode()">📋 코드 복사</button>
        <button class="share-btn" onclick="shareLink()">🔗 링크 공유</button>
      </div>
      <div id="qrCodeDisplay" style="margin:8px auto;width:100px;height:100px;"></div>
    </div>

  <div class="players-section">
    <div class="players-title">플레이어 (<span id="playerCount">0</span>/14)</div>
    <div class="player-list" id="playerList"></div>
    <div id="cpuSelectorArea" style="display:none;margin:8px 0;padding:10px 12px;background:rgba(255,255,255,0.05);border-radius:10px;border:1px solid rgba(255,255,255,0.08);">
      <div style="display:flex;align-items:center;justify-content:center;gap:16px;">
        <button class="btn btn-secondary" onclick="removeCPU()" style="width:36px;height:36px;padding:0;font-size:20px;border-radius:50%;min-width:unset;line-height:1;">−</button>
        <span style="font-size:14px;color:var(--text-dim);">🤖 CPU <span id="cpuCount" style="color:var(--accent2);font-weight:700;">0</span>명</span>
        <button class="btn btn-accent2" onclick="addCPU()" style="width:36px;height:36px;padding:0;font-size:20px;border-radius:50%;min-width:unset;line-height:1;">+</button>
      </div>
    </div>
  </div>

  <button class="btn btn-secondary" id="gameCatalogBtn" style="display:none;width:100%;margin-top:8px;" onclick="openGameCatalog()">🎮 게임 목록 보기</button>
  <div id="selectedGameDisplay" style="display:none;text-align:center;margin-top:8px;padding:10px 14px;background:rgba(255,255,255,0.05);border-radius:10px;border:1px solid rgba(255,255,255,0.1);">
    <span id="selectedGameEmoji" style="font-size:20px;"></span>
    <span id="selectedGameName" style="font-size:15px;font-weight:700;color:#fff;margin-left:6px;"></span>
    <span style="font-size:12px;color:#aaa;margin-left:8;" id="selectedGameType"></span>
  </div>

  <!-- Mafia: Host setup button + config display for all players -->
  <div id="mfLobbyArea" style="display:none;">
    <button class="btn mf-lobby-setup-btn" id="mfSetupBtn" style="display:none;" onclick="mfOpenSetup()">🎭 직업 설정</button>
    <div id="mfConfigDisplay" class="mf-config-display" style="display:none;">
      <!-- Populated dynamically by mfShowConfigInLobby() -->
    </div>
  </div>

  <!-- Poker/Sutda: Betting mode setup (host only) -->
  <div id="betModeLobbyArea" style="display:none;">
    <div class="mf-config-display" style="padding:10px 14px;">
      <div style="font-size:13px;font-weight:700;margin-bottom:8px;">💰 배팅 모드</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;" id="betModeOptions">
        <label class="bet-mode-option selected" data-mode="free-1000"><input type="radio" name="betMode" value="free-1000" checked style="display:none;"><span>1,000칩</span></label>
        <label class="bet-mode-option" data-mode="free-5000"><input type="radio" name="betMode" value="free-5000" style="display:none;"><span>5,000칩</span></label>
        <label class="bet-mode-option" data-mode="free-10000"><input type="radio" name="betMode" value="free-10000" style="display:none;"><span>10,000칩</span></label>
        <label class="bet-mode-option" data-mode="free-50000"><input type="radio" name="betMode" value="free-50000" style="display:none;"><span>50,000칩</span></label>
        <label class="bet-mode-option" data-mode="gold"><input type="radio" name="betMode" value="gold" style="display:none;"><span>🪙 골드</span></label>
      </div>
    </div>
  </div>

  <!-- Bombshot: Host penalty setup + config display for all -->
  <div id="bsLobbyArea" style="display:none;">
    <button class="btn mf-lobby-setup-btn" id="bsSetupBtn" style="display:none;" onclick="bsOpenSetup()">🍺 벌칙 설정</button>
    <div id="bsConfigDisplay" class="mf-config-display" style="display:none;"></div>
  </div>

  <div id="waitingMsg" style="text-align:center; color:var(--text-dim); font-size:13px; padding:16px 0;">
    <div class="spinner"></div>
    <div style="margin-top:8px;" id="waitingText">호스트가 게임을 시작하길 대기 중...</div>
  </div>
  <div id="connectionStatus" style="text-align:center; padding:8px; font-size:12px; border-radius:8px; margin-top:4px; display:none;"></div>
  </div>

  <div class="lobby-footer">
    <button class="btn btn-primary" id="startGameBtn" style="display:none;" onclick="startGame()">🎮 게임 시작</button>
  </div>
</div>

<!-- POKER -->
<div class="screen" id="pokerGame">
  <div class="pk-felt"></div>

  <div class="pk-content">
    <!-- Top bar: money info + round + close -->
    <div class="pk-top-bar">
      <div class="pk-top-info">
        <div class="pk-chip-display">
          <span class="pk-chip-icon">🪙</span>
          <span class="pk-chip-value" id="myChipsDisplay">0</span>
        </div>
        <div class="pk-pot-display">
          <span class="pk-pot-label">POT</span>
          <span class="pk-pot-value" id="potAmount">0</span>
        </div>
      </div>
      <span class="pk-round-badge" id="roundDisplay">프리플랍</span>
      <button class="pk-hand-btn" onclick="toggleHandRanking('poker')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">족보</button>
      <button class="pk-close-btn" onclick="leaveGame()">✕</button>
    </div>

    <!-- Opponent area - top left, small -->
    <div class="pk-opponent-area" id="opponentsArea"></div>

    <!-- Community cards - top center -->
    <div class="pk-community" id="communityCards"></div>

    <!-- My cards - LARGE, center -->
    <div class="pk-my-area">
      <div class="pk-card-glow"></div>
      <div class="pk-my-cards" id="myCardsDisplay"></div>
      <div class="pk-hand-name" id="handRankDisplay"></div>
    </div>

    <!-- Bottom: actions / raise -->
    <div class="pk-bottom-panel">
      <div class="pk-actions" id="actionBar">
        <button class="pk-action-btn pk-btn-call" id="checkCallBtn" onclick="pokerAction('check')">체크</button>
        <button class="pk-action-btn pk-btn-raise" onclick="showRaiseSlider()">레이즈</button>
        <button class="pk-action-btn pk-btn-allin" onclick="pokerAction('allin')">올인</button>
        <button class="pk-action-btn pk-btn-fold" onclick="pokerAction('fold')">폴드</button>
      </div>
      <div class="pk-raise-area" id="raiseSliderArea">
        <div class="pk-raise-amount-row">
          <span class="pk-raise-amount" id="raiseAmountDisplay">100</span>
        </div>
        <div class="pk-raise-row">
          <input type="range" class="pk-raise-slider" id="raiseSlider" min="0" max="1000" value="100">
        </div>
        <div class="pk-raise-btns">
          <button class="pk-action-btn pk-btn-raise" onclick="confirmRaise()">레이즈 확인</button>
          <button class="pk-action-btn pk-btn-fold" onclick="cancelRaise()">취소</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MAFIA SETUP OVERLAY -->
<div class="mf-setup-overlay" id="mfSetupOverlay" style="display:none;">
  <div class="mf-setup-modal">
    <div class="mf-setup-header">
      <div class="mf-setup-title">마피아 설정</div>
      <div class="mf-setup-role-counter">
        <span id="mfSetupRoleCount">1</span>
        <span id="mfSetupPlayerCount">/ 4명</span>
      </div>
    </div>
    <div class="mf-setup-scroll" id="mfSetupContent">
      <!-- Role rows rendered dynamically by mfRenderSetup() -->
    </div>
    <div class="mf-setup-footer">
      <button class="mf-setup-btn cancel" onclick="mfCloseSetup()">취소</button>
      <button class="mf-setup-btn confirm" onclick="mfConfirmSetup()">확인</button>
    </div>
  </div>
</div>

<!-- BOMBSHOT SETUP OVERLAY -->
<div class="mf-setup-overlay" id="bsSetupOverlay" style="display:none;">
  <div class="mf-setup-modal" style="max-width:360px;">
    <div class="mf-setup-header">
      <div class="mf-setup-title">🍺 폭탄주 벌칙 설정</div>
      <div class="mf-setup-role-counter" style="font-size:12px;">
        룰렛: 폭탄주 2칸 / 벌칙 2칸 / 세이프 2칸
      </div>
    </div>
    <div class="mf-setup-scroll" style="padding:12px 16px;">
      <div style="margin-bottom:12px;">
        <div style="font-size:13px;font-weight:600;margin-bottom:8px;">🍸 바텐더 선택</div>
        <div style="display:flex;gap:8px;" id="bsBartenderSelect">
          <div class="bs-bartender-option selected" onclick="bsSelectBartender('default')" data-type="default">
            <div style="font-size:28px;">🤵</div>
            <div style="font-size:11px;">기본</div>
          </div>
          <div class="bs-bartender-option" onclick="bsSelectBartender('rabbit')" data-type="rabbit">
            <div style="font-size:28px;">🐰</div>
            <div style="font-size:11px;">토끼</div>
          </div>
        </div>
      </div>
      <div style="font-size:13px;color:var(--text-dim);margin-bottom:10px;">
        벌칙 칸(2칸)에 표시할 벌칙을 1~3개 설정하세요.<br>
        <span style="font-size:11px;opacity:0.7;">2칸에 랜덤 배치됩니다.</span>
      </div>
      <div id="bsPenaltyInputs">
        <div class="bs-penalty-row" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <span style="font-size:13px;min-width:50px;">벌칙 1</span>
          <input type="text" class="bs-penalty-input" id="bsPenalty1" value="원샷" maxlength="8" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid #444;background:#1a1a2e;color:#fff;font-size:14px;">
        </div>
        <div class="bs-penalty-row" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <span style="font-size:13px;min-width:50px;">벌칙 2</span>
          <input type="text" class="bs-penalty-input" id="bsPenalty2" value="" maxlength="8" placeholder="(선택)" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid #444;background:#1a1a2e;color:#fff;font-size:14px;">
        </div>
        <div class="bs-penalty-row" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <span style="font-size:13px;min-width:50px;">벌칙 3</span>
          <input type="text" class="bs-penalty-input" id="bsPenalty3" value="" maxlength="8" placeholder="(선택)" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid #444;background:#1a1a2e;color:#fff;font-size:14px;">
        </div>
      </div>
    </div>
    <div class="mf-setup-footer">
      <button class="mf-setup-btn cancel" onclick="bsCloseSetup()">취소</button>
      <button class="mf-setup-btn confirm" onclick="bsConfirmSetup()">확인</button>
    </div>
  </div>
</div>

<!-- MAFIA FULL VERSION -->
<div class="screen" id="mafiaGame">
  <!-- Top Bar -->
  <div class="mf-topbar">
    <div class="mf-topbar-left">
      <button class="mf-back-btn" onclick="mfLeaveGame()">✕</button>
      <div class="mf-phase-badge day" id="mfPhaseBadge">
        <span id="mfPhaseIcon">☀️</span>
        <span id="mfPhaseText">낮</span>
      </div>
    </div>
    <div class="mf-day-counter" id="mfDayCounter">1일차</div>
    <div class="mf-topbar-right">
      <button class="mf-roles-btn" onclick="mfToggleRolesPanel()">🎭</button>
      <div class="mf-timer-box" id="mfTimerBox">
        <span>⏱</span>
        <span id="mfTimer">180</span>
      </div>
    </div>
  </div>

  <!-- Roles Info Panel (toggle overlay) -->
  <div class="mf-roles-panel" id="mfRolesPanel" style="display:none;">
    <div class="mf-roles-panel-header">
      <span>🎭 이번 게임 직업 구성</span>
      <button class="mf-roles-panel-close" onclick="mfToggleRolesPanel()">✕</button>
    </div>
    <div class="mf-roles-panel-body" id="mfRolesPanelBody">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- Role Banner -->
  <div class="mf-role-banner team-citizen" id="mfRoleBanner">
    <div class="mf-role-emoji" id="mfRoleEmoji">👤</div>
    <div class="mf-role-info">
      <div class="mf-role-name citizen-color" id="mfRoleName">시민</div>
      <div class="mf-role-desc" id="mfRoleDesc">마피아를 찾아 투표하세요</div>
    </div>
  </div>

  <!-- Main Scrollable Content -->
  <div class="mf-content" id="mfContent">
    <!-- Dynamic content injected by JS:
         - Player grid
         - Night action panel
         - Chat panel (mafia/spy)
         - Vote status panel
         - Events list
         - Spectator mode
         - Lover reveal
         etc.
    -->
  </div>

  <!-- Bottom Action Area -->
  <div class="mf-action-area" id="mfActionArea">
    <div class="mf-message-box" id="mfMessageBox"></div>
    <div class="mf-btn-row" id="mfBtnRow">
      <!-- Buttons injected dynamically -->
    </div>
  </div>

  <!-- Result Overlay (hidden by default) -->
  <div class="mf-result-overlay" id="mfResultOverlay" style="display:none;">
    <div class="mf-result-title" id="mfResultTitle"></div>
    <div class="mf-result-subtitle" id="mfResultSubtitle"></div>
    <div class="mf-result-roles" id="mfResultRoles"></div>
    <button class="mf-result-close-btn" onclick="mfCloseResult()">로비로 돌아가기</button>
  </div>
</div>

<!-- TRUTH GAME -->
<div class="screen" id="truthGame">
  <!-- 상단 바 -->
  <div class="truth-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="truth-round-display">
      <span class="truth-round-badge" id="truthRoundBadge">ROUND 1</span>
    </div>
    <div class="truth-questioner-display" id="truthQuestionerDisplay">질문자: ---</div>
    <button onclick="toggleHandRanking('truth')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">규칙</button>
  </div>

  <!-- 메인 콘텐츠 영역 -->
  <div class="truth-content">

    <!-- Phase: question (질문자 입력) -->
    <div class="truth-phase-area" id="truthQuestionInputArea" style="display:none;">
      <div class="truth-your-turn-badge">✨ 당신의 차례입니다</div>
      <div class="truth-question-box">
        <textarea
          class="truth-textarea"
          id="truthQuestionInput"
          placeholder="질문을 입력하세요...&#10;예: 여기서 OO를 이성적으로 좋아하는 사람이 있다?"
          maxlength="200"
          rows="3"
        ></textarea>
        <div class="truth-char-count"><span id="truthCharCount">0</span>/200</div>
      </div>
      <button class="btn btn-primary truth-submit-btn" onclick="submitTruthQuestion()">
        📨 질문 제출
      </button>
    </div>

    <!-- Phase: question (대기 화면 - 질문자가 아닌 경우) -->
    <div class="truth-phase-area" id="truthWaitQuestionArea" style="display:none;">
      <div class="truth-waiting-icon">🤔</div>
      <div class="truth-waiting-text" id="truthWaitingText">질문을 기다리는 중...</div>
      <div class="truth-waiting-sub" id="truthWaitingSubText">질문자가 질문을 작성하고 있습니다</div>
      <div class="truth-dots-loader">
        <span></span><span></span><span></span>
      </div>
    </div>

    <!-- Phase: voting (질문 표시 + O/X 투표) -->
    <div class="truth-phase-area" id="truthVotingArea" style="display:none;">
      <div class="truth-question-display">
        <div class="truth-question-label">Q.</div>
        <div class="truth-question-text" id="truthQuestionText">질문 내용</div>
      </div>

      <!-- 투표 버튼 영역 -->
      <div class="truth-vote-buttons" id="truthVoteButtons">
        <button class="truth-vote-btn truth-vote-o" id="truthBtnO" onclick="castTruthVote('O')">
          <span class="truth-vote-symbol">O</span>
          <span class="truth-vote-label">예</span>
        </button>
        <button class="truth-vote-btn truth-vote-x" id="truthBtnX" onclick="castTruthVote('X')">
          <span class="truth-vote-symbol">✕</span>
          <span class="truth-vote-label">아니오</span>
        </button>
      </div>

      <!-- 투표 완료 후 대기 -->
      <div class="truth-vote-waiting" id="truthVoteWaiting" style="display:none;">
        <div class="truth-voted-badge" id="truthVotedBadge">✅ 투표 완료</div>
        <div class="truth-vote-progress">
          <div class="truth-progress-bar">
            <div class="truth-progress-fill" id="truthProgressFill" style="width:0%"></div>
          </div>
          <div class="truth-progress-text" id="truthProgressText">투표 중... (0/0명 완료)</div>
        </div>
      </div>
    </div>

    <!-- Phase: result (결과 표시) -->
    <div class="truth-phase-area" id="truthResultArea" style="display:none;">
      <div class="truth-question-display truth-question-display-small">
        <div class="truth-question-label">Q.</div>
        <div class="truth-question-text" id="truthResultQuestionText">질문 내용</div>
      </div>

      <div class="truth-result-container">
        <div class="truth-result-title">투표 결과</div>

        <!-- O 결과 -->
        <div class="truth-result-row">
          <div class="truth-result-icon truth-result-icon-o">O</div>
          <div class="truth-result-info">
            <div class="truth-result-count" id="truthResultOCount">0명</div>
            <div class="truth-result-dots" id="truthResultODots"></div>
          </div>
        </div>

        <!-- X 결과 -->
        <div class="truth-result-row">
          <div class="truth-result-icon truth-result-icon-x">✕</div>
          <div class="truth-result-info">
            <div class="truth-result-count" id="truthResultXCount">0명</div>
            <div class="truth-result-dots" id="truthResultXDots"></div>
          </div>
        </div>

        <!-- 총원 -->
        <div class="truth-result-total" id="truthResultTotal">총 0명 참여</div>
      </div>

      <!-- 다음 질문 버튼 (질문자 또는 호스트) -->
      <button class="btn btn-accent2 truth-next-btn" id="truthNextBtn" onclick="truthNextRound()" style="display:none;">
        ➡️ 다음 질문
      </button>
      <div class="truth-next-waiting" id="truthNextWaiting" style="display:none;">
        다음 질문을 기다리는 중...
      </div>
    </div>

  </div>

  <!-- 하단 플레이어 표시 -->
  <div class="truth-players-bar" id="truthPlayersBar"></div>
</div>

<!-- QUICK DRAW GAME -->
<div class="screen" id="quickDrawGame">
  <div class="qd-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="qd-title">🤠 서부 총잡이</div>
    <div class="qd-round">라운드 <span id="qdRoundNum">1</span></div>
  </div>

  <div class="qd-main-area">
    <div style="font-size:11px;color:#666;text-align:center;margin-bottom:4px;">총을 들고 기다리세요... 소리에 반응!</div>
    <div class="qd-tap-zone" id="qdTapZone" onclick="qdTap()">
      <div class="qd-status-text" id="qdStatusText">준비...</div>
      <div class="qd-reaction-time" id="qdReactionTime"></div>
    </div>
  </div>

  <div class="qd-rankings">
    <div class="qd-rankings-title">순위</div>
    <div class="qd-rankings-list" id="qdRankingsList"></div>
  </div>

  <button class="btn btn-primary qd-restart-btn" id="qdRestartBtn" style="display:none;" onclick="restartQuickDraw()">다시 하기</button>
</div>

<!-- RUSSIAN ROULETTE -->
<div class="screen" id="rouletteGame">
  <div class="roulette-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="roulette-title">🔫 러시안 룰렛</div>
    <div class="roulette-survivors">
      <span id="rouletteSurvivors">6</span>/<span id="rouletteTotalPlayers">6</span>
    </div>
  </div>

  <!-- 게임 시작 전 설정 (호스트만) -->
  <div class="roulette-setup" id="rouletteSetup" style="display:none;">
    <div class="setup-card">
      <div class="setup-label">총알 개수</div>
      <div class="setup-slider-row">
        <input type="range" class="setup-slider" id="bulletsSlider" min="1" max="3" value="1">
        <div class="setup-value" id="bulletsValue">1</div>
      </div>
    </div>
    <div class="setup-card">
      <div class="setup-label">실린더 칸 수</div>
      <div class="setup-slider-row">
        <input type="range" class="setup-slider" id="chambersSlider" min="6" max="8" value="6">
        <div class="setup-value" id="chambersValue">6</div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="confirmRouletteSetup()" style="margin-top:12px;">설정 완료 및 시작</button>
  </div>

  <!-- 실린더 시각화 (총 그립 느낌) -->
  <div class="cylinder-area" style="position:relative;">
    <div class="current-turn-display" id="currentTurnDisplay">
      <span id="currentTurnName">플레이어</span>의 차례
    </div>

    <!-- 총 실루엣 배경 -->
    <div style="position:relative;display:flex;flex-direction:column;align-items:center;">
      <div style="font-size:11px;color:#666;margin-bottom:4px;letter-spacing:1px;">세로로 잡고 조준하세요</div>
      <div class="cylinder-container" style="position:relative;">
        <div class="cylinder" id="cylinder">
          <!-- 동적 생성: 6~8개 칸 -->
        </div>
        <div class="cylinder-center">🎯</div>
      </div>
    </div>

    <div class="cylinder-info" id="cylinderInfo">
      실린더를 돌려주세요
    </div>
  </div>

  <!-- 생존자 리스트 -->
  <div class="survivors-list" id="survivorsList">
    <!-- 동적 생성 -->
  </div>

  <!-- 액션 버튼 (총 스타일) -->
  <div class="roulette-actions" id="rouletteActions">
    <button class="btn btn-secondary" id="spinBtn" onclick="spinCylinder()" style="display:none;font-size:18px;padding:16px 32px;">
      🔄 실린더 돌리기
    </button>
    <button class="btn btn-danger rr-trigger-btn" id="triggerBtn" onclick="pullTrigger()" style="display:none;font-size:22px;padding:20px 40px;border-radius:50%;width:100px;height:100px;box-shadow:0 0 30px rgba(255,0,0,0.4);animation:rr-pulse 1.5s ease-in-out infinite alternate;">
      🔫<br><span style="font-size:12px;">발사</span>
    </button>
    <button class="btn btn-primary" id="restartBtn" onclick="restartRoulette()" style="display:none;">
      🔁 다시 하기
    </button>
  </div>
</div>

<!-- 결과 플래시 오버레이 -->
<div class="roulette-flash" id="rouletteFlash">
  <div class="flash-content" id="flashContent">
    <div class="flash-icon" id="flashIcon">💥</div>
    <div class="flash-text" id="flashText">탕!</div>
  </div>
</div>

<!-- LOTTERY & ROULETTE GAME -->
<div class="screen" id="lotteryGame">
  <!-- Top Bar -->
  <div class="lottery-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="lottery-title">🎰 뽑기 & 룰렛</div>
    <div style="width:40px;"></div>
  </div>

  <!-- Mode Tabs -->
  <div class="mode-tabs">
    <div class="mode-tab active" data-mode="lottery" onclick="switchLotteryMode('lottery')">
      📋 종이뽑기
    </div>
    <div class="mode-tab" data-mode="roulette" onclick="switchLotteryMode('roulette')">
      🎡 룰렛
    </div>
  </div>

  <!-- LOTTERY MODE -->
  <div class="lottery-mode-container" id="lotteryModeContainer">
    <!-- Setup Panel (Host Only) -->
    <div class="lottery-setup-panel" id="lotterySetupPanel" style="display:none;">
      <div class="setup-title">🎯 뽑기 항목 설정 (호스트만 가능)</div>
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:4px;">항목명 입력 + 개수 설정</div>
      <div class="lottery-fields-container" id="lotteryFieldsContainer">
        <div class="lottery-field-row"><span class="lottery-field-num">1</span><input type="text" class="lottery-field-input" maxlength="20" placeholder="예: 당첨!"><input type="number" class="lottery-field-count" min="1" max="99" value="1" placeholder="개수"><button class="lottery-field-del" onclick="removeLotteryField(this)">✕</button></div>
        <div class="lottery-field-row"><span class="lottery-field-num">2</span><input type="text" class="lottery-field-input" maxlength="20" placeholder="예: 꽝"><input type="number" class="lottery-field-count" min="1" max="99" value="3" placeholder="개수"><button class="lottery-field-del" onclick="removeLotteryField(this)">✕</button></div>
        <div class="lottery-field-row"><span class="lottery-field-num">3</span><input type="text" class="lottery-field-input" maxlength="20" placeholder="예: 벌칙"><input type="number" class="lottery-field-count" min="1" max="99" value="1" placeholder="개수"><button class="lottery-field-del" onclick="removeLotteryField(this)">✕</button></div>
      </div>
      <button class="btn btn-secondary" onclick="addLotteryField('lotteryFieldsContainer')" style="font-size:13px;padding:8px 14px;margin-bottom:8px;">+ 항목 추가</button>
      <div class="setup-row">
        <label style="color:var(--text);font-size:14px;font-weight:700;">칸 개수:</label>
        <select class="grid-size-select" id="gridSizeSelect">
          <option value="4">4x4 (16칸)</option>
          <option value="5">5x5 (25칸)</option>
          <option value="6">6x6 (36칸)</option>
          <option value="8">8x8 (64칸)</option>
          <option value="10" selected>10x10 (100칸)</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="startLotteryGame()">🎮 뽑기 시작</button>
    </div>

    <!-- Lottery Grid -->
    <div class="lottery-grid-container" id="lotteryGridContainer" style="display:none;">
      <div class="lottery-status">
        <div class="status-text">🎯 칸을 터치하여 뽑기!</div>
        <div class="picked-count">뽑은 개수: <span id="pickedCount">0</span> / <span id="totalCount">100</span></div>
      </div>
      <div class="lottery-grid" id="lotteryGrid"></div>
    </div>

    <!-- My Result Display -->
    <div class="my-result-panel" id="myLotteryResult" style="display:none;">
      <div class="result-label">🎁 내가 뽑은 결과</div>
      <div class="result-list" id="myResultList"></div>
    </div>
  </div>

  <!-- ROULETTE MODE -->
  <div class="roulette-mode-container" id="rouletteModeContainer" style="display:none;">
    <!-- Setup Panel (Host Only) -->
    <div class="roulette-setup-panel" id="rouletteSetupPanel" style="display:none;">
      <div class="setup-title">🎡 룰렛 항목 설정 (호스트만 가능)</div>
      <div class="lottery-fields-container" id="rouletteFieldsContainer">
        <div class="lottery-field-row"><span class="lottery-field-num">1</span><input type="text" class="lottery-field-input" maxlength="20" placeholder="예: 당첨!"><button class="lottery-field-del" onclick="removeLotteryField(this)">✕</button></div>
        <div class="lottery-field-row"><span class="lottery-field-num">2</span><input type="text" class="lottery-field-input" maxlength="20" placeholder="예: 벌칙"><button class="lottery-field-del" onclick="removeLotteryField(this)">✕</button></div>
      </div>
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:4px;">2~12개 항목</div>
      <button class="btn btn-secondary" onclick="addLotteryField('rouletteFieldsContainer')" style="font-size:13px;padding:8px 14px;margin-bottom:8px;">+ 항목 추가</button>
      <button class="btn btn-primary" onclick="startRouletteGame()">🎡 룰렛 시작</button>
    </div>

    <!-- Roulette Display -->
    <div class="roulette-display-container" id="rouletteDisplayContainer" style="display:none;">
      <div class="roulette-status">
        <div class="status-text">🎰 돌리기 버튼을 눌러주세요!</div>
      </div>

      <div class="roulette-wheel-container">
        <div class="roulette-pointer">▼</div>
        <div class="roulette-wheel" id="rouletteWheel">
          <canvas id="rouletteCanvas" width="300" height="300"></canvas>
        </div>
      </div>

      <button class="btn btn-primary roulette-spin-btn" id="rouletteSpinBtn" onclick="spinRoulette()">
        🎡 돌리기!
      </button>

      <!-- Result Display -->
      <div class="roulette-result-display" id="rouletteResultDisplay" style="display:none;">
        <div class="result-emoji">🎉</div>
        <div class="result-text" id="rouletteResultText">당첨!</div>
      </div>
    </div>
  </div>
</div>

<!-- ========================================= -->
<!-- UP DOWN GAME -->
<!-- ========================================= -->
<div class="screen" id="updownGame">
  <div class="ud-felt"></div>

  <div class="ud-content">
    <!-- Top bar: compact -->
    <div class="ud-top-bar">
      <div class="ud-turn-name" id="updownTurnName">플레이어</div>
      <div class="ud-deck-count" id="updownDeckCount">남은 카드: 52</div>
      <button onclick="toggleHandRanking('updown')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">규칙</button>
      <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    </div>

    <!-- Cards area: previous (small) + current (hero) -->
    <div class="ud-cards-area">
      <div class="ud-prev-slot" id="updownPrevCard">
        <div class="ud-card-label">이전</div>
        <div class="ud-prev-placeholder"></div>
      </div>

      <div class="ud-hero-slot" id="updownCurrentCard">
        <div class="ud-card-label">현재 카드</div>
        <div class="ud-hero-card ud-card-back">
          <div class="ud-hero-inner">
            <div class="ud-hero-back-pattern"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Result text -->
    <div class="ud-result" id="updownResult"></div>

    <!-- Bottom panel: buttons + bet + penalty -->
    <div class="ud-bottom-panel">
      <div id="updownChoiceButtons" class="ud-action-area"></div>

      <div class="ud-bet-area">
        <input type="text" class="ud-bet-input" id="updownBetInput" placeholder="벌칙 내용 입력..." maxlength="30">
        <button class="ud-btn-bet" onclick="udAddBet()">+Bet</button>
      </div>

      <div class="ud-penalty-list" id="updownPenaltyList">
        <div class="ud-penalty-header">벌칙 목록</div>
        <div id="updownPenaltyItems"></div>
      </div>
    </div>
  </div>

  <!-- Special Card Areas -->
  <div class="ud-special-area ud-special-jq" id="updownSpecialJQ" style="display:none;">
    <div class="ud-special-title">흑기사 요청</div>
    <div class="ud-special-desc">다른 플레이어에게 벌칙을 대신 받을 것을 요청할 수 있습니다. 거절하면 나머지 모두가 벌칙!</div>
    <div class="ud-player-select" id="updownJQPlayerSelect"></div>
    <button class="ud-btn-special" onclick="udBlackKnight()">흑기사 요청</button>
  </div>

  <div class="ud-special-area ud-special-k" id="updownSpecialK" style="display:none;">
    <div class="ud-special-title">왕의 명령</div>
    <div class="ud-special-desc">3명에게 벌칙을 내릴 수 있습니다!</div>
    <div class="ud-player-select" id="updownKPlayerSelect"></div>
    <button class="ud-btn-special ud-btn-king" onclick="udKingPenalty()">왕 벌칙 부여</button>
  </div>

  <!-- Penalty Modal -->
  <div class="ud-penalty-modal" id="updownPenaltyModal">
    <div class="ud-penalty-content">
      <div class="ud-penalty-title">벌칙!</div>
      <div class="ud-penalty-text" id="updownPenaltyText">소주 1잔</div>
      <div class="ud-penalty-who" id="updownPenaltyWho">플레이어님의 차례</div>
      <button class="ud-btn-accept" onclick="udAcceptPenalty()">수행하기</button>
      <button class="ud-btn-reject" onclick="udRejectPenalty()">거절 (술 마시기)</button>
    </div>
  </div>

  <!-- Black Knight Request Modal -->
  <div class="ud-penalty-modal" id="updownBKModal">
    <div class="ud-penalty-content">
      <div class="ud-penalty-title">흑기사 요청</div>
      <div class="ud-penalty-text" id="updownBKText">벌칙 내용</div>
      <div class="ud-penalty-who" id="updownBKWho">누가 요청했습니다</div>
      <button class="ud-btn-accept" onclick="udAcceptBK()">수락 (대신 받기)</button>
      <button class="ud-btn-reject" onclick="udRejectBK()">거절 (나머지 모두 벌칙)</button>
    </div>
  </div>
</div>

<!-- ============================== -->
<!-- YAHTZEE GAME -->
<!-- ============================== -->
<div class="screen" id="yahtzeeGame">
  <div class="yahtzee-header">
    <div class="yah-header-left">
      <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
      <button class="yah-help-btn" onclick="showYahHelp()">?</button>
    </div>
    <div class="yahtzee-turn-info">
      <div class="yahtzee-turn-text" id="yahTurnText">턴 1/13</div>
      <div class="yahtzee-current-player" id="yahCurrentPlayer">플레이어 차례</div>
    </div>
    <div class="yahtzee-rolls-left" id="yahRollsLeft">3 left</div>
  </div>

  <div class="yahtzee-players-bar" id="yahtzeePlayersBar">
  </div>

  <div class="yahtzee-dice-area">
    <!-- Three.js 3D viewport (left) -->
    <div id="yahtzeeThreeContainer">
      <canvas id="yahtzeeCanvas"></canvas>
      <div class="yahtzee-combo-label" id="yahtzeeComboLabel"></div>
    </div>

    <!-- Controls panel (right side) -->
    <div class="yahtzee-controls-panel">
      <div class="yahtzee-controls-title">DICE</div>
      <div class="yahtzee-hold-bar" id="yahtzeeHoldBar">
        <!-- Dynamically populated: clickable held-die elements -->
      </div>
      <div class="yahtzee-roll-hint">탭하여 선택/해제</div>
      <div class="yahtzee-rolls-indicator" id="yahtzeeRollsIndicator">
        <span class="roll-pip active"></span>
        <span class="roll-pip active"></span>
        <span class="roll-pip active"></span>
      </div>
      <button class="btn btn-primary yahtzee-roll-btn" id="yahtzeeRollBtn" onclick="yahRoll()">주사위 굴리기</button>
    </div>
  </div>

  <div class="yahtzee-scorecard-area">
    <div class="yahtzee-scorecard-title">점수표</div>
    <div class="yahtzee-scorecard" id="yahtzeeScorecard">
      <!-- Dynamically generated by renderYahtzeeScorecard() -->
    </div>
    <button class="btn yahtzee-score-btn" id="yahtzeeScoreBtn" onclick="yahScore()" style="display:none;">점수 확정</button>
  </div>

  <!-- Rulebook Modal -->
  <div class="yahtzee-help-overlay" id="yahtzeeHelpOverlay" style="display:none;" onclick="hideYahHelp(event)">
    <div class="yahtzee-help-modal">
      <button class="yahtzee-help-close" onclick="hideYahHelp()">&#10005;</button>
      <div class="yahtzee-help-title">📖 요트다이스 룰북</div>

      <div class="yahtzee-help-intro">
        주사위 5개를 최대 <strong>3번</strong> 굴려 족보를 완성하세요.<br>
        매 턴 점수표의 빈 칸 하나를 반드시 선택해야 합니다.
      </div>

      <div class="yahtzee-help-section">
        <div class="yahtzee-help-section-title">상단 — 숫자 합산</div>
        <table class="yahtzee-help-table">
          <tr><td>Ones</td><td>1이 나온 주사위의 합</td><td>최대 5점</td></tr>
          <tr><td>Twos</td><td>2가 나온 주사위의 합</td><td>최대 10점</td></tr>
          <tr><td>Threes</td><td>3이 나온 주사위의 합</td><td>최대 15점</td></tr>
          <tr><td>Fours</td><td>4가 나온 주사위의 합</td><td>최대 20점</td></tr>
          <tr><td>Fives</td><td>5가 나온 주사위의 합</td><td>최대 25점</td></tr>
          <tr><td>Sixes</td><td>6이 나온 주사위의 합</td><td>최대 30점</td></tr>
        </table>
        <div class="yahtzee-help-bonus">
          🎁 <strong>보너스:</strong> 상단 합계가 63점 이상이면 <strong>+35점</strong>
          <span class="yahtzee-help-bonus-hint">（각 숫자를 3개씩 굴리면 달성 가능）</span>
        </div>
      </div>

      <div class="yahtzee-help-section">
        <div class="yahtzee-help-section-title">하단 — 조합</div>
        <table class="yahtzee-help-table">
          <tr>
            <td>Four of a Kind</td>
            <td>같은 눈이 4개 이상</td>
            <td>4개의 합</td>
          </tr>
          <tr>
            <td>Full House</td>
            <td>3개 + 2개 같은 눈 조합</td>
            <td>5개 전체 합</td>
          </tr>
          <tr>
            <td>Small Straight</td>
            <td>1·2·3·4·5 연속</td>
            <td>30점</td>
          </tr>
          <tr>
            <td>Large Straight</td>
            <td>2·3·4·5·6 연속</td>
            <td>30점</td>
          </tr>
          <tr>
            <td>Yahtzee!</td>
            <td>5개 모두 같은 눈</td>
            <td>50점</td>
          </tr>
          <tr>
            <td>Chance</td>
            <td>아무 조합</td>
            <td>5개 전체 합</td>
          </tr>
        </table>
      </div>

      <div class="yahtzee-help-tip">
        💡 <strong>전략 팁:</strong> 0점 처리가 필요할 땐 Chance를 아끼지 말고, Yahtzee는 보너스 전에 상단을 먼저 노리세요.
      </div>
    </div>
  </div>

  <div class="yahtzee-game-over" id="yahtzeeGameOver" style="display:none;">
    <div class="yahtzee-final-scores">
      <div class="yahtzee-final-title">게임 종료!</div>
      <div class="yahtzee-rankings" id="yahtzeeRankings">
      </div>
    </div>
    <button class="btn btn-primary" onclick="restartCurrentGame()" style="max-width:280px;">🔄 다시하기</button>
    <button class="btn" onclick="closeYahtzeeGame()" style="max-width:280px;margin-top:8px;opacity:0.7;">대기실로</button>
  </div>
</div>


<!-- ===== E CARD GAME ===== -->
<div class="screen" id="ecardGame">
  <!-- Compact Header: combines top bar + score + role + opponent -->
  <div class="ecard-compact-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <button onclick="toggleHandRanking('ecard')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">규칙</button>
    <div class="ecard-header-round">G<span id="ecardRound">1</span>/12</div>
    <div class="ecard-header-score">
      <span class="ecard-hscore-emperor">&#128081;</span>
      <span class="ecard-hscore-val" id="ecardScoreEmperor">0</span>
      <span class="ecard-hscore-div">:</span>
      <span class="ecard-hscore-val" id="ecardScoreSlave">0</span>
      <span class="ecard-hscore-slave">&#9939;&#65039;</span>
    </div>
    <div class="ecard-header-role" id="ecardRoleBadge">
      <span id="ecardRoleIcon">&#128081;</span>
      <span id="ecardRoleName">황제</span>
    </div>
    <div class="ecard-header-opp">
      <div class="opponent-avatar" id="ecardOppAvatar" style="background: linear-gradient(135deg, #00e5ff, #00b8d4);">&#128526;</div>
      <span class="opponent-name" id="ecardOppName">상대</span>
      <span class="opponent-cards-count"><span id="ecardOppCardsCount">5</span>장</span>
      <div class="opponent-played-card" id="ecardOppPlayedCard"></div>
    </div>
  </div>

  <!-- Result / Status Text -->
  <div class="ecard-result-text" id="ecardResultText"></div>

  <!-- My Cards Area - takes most of the screen -->
  <div class="ecard-my-cards-area">
    <div class="my-cards-label">내 카드 (<span id="ecardMyCardsCount">5</span>장)</div>
    <div class="ecard-cards-hand" id="ecardMyCards"></div>
  </div>

  <!-- Battle Overlay (absolute positioned) -->
  <div class="ecard-battle-overlay" id="ecardBattleArea" style="display:none;">
    <div class="ecard-battle-inner">
      <div class="battle-card" id="ecardBattleOpp"></div>
      <div class="battle-vs">VS</div>
      <div class="battle-card" id="ecardBattleMy"></div>
    </div>
  </div>

  <!-- Betting Area -->
  <div class="ecard-bet-area" id="ecardBetArea" style="display:none;">
    <div class="bet-label">배팅 금액 제안</div>
    <div class="bet-controls">
      <input type="range" class="bet-slider" id="ecardBetSlider" min="10" max="500" value="100" step="10">
      <div class="bet-amount" id="ecardBetAmount">100</div>
    </div>
    <button class="btn btn-primary" id="ecardBetSubmit" onclick="ecardSubmitBet()">배팅 제안</button>
  </div>

  <!-- Bet Response -->
  <div class="ecard-bet-response" id="ecardBetResponse" style="display:none;">
    <div class="bet-proposal">상대방이 <span id="ecardBetProposed">100</span> 배팅을 제안했습니다</div>
    <div class="bet-buttons">
      <button class="btn btn-secondary" onclick="ecardRejectBet()">거절</button>
      <button class="btn btn-primary" onclick="ecardAcceptBet()">수락</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="ecard-action-buttons" id="ecardActionButtons">
    <button class="btn btn-primary" id="ecardSubmitBtn" onclick="ecardSubmitCard()" disabled>카드 제출</button>
  </div>

  <!-- Waiting -->
  <div class="ecard-waiting" id="ecardWaiting" style="display:none;">
    <div class="spinner"></div>
    <div style="margin-top:8px;font-size:14px;color:var(--text-dim);" id="ecardWaitingText">상대방을 기다리는 중...</div>
  </div>
</div>

<!-- SUTDA GAME -->
<div class="screen" id="sutdaGame">
  <div class="sutda-felt"></div>
  <div class="sutda-content">
    <!-- 상단 바 (포커 스타일) -->
    <div class="sutda-top-bar">
      <div class="sutda-top-info">
        <div class="sutda-chip-display">
          <span class="sutda-chip-icon">🪙</span>
          <span class="sutda-chip-value" id="sutdaMyBalance">0</span>
        </div>
        <div class="sutda-pot-display">
          <span class="sutda-pot-label">POT</span>
          <span class="sutda-pot-value" id="sutdaPotBadge">0</span>
        </div>
      </div>
      <span class="sutda-round-badge" id="sutdaRoundBadge">섯다</span>
      <button onclick="toggleHandRanking('sutda')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">족보</button>
      <button class="back-btn" onclick="leaveGame()">&#10005;</button>
    </div>

    <!-- 상대방 영역 (포커 스타일 컴팩트) -->
    <div class="sutda-opponents" id="sutdaOpponents"></div>

    <!-- 중앙: 판돈 + 내 카드 -->
    <div class="sutda-center-area">
      <div class="sutda-pot-glow"></div>
      <div class="sutda-pot-center">
        <div class="sutda-pot-label">판돈</div>
        <div class="sutda-pot-amount" id="sutdaPotAmount">0</div>
      </div>
      <div class="sutda-turn-indicator" id="sutdaTurnIndicator"></div>
    </div>

    <!-- 내 패 영역 (포커 히어로카드 스타일) -->
    <div class="sutda-my-area">
      <div class="sutda-my-cards" id="sutdaMyCards"></div>
      <div class="sutda-my-rank" id="sutdaMyRank"></div>
    </div>

    <!-- 배팅 버튼 (포커 스타일) -->
    <div class="sutda-action-bar" id="sutdaActionBar">
      <button class="sutda-bet-btn sutda-bet-10k" onclick="sutdaBet('raise',10000)" id="sutdaBtn10k">+1만</button>
      <button class="sutda-bet-btn sutda-bet-50k" onclick="sutdaBet('raise',50000)" id="sutdaBtn50k">+5만</button>
      <button class="sutda-bet-btn sutda-bet-100k" onclick="sutdaBet('raise',100000)" id="sutdaBtn100k">+10만</button>
      <button class="sutda-bet-btn sutda-bet-call" onclick="sutdaBet('call',0)" id="sutdaBtnCall">콜</button>
      <button class="sutda-bet-btn sutda-bet-die" onclick="sutdaBet('die',0)" id="sutdaBtnDie">다이</button>
      <button class="sutda-bet-btn sutda-bet-allin" onclick="sutdaBet('allin',0)" id="sutdaBtnAllin">올인</button>
    </div>
  </div>

  <!-- 세륙 선택 패널 -->
  <div class="sutda-seryuk-panel" id="sutdaSeryukPanel" style="display:none;">
    <div class="sutda-seryuk-title">세륙 (6+4) 선택</div>
    <div class="sutda-seryuk-desc">밀기: 10끗으로 계산 | 깽판: 패 재분배</div>
    <div class="sutda-seryuk-buttons">
      <button class="sutda-seryuk-btn sutda-seryuk-push" onclick="sutdaSeryukChoice('push')">
        <span class="sutda-seryuk-icon">💪</span>
        <span>밀기</span>
        <span class="sutda-seryuk-sub">10끗</span>
      </button>
      <button class="sutda-seryuk-btn sutda-seryuk-chaos" onclick="sutdaSeryukChoice('chaos')">
        <span class="sutda-seryuk-icon">🌀</span>
        <span>깽판</span>
        <span class="sutda-seryuk-sub">패 재분배</span>
      </button>
    </div>
  </div>

  <!-- 결과 오버레이 -->
  <div class="sutda-result-overlay" id="sutdaResultOverlay">
    <div class="sutda-result-box">
      <div class="sutda-result-title" id="sutdaResultTitle">승리!</div>
      <div class="sutda-result-winner" id="sutdaResultWinner"></div>
      <div class="sutda-result-rank" id="sutdaResultRank"></div>
      <div class="sutda-result-cards" id="sutdaResultCards"></div>
      <div class="sutda-result-pot" id="sutdaResultPot"></div>
      <div class="sutda-result-all-hands" id="sutdaResultAllHands"></div>
      <div style="display:flex;gap:8px;margin-top:16px;width:100%;max-width:280px;">
        <button class="btn btn-primary" onclick="closeSutdaResult()" style="flex:1;">다음 라운드</button>
        <button class="btn btn-secondary" onclick="closeSutdaResultToLobby()" style="flex:1;font-size:13px;">로비로</button>
      </div>
    </div>
  </div>
</div>


<!-- FORTRESS GAME -->
<div class="screen" id="fortressGame">
  <div class="fort-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <div class="fort-header-info">
      <span class="fort-round-badge" id="fortRoundBadge">ROUND 1</span>
      <span class="fort-turn-name" id="fortTurnName">플레이어의 차례</span>
    </div>
    <div class="fort-wind-badge" id="fortWindBadge">
      <span id="fortWindArrow">→</span>
      <span id="fortWindValue">0</span>
    </div>
  </div>
  <div class="fort-players-bar" id="fortPlayersBar"></div>
  <div class="fort-canvas-container">
    <canvas id="fortressCanvas" width="800" height="500"></canvas>
  </div>
  <div class="fort-controls" id="fortControls">
    <div class="fort-ctrl-grp">
      <button class="fort-ctrl-btn" id="fortMoveLeft" ontouchstart="fortStartMove(-1)" ontouchend="fortStopMove()" onmousedown="fortStartMove(-1)" onmouseup="fortStopMove()" onmouseleave="fortStopMove()">◀</button>
      <div class="fort-fuel-mini"><div class="fort-fuel-fill" id="fortFuelFill" style="width:100%"></div></div>
      <button class="fort-ctrl-btn" id="fortMoveRight" ontouchstart="fortStartMove(1)" ontouchend="fortStopMove()" onmousedown="fortStartMove(1)" onmouseup="fortStopMove()" onmouseleave="fortStopMove()">▶</button>
    </div>
    <div class="fort-ctrl-sep"></div>
    <div class="fort-ctrl-grp">
      <button class="fort-ctrl-btn" ontouchstart="fortAngleStart(-1)" ontouchend="fortAngleStop()" onmousedown="fortAngleStart(-1)" onmouseup="fortAngleStop()" onmouseleave="fortAngleStop()">‹</button>
      <div class="fort-val"><span class="fort-val-lbl">각도</span><span id="fortAngleValue" class="fort-val-num">45</span></div>
      <button class="fort-ctrl-btn" ontouchstart="fortAngleStart(1)" ontouchend="fortAngleStop()" onmousedown="fortAngleStart(1)" onmouseup="fortAngleStop()" onmouseleave="fortAngleStop()">›</button>
    </div>
    <div class="fort-ctrl-grp">
      <button class="fort-ctrl-btn" ontouchstart="fortPowerStart(-1)" ontouchend="fortPowerStop()" onmousedown="fortPowerStart(-1)" onmouseup="fortPowerStop()" onmouseleave="fortPowerStop()">‹</button>
      <div class="fort-val"><span class="fort-val-lbl">파워</span><span id="fortPowerValue" class="fort-val-num">50</span></div>
      <button class="fort-ctrl-btn" ontouchstart="fortPowerStart(1)" ontouchend="fortPowerStop()" onmousedown="fortPowerStart(1)" onmouseup="fortPowerStop()" onmouseleave="fortPowerStop()">›</button>
    </div>
    <div id="fortChargeGauge" style="display:none;position:relative;width:100%;height:24px;background:rgba(0,0,0,0.6);border-radius:12px;overflow:hidden;margin-bottom:6px;border:2px solid rgba(255,255,255,0.2);">
      <div class="fort-charge-fill" style="height:100%;width:0%;border-radius:10px;transition:width 0.04s linear;"></div>
      <span class="fort-charge-label" style="position:absolute;width:100%;text-align:center;font-size:13px;font-weight:800;color:#fff;line-height:24px;top:0;left:0;text-shadow:0 1px 3px rgba(0,0,0,0.8);"></span>
    </div>
    <button class="fort-fire-btn" id="fortFireBtn"
      ontouchstart="fortFireChargeStart(event)" ontouchend="fortFireChargeEnd(event)" ontouchcancel="fortFireChargeEnd(event)"
      onmousedown="fortFireChargeStart(event)" onmouseup="fortFireChargeEnd(event)" onmouseleave="fortFireChargeEnd(event)">꾹 눌러 발사</button>
  </div>
  <div class="fort-gameover" id="fortGameOver" style="display:none;">
    <div class="fort-gameover-box">
      <div class="fort-gameover-title" id="fortGameOverTitle">게임 종료!</div>
      <div class="fort-rankings" id="fortRankings"></div>
      <button class="btn btn-primary" onclick="restartCurrentGame()" style="max-width:280px;">🔄 다시하기</button>
      <button class="btn" onclick="closeFortressGame()" style="max-width:280px;margin-top:8px;opacity:0.7;">대기실로</button>
    </div>
  </div>
</div>

<!-- BOMB SHOT BLUFF -->
<div class="screen" id="bombshotGame">
  <div class="bs-top-bar">
    <button class="back-btn" onclick="closeBombShotGame()">←</button>
    <div class="bs-drink-badge beer" id="bsDrinkBadge">
      <span class="bs-drink-icon" id="bsDrinkIcon">🍺</span>
      <span id="bsDrinkName">지정: 맥주</span>
    </div>
    <div class="bs-glass-info">🥃 <span id="bsGlassCount">누적: 0장</span></div>
    <button onclick="toggleHandRanking('bombshot')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">규칙</button>
  </div>

  <div class="bs-opponents" id="bsOpponents"></div>

  <div class="bs-last-submit" id="bsLastSubmit" style="display:none;"></div>

  <div class="bs-my-turn-banner" id="bsMyTurnBanner"></div>

  <div class="bs-canvas-wrap">
    <canvas id="bsCanvas"></canvas>
  </div>

  <div class="bs-roulette-status-wrap" id="bsRouletteStatus" style="display:none;"></div>

  <div class="bs-joker-guide">
    <span class="bs-joker-icon">💧</span>
    <span>탄산수 = 조커 (어떤 술로든 사용 가능)</span>
  </div>

  <div class="bs-hand-area">
    <div class="bs-hand" id="bsMyHand"></div>
  </div>

  <div id="bsMyRoulette" style="text-align:center;padding:2px 0;"></div>

  <div class="bs-status" id="bsStatus"></div>

  <div class="bs-action-bar">
    <button class="bs-btn bs-btn-submit" id="bsSubmitBtn" onclick="bsSubmitCards()" disabled>
      카드 제출 (<span id="bsSelectedCount">0</span>장)
    </button>
    <button class="bs-btn bs-btn-liar" id="bsLiarBtn" onclick="bsCallLiar()" disabled>
      🚨 라이어!
    </button>
  </div>

  <div class="bs-reveal" id="bsReveal" style="display:none;">
    <div class="bs-reveal-box">
      <div class="bs-reveal-title" id="bsRevealTitle">카드 공개!</div>
      <div class="bs-reveal-cards" id="bsRevealCards"></div>
      <div class="bs-reveal-result" id="bsRevealResult"></div>
    </div>
  </div>

  <div class="bs-gameover" id="bsGameOver" style="display:none;">
    <div class="bs-gameover-box">
      <div class="bs-gameover-title" id="bsGameOverTitle">게임 종료!</div>
      <div class="bs-rankings" id="bsRankings"></div>
      <button class="btn btn-primary" onclick="restartCurrentGame()" style="max-width:280px;">🔄 다시하기</button>
      <button class="btn" onclick="closeBombShotGame()" style="max-width:280px;margin-top:8px;opacity:0.7;">대기실로</button>
    </div>
  </div>
</div>

<!-- INFINITE STAIRS -->
<div class="screen" id="stairsGame">
  <!-- HUD -->
  <div class="st-hud">
    <div class="st-score-box">
      <div class="st-score-label">SCORE</div>
      <div class="st-score-value" id="stScore">0</div>
    </div>
    <div class="st-hud-right">
      <button class="back-btn" style="font-size:16px;padding:4px;" onclick="leaveGame()">&#10005;</button>
      <div class="st-combo" id="stCombo">🔥 x1.5</div>
      <div class="st-step-display" id="stStep">0층</div>
    </div>
  </div>

  <!-- Stamina Bar -->
  <div class="st-stamina-wrap">
    <div class="st-stamina-outer">
      <div class="st-stamina-fill" id="stStaminaFill"></div>
    </div>
    <div class="st-stamina-info">
      <span>STAMINA</span>
      <span id="stStaminaText">100%</span>
    </div>
  </div>

  <!-- Players bar (multiplayer) -->
  <div class="st-players-bar" id="stPlayersBar"></div>

  <!-- Game Canvas -->
  <div class="st-canvas-wrap">
    <canvas id="stCanvas"></canvas>
    <div class="st-vignette" id="stVignette"></div>
  </div>

  <!-- Countdown Overlay -->
  <div class="st-countdown-overlay" id="stCountdownOverlay" style="display:none;">
    <div class="st-countdown-num" id="stCountdownNum">3</div>
  </div>

  <!-- Death Overlay -->
  <div class="st-death-overlay" id="stDeathOverlay" style="display:none;">
    <div class="st-death-title">GAME OVER</div>
    <div class="st-death-reason" id="stDeathReason">추락!</div>
    <div class="st-death-score-box">
      <div class="st-death-score" id="stDeathScore">0</div>
      <div class="st-death-score-label">FINAL SCORE</div>
    </div>
    <div class="st-death-stats">
      <div class="st-death-stat"><div class="st-death-stat-val" id="stDeathStep">0층</div><div class="st-death-stat-label">STEP</div></div>
      <div class="st-death-stat"><div class="st-death-stat-val" id="stDeathBest">0</div><div class="st-death-stat-label">BEST</div></div>
      <div class="st-death-stat"><div class="st-death-stat-val" id="stDeathCombo">x0</div><div class="st-death-stat-label">MAX COMBO</div></div>
    </div>
    <div class="st-death-waiting" id="stDeathWaiting" style="display:none;">다른 플레이어를 기다리는 중...</div>
  </div>

  <!-- Results Overlay -->
  <div class="st-results-overlay" id="stResultsOverlay" style="display:none;">
    <div class="st-results-title">🏆 결과</div>
    <div class="st-results-list" id="stResultsList"></div>
    <button class="btn btn-primary st-results-btn" onclick="restartCurrentGame()">🔄 다시하기</button>
    <button class="btn st-results-btn" onclick="closeStairsGame()" style="margin-top:8px;opacity:0.7;">대기실로</button>
  </div>

  <!-- Controls -->
  <div class="st-controls" id="stControls" style="display:none;">
    <button class="st-btn st-btn-left" onclick="stTapLeft()">
      <span class="st-btn-arrow">←</span> 왼쪽
      <span class="st-btn-sub">LEFT / X</span>
    </button>
    <button class="st-btn st-btn-right" onclick="stTapRight()">
      오른쪽 <span class="st-btn-arrow">→</span>
      <span class="st-btn-sub">RIGHT / Z</span>
    </button>
  </div>
</div>

<!-- JEWEL MATCH (보석맞추기) -->
<div class="screen" id="jewelGame">
  <!-- Title / Mode Select Overlay -->
  <div class="jwl-title-overlay" style="display:flex;">
    <div class="jwl-title-name">보석<br>맞추기</div>
    <div class="jwl-title-sub">JEWEL MATCH</div>
    <div class="jwl-title-gems">
      <div class="jwl-title-gem jwl-gem-0" style="animation-delay:0s;">💎</div>
      <div class="jwl-title-gem jwl-gem-1" style="animation-delay:.3s;">💎</div>
      <div class="jwl-title-gem jwl-gem-2" style="animation-delay:.6s;">💎</div>
      <div class="jwl-title-gem jwl-gem-3" style="animation-delay:.9s;">💎</div>
      <div class="jwl-title-gem jwl-gem-4" style="animation-delay:1.2s;">💎</div>
    </div>
    <button class="jwl-title-btn jwl-title-btn-primary" onclick="jwlStartMode('classic')">CLASSIC</button>
    <button class="jwl-title-btn jwl-title-btn-secondary" onclick="jwlStartMode('moves')">MOVES (30)</button>
    <button class="jwl-title-btn jwl-title-btn-secondary" onclick="jwlStartMode('timed')">TIMED (2:00)</button>
    <button class="jwl-title-btn jwl-title-btn-secondary" onclick="jwlStartMode('zen')">ZEN ∞</button>
  </div>

  <!-- HUD -->
  <div class="jwl-hud">
    <div class="jwl-hud-left">
      <div class="jwl-score-label">SCORE</div>
      <div class="jwl-score-value" id="jwlScoreValue">0</div>
    </div>
    <div class="jwl-hud-center">
      <div class="jwl-combo-badge" id="jwlComboBadge">⛓️ x1</div>
    </div>
    <div class="jwl-hud-right">
      <button class="jwl-pause-btn" onclick="jwlPause()">⏸</button>
    </div>
  </div>

  <!-- Level Progress -->
  <div class="jwl-progress-bar">
    <div class="jwl-progress-labels">
      <span id="jwlLevelLabel">LEVEL 1</span>
      <span id="jwlProgressPct">0%</span>
    </div>
    <div class="jwl-progress-track">
      <div class="jwl-progress-fill" id="jwlProgressFill"></div>
    </div>
  </div>

  <!-- Mode Info -->
  <div class="jwl-mode-info" id="jwlModeInfo">
    <span class="jwl-mode-badge jwl-mode-classic">CLASSIC</span>
  </div>

  <!-- Timer Bar (Timed mode) -->
  <div class="jwl-timer-bar" id="jwlTimerBar" style="display:none;">
    <div class="jwl-timer-labels"><span>TIME</span><span id="jwlTimerText">2:00</span></div>
    <div class="jwl-timer-track">
      <div class="jwl-timer-fill" id="jwlTimerFill"></div>
    </div>
  </div>

  <!-- 8x8 Grid -->
  <div class="jwl-grid-area">
    <!-- Gem Jar -->
    <div class="jwl-jar-wrap" id="jwlJarWrap" style="display:none;">
      <div class="jwl-jar">
        <div class="jwl-jar-fill" id="jwlJarFill"></div>
        <div class="jwl-jar-gems" id="jwlJarGems"></div>
      </div>
      <div class="jwl-jar-label" id="jwlJarLabel">0</div>
    </div>
    <div class="jwl-grid-container">
      <div class="jwl-grid" id="jwlGrid"></div>
    </div>
  </div>

  <!-- Bottom -->
  <div class="jwl-bottom">
    <div class="jwl-hint-btn" onclick="jwlManualHint()">💡 HINT</div>
  </div>

  <!-- Game Over Overlay -->
  <div class="jwl-gameover-overlay">
    <div class="jwl-go-title">WELL DONE!</div>
    <div class="jwl-go-sub">레벨 1 · CLASSIC</div>
    <div class="jwl-go-new-best">⭐ NEW BEST! ⭐</div>
    <div class="jwl-go-score-box">
      <div class="jwl-go-score">0</div>
      <div class="jwl-go-score-label">FINAL SCORE</div>
    </div>
    <div class="jwl-go-stats">
      <div class="jwl-go-stat"><div class="jwl-go-stat-val">🏆 0</div><div class="jwl-go-stat-label">BEST</div></div>
      <div class="jwl-go-stat"><div class="jwl-go-stat-val">⛓️ x0</div><div class="jwl-go-stat-label">MAX COMBO</div></div>
      <div class="jwl-go-stat"><div class="jwl-go-stat-val">💎 0</div><div class="jwl-go-stat-label">GEMS</div></div>
    </div>
    <button class="jwl-go-btn jwl-go-btn-retry" onclick="jwlRetry()">🔄 RETRY</button>
    <button class="jwl-go-btn jwl-go-btn-home" onclick="jwlHome()">🏠 HOME</button>
  </div>

  <!-- Pause Overlay -->
  <div class="jwl-pause-overlay">
    <div class="jwl-pause-title">⏸ PAUSED</div>
    <button class="jwl-pause-btn jwl-pause-resume" onclick="jwlResume()">▶ RESUME</button>
    <button class="jwl-pause-btn jwl-pause-quit" onclick="jwlQuit()">🏠 QUIT</button>
  </div>
</div>

<!-- TETRIS -->
<div class="screen" id="tetrisGame">
  <!-- HUD -->
  <div class="tet-hud">
    <div class="tet-hud-item">
      <div class="tet-hud-label">SCORE</div>
      <div class="tet-hud-value" id="tetScoreValue">0</div>
    </div>
    <div class="tet-hud-item">
      <span class="tet-mode-badge" id="tetModeBadge">MARATHON</span>
    </div>
    <div class="tet-hud-item">
      <div class="tet-hud-label">LEVEL</div>
      <div class="tet-hud-value" id="tetLevelValue">1</div>
    </div>
    <button class="tet-hud-close" onclick="tetPause()">⏸</button>
  </div>

  <!-- Players bar (multiplayer) -->
  <div class="tet-players-bar" id="tetPlayersBar"></div>

  <!-- Play area -->
  <div class="tet-play-area">
    <!-- Hold side -->
    <div class="tet-side">
      <div class="tet-side-box">
        <div class="tet-side-label">HOLD</div>
        <canvas class="tet-side-canvas" id="tetHoldCanvas" width="48" height="32"></canvas>
      </div>
      <div class="tet-side-info">
        LINES
        <span class="tet-side-info-val" id="tetLinesValue">0</span>
      </div>
      <div class="tet-side-info">
        TIME
        <span class="tet-side-info-val" id="tetTimerValue">0:00.00</span>
      </div>
      <div class="tet-timer-bar" id="tetTimerBar" style="display:none;">
        <div class="tet-timer-bar-track">
          <div class="tet-timer-bar-fill" id="tetTimerFill"></div>
        </div>
      </div>
    </div>

    <!-- Board -->
    <div class="tet-board-wrap">
      <canvas class="tet-board-canvas" id="tetCanvas"></canvas>
    </div>

    <!-- Next side -->
    <div class="tet-side">
      <div class="tet-side-box">
        <div class="tet-side-label">NEXT</div>
        <canvas class="tet-side-canvas" id="tetNextCanvas0" width="48" height="32"></canvas>
      </div>
      <div class="tet-side-box">
        <canvas class="tet-side-canvas" id="tetNextCanvas1" width="48" height="32"></canvas>
      </div>
      <div class="tet-side-box">
        <canvas class="tet-side-canvas" id="tetNextCanvas2" width="48" height="32"></canvas>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="tet-controls">
    <div class="tet-dpad">
      <div class="tet-dpad-empty"></div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('down');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchDown()">&#9660;</div>
      <div class="tet-dpad-empty"></div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('left');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchLeft()">&#9664;</div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('down');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchDown()">&#9660;</div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('right');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchRight()">&#9654;</div>
    </div>
    <div class="tet-action-btns">
      <div class="tet-act tet-act-hold" onclick="tetTouchHold()">HOLD</div>
      <div class="tet-act tet-act-rotate" onclick="tetTouchRotate()">&#8635;</div>
      <div class="tet-act tet-act-drop" onclick="tetTouchHardDrop()">&#11015;</div>
    </div>
  </div>

  <!-- Mode Select Overlay -->
  <div class="tet-mode-overlay" id="tetModeOverlay" style="display:flex;">
    <div class="tet-mode-title">TETRIS</div>
    <div class="tet-mode-sub">BLOCK PUZZLE</div>
    <div class="tet-mode-list">
      <button class="tet-mode-btn tet-mode-primary" onclick="tetSelectMode('marathon')">&#127956;&#65039; MARATHON</button>
      <button class="tet-mode-btn tet-mode-sec" onclick="tetSelectMode('sprint')">&#9889; SPRINT (40L)</button>
      <button class="tet-mode-btn tet-mode-sec" onclick="tetSelectMode('ultra')">&#9201;&#65039; ULTRA (2:00)</button>
      <button class="tet-mode-btn tet-mode-sec" onclick="tetSelectMode('endless')">&#8734; ENDLESS</button>
    </div>
    <button class="tet-mode-back" onclick="tetGoHome()">&#8592; 나가기</button>
  </div>

  <!-- Countdown Overlay -->
  <div class="tet-countdown" id="tetCountdown" style="display:none;">
    <div class="tet-countdown-num" id="tetCountdownNum">3</div>
  </div>

  <!-- Pause Overlay -->
  <div class="tet-pause" id="tetPause" style="display:none;">
    <div class="tet-pause-title">PAUSED</div>
    <button class="tet-pause-btn tet-pause-resume" onclick="tetResume()">&#9654;&#65039; 계속하기</button>
    <button class="tet-pause-btn tet-pause-quit" onclick="tetGoHome()">&#127968; 나가기</button>
  </div>

  <!-- Game Over Overlay -->
  <div class="tet-gameover" id="tetGameOver" style="display:none;">
    <div class="tet-go-title" id="tetGoTitle">GAME OVER</div>
    <div class="tet-go-subtitle" id="tetGoSubtitle">레벨 5에서 종료</div>
    <div class="tet-go-score-box">
      <div class="tet-go-score" id="tetGoScore">0</div>
      <div class="tet-go-score-label">FINAL SCORE</div>
    </div>
    <div class="tet-go-stats">
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoLevel">Lv.1</div><div class="tet-go-stat-label">LEVEL</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoLines">0</div><div class="tet-go-stat-label">LINES</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoCombo">x0</div><div class="tet-go-stat-label">MAX COMBO</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoTetris">0</div><div class="tet-go-stat-label">TETRIS</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoTime">0:00</div><div class="tet-go-stat-label">TIME</div></div>
    </div>
    <div class="tet-go-best" id="tetGoBest" style="display:none;"></div>
    <button class="tet-go-btn tet-go-retry" onclick="tetRetry()">&#128260; RETRY</button>
    <button class="tet-go-btn tet-go-home" onclick="tetGoHome()">&#127968; HOME</button>
  </div>
</div>

<!-- COLOR CHAIN -->
<div class="screen" id="colorchainGame">
  <!-- HUD -->
  <div class="cc-hud">
    <div class="cc-hud-item">
      <div class="cc-hud-label">SCORE</div>
      <div class="cc-hud-value" id="ccScoreValue">0</div>
    </div>
    <div class="cc-hud-item">
      <div class="cc-hud-label">TURN</div>
      <div class="cc-hud-value" id="ccTurnValue">0</div>
    </div>
    <div class="cc-hud-item">
      <div class="cc-combo" id="ccComboDisplay"></div>
    </div>
    <button class="cc-hud-help" onclick="ccShowRulebook()">?</button>
    <button class="cc-hud-close" onclick="ccPause()">&#9208;</button>
  </div>

  <!-- Players bar -->
  <div class="cc-players-bar" id="ccPlayersBar"></div>

  <!-- Play area -->
  <div class="cc-play-area">
    <!-- Hold side -->
    <div class="cc-side">
      <div class="cc-side-box">
        <div class="cc-side-label">HOLD</div>
        <canvas class="cc-side-canvas" id="ccHoldCanvas" width="60" height="60"></canvas>
      </div>
      <div class="cc-side-info">
        HEAT
        <div class="cc-heat-bar"><div class="cc-heat-fill" id="ccHeatFill" style="width:0%"></div></div>
      </div>
    </div>

    <!-- Board -->
    <div class="cc-board-wrap">
      <canvas class="cc-board-canvas" id="ccCanvas"></canvas>
    </div>

    <!-- Next side -->
    <div class="cc-side">
      <div class="cc-side-box">
        <div class="cc-side-label">NEXT</div>
        <canvas class="cc-side-canvas" id="ccNextCanvas" width="60" height="60"></canvas>
      </div>
    </div>
  </div>

  <!-- Controls hint (desktop) -->
  <div class="cc-controls-hint">&larr; &rarr; 이동 | Z X 회전 | &darr; 소프트드롭 | Space 하드드롭 | C 홀드</div>

  <!-- Touch controls (mobile) -->
  <div class="cc-controls">
    <div class="cc-ctrl-row">
      <div class="cc-btn" data-action="left">&#9664;</div>
      <div class="cc-btn" data-action="rotL">&#8634;</div>
      <div class="cc-btn" data-action="down">&#9660;</div>
      <div class="cc-btn" data-action="rotR">&#8635;</div>
      <div class="cc-btn" data-action="right">&#9654;</div>
    </div>
    <div class="cc-ctrl-row">
      <div class="cc-btn cc-btn-wide" data-action="drop">DROP</div>
      <div class="cc-btn cc-btn-wide" data-action="hold">HOLD</div>
    </div>
  </div>

  <!-- Countdown -->
  <div class="cc-countdown" id="ccCountdown" style="display:none;">
    <div class="cc-countdown-num" id="ccCountdownNum">3</div>
  </div>

  <!-- Pause -->
  <div class="cc-pause-overlay" id="ccPauseOverlay" style="display:none;">
    <div class="cc-pause-title">PAUSED</div>
    <button class="cc-pause-btn cc-pause-rulebook" onclick="ccShowRulebook()">&#128214; 룰북 보기</button>
    <button class="cc-pause-btn cc-pause-resume" onclick="ccResume()">&#9654;&#65039; 계속하기</button>
    <button class="cc-pause-btn cc-pause-quit" onclick="ccGoHome()">&#127968; 나가기</button>
  </div>

  <!-- Rulebook -->
  <div class="cc-rulebook" id="ccRulebook" style="display:none;">
    <div class="cc-rulebook-inner">
      <div class="cc-rb-title">RULEBOOK</div>

      <div class="cc-rb-section">조작법</div>
      <div class="cc-rb-text">
        <b>키보드</b><br>
        <span class="cc-rb-key">&larr;</span> <span class="cc-rb-key">&rarr;</span> 이동 &nbsp;
        <span class="cc-rb-key">Z</span> <span class="cc-rb-key">X</span> 회전<br>
        <span class="cc-rb-key">&darr;</span> 소프트드롭 &nbsp;
        <span class="cc-rb-key">Space</span> 하드드롭<br>
        <span class="cc-rb-key">C</span> 홀드
      </div>
      <div class="cc-rb-text">
        <b>모바일</b><br>
        화면 하단 터치 버튼으로 조작
      </div>

      <div class="cc-rb-section">목표</div>
      <div class="cc-rb-text">
        블록을 합쳐 레벨을 올리고 폭발시켜 점수를 획득하세요. 블록이 천장에 닿으면 게임 오버!
      </div>

      <div class="cc-rb-section">합체 (Merge)</div>
      <div class="cc-rb-text">
        같은 레벨의 블록이 상하좌우로 인접하면 자동으로 합체되며 레벨이 1 올라갑니다.
      </div>

      <div class="cc-rb-section">폭발</div>
      <div class="cc-rb-text">
        레벨 5를 초과(6+)하면 폭발! 주변 블록의 레벨이 1 올라가고 인접한 정크 블록이 제거됩니다.
      </div>

      <div class="cc-rb-section">체인 콤보</div>
      <div class="cc-rb-text">
        폭발이 연쇄적으로 일어나면 콤보! 콤보가 높을수록 점수 배율이 증가합니다.
      </div>

      <div class="cc-rb-section">히트 (Heat)</div>
      <div class="cc-rb-text">
        10턴마다 보드 위의 모든 블록 레벨이 1 올라갑니다. HEAT 게이지로 타이밍을 확인하세요.
      </div>

      <div class="cc-rb-section">정크 블록</div>
      <div class="cc-rb-text">
        일정 턴마다 경고 표시 후 회색 정크 블록이 등장합니다. 정크는 합체가 불가능하며 인접한 폭발로만 제거할 수 있습니다.
      </div>

      <div class="cc-rb-section">홀드</div>
      <div class="cc-rb-text">
        <span class="cc-rb-key">C</span> 키(또는 HOLD 버튼)로 현재 피스를 보관하고 나중에 교환할 수 있습니다. 한 턴에 한 번만 사용 가능합니다.
      </div>

      <button class="cc-rb-close" onclick="ccCloseRulebook()">닫기</button>
    </div>
  </div>

  <!-- Game Over -->
  <div class="cc-gameover" id="ccGameOver" style="display:none;">
    <div class="cc-go-title">GAME OVER</div>
    <div class="cc-go-score-box">
      <div class="cc-go-score" id="ccGoScore">0</div>
      <div class="cc-go-score-label">FINAL SCORE</div>
    </div>
    <div class="cc-go-stats">
      <div class="cc-go-stat">
        <div class="cc-go-stat-val" id="ccGoTurn">0</div>
        <div class="cc-go-stat-label">TURNS</div>
      </div>
      <div class="cc-go-stat">
        <div class="cc-go-stat-val" id="ccGoBest">0</div>
        <div class="cc-go-stat-label">BEST</div>
      </div>
    </div>
    <button class="cc-go-btn cc-go-retry" onclick="ccRetry()">&#128260; RETRY</button>
    <button class="cc-go-btn cc-go-home" onclick="ccGoHome()">&#127968; HOME</button>
  </div>
</div>

<!-- SLINKY STAIRS GAME -->
<div class="screen" id="slinkyStairsGame">
  <canvas id="slkCanvas"></canvas>
  <button class="slk-exit-btn" onclick="leaveGame()">&#10005;</button>
</div>

<!-- PUPIL -->
<div class="screen" id="pupilGame">
  <button class="ppl-exit-btn" onclick="pplLeavePupil()">&#10005;</button>
  <div class="ppl-ct">

    <!-- INTRO -->
    <div class="ppl-screen active" id="ppl-intro">
      <div class="ppl-hd"><h1>PUPIL</h1><div class="ppl-sub">Cognitive Load Pupillometry System</div></div>
      <div class="ppl-vc"><div class="ppl-ph"><div class="ppl-ei"></div><p>카메라 권한이 필요합니다</p></div></div>
      <div style="flex:1"></div>
      <p style="font-size:.82rem;color:#6a6a80;line-height:1.8;margin-bottom:16px;text-align:center">
        인지 부하에 의한 동공 반응을 분석하여<br>진술의 신뢰도를 측정합니다.
      </p>
      <div class="ppl-method-badge" style="text-align:center;display:block">PIR METRIC · BASELINE COMPARISON · MULTI-CHANNEL FUSION</div>
      <button class="ppl-btn ppl-bp" onclick="pplStartApp()" style="margin-top:12px">시작하기</button>
      <div class="ppl-disc">본 앱은 엔터테인먼트 목적이며 실제 거짓말 탐지기가 아닙니다.<br>Dionisio(2001), Cook(2012), Seymour(2013) 연구 기반 설계</div>
    </div>

    <!-- ADAPT -->
    <div class="ppl-screen" id="ppl-adapt">
      <div class="ppl-hd" style="padding:20px 0 10px"><h1 style="font-size:1.3rem;letter-spacing:6px">PUPIL</h1></div>
      <div class="ppl-vc">
        <video id="pplVid" autoplay playsinline></video>
        <canvas id="pplOvl" class="ppl-overlay"></canvas>
        <div class="ppl-ew" id="pplEw1"><div class="ppl-wi">⚠️</div><div class="ppl-wt">얼굴이 감지되지 않습니다<br>카메라를 정면으로 바라봐주세요</div></div>
      </div>
      <div class="ppl-sb" id="pplSb1"><div class="ppl-sd" id="pplSd1"></div><span class="ppl-st" id="pplSt1">초기화 중...</span></div>
      <div class="ppl-eq"><span class="ppl-eq-l">눈 감지 품질</span><div class="ppl-eq-b"><div class="ppl-eq-f" id="pplEf1"></div></div><span class="ppl-eq-v" id="pplEv1">—</span></div>
      <div class="ppl-adapt">
        <div class="ppl-adapt-ring" id="pplAdaptTimer">15</div>
        <p><strong>조명 적응 중</strong><br>동공이 현재 조명에 적응하는 시간입니다.<br>카메라를 정면으로 바라보며 기다려주세요.</p>
      </div>
      <div class="ppl-disc">동공의 광반사(PLR)를 안정화하여 인지 부하 신호를 분리합니다.</div>
    </div>

    <!-- CALIBRATION -->
    <div class="ppl-screen" id="ppl-calib">
      <div class="ppl-hd" style="padding:16px 0 10px"><h1 style="font-size:1.3rem;letter-spacing:6px">PUPIL</h1></div>
      <div class="ppl-pi" id="pplCPh"></div>
      <div class="ppl-vc ppl-vc-expand">
        <video id="pplVid2" autoplay playsinline></video>
        <canvas id="pplOvl2" class="ppl-overlay"></canvas>
        <div class="ppl-flash" id="pplFl1"></div><div class="ppl-cdo" id="pplCd1"></div>
        <div class="ppl-ew" id="pplEw2"><div class="ppl-wi">⚠️</div><div class="ppl-wt">얼굴이 감지되지 않습니다</div></div>
        <div class="ppl-cam-ui" id="pplCamUi1">
          <div class="ppl-cam-ql" id="pplQlbl">캘리브레이션</div>
          <div class="ppl-cam-qt" id="pplQtxt">준비되면 시작을 눌러주세요</div>
          <div class="ppl-cam-qi" id="pplQins"></div>
          <div class="ppl-byn" id="pplYn1" style="display:none">
            <button class="ppl-btn ppl-bp" id="pplBY" onclick="pplAnsCalib('yes')" disabled>예</button>
            <button class="ppl-btn ppl-bg" id="pplBN" onclick="pplAnsCalib('no')" disabled>아니오</button>
          </div>
          <div class="ppl-voice-ind" id="pplVoice1" style="display:none"><div class="ppl-vtop"><span>🎤</span><div class="ppl-vbar"><div class="ppl-vfill"></div></div></div><div class="ppl-vrec">"맞아요" 또는 "아니요"</div></div>
          <button class="ppl-btn ppl-bp ppl-cam-start" id="pplCBtn" onclick="pplBeginCalib()" disabled>캘리브레이션 시작</button>
        </div>
      </div>
      <div class="ppl-sb" id="pplSb2"><div class="ppl-sd" id="pplSd2"></div><span class="ppl-st" id="pplSt2">캘리브레이션</span></div>
      <div class="ppl-eq"><span class="ppl-eq-l">눈 감지 품질</span><div class="ppl-eq-b"><div class="ppl-eq-f" id="pplEf2"></div></div><span class="ppl-eq-v" id="pplEv2">—</span></div>
      <div class="ppl-str" id="pplStr1"></div>
      <div class="ppl-rb" id="pplRb1"><span>🔄</span><span class="ppl-rt" id="pplRbt1"></span></div>
    </div>

    <!-- CUSTOM Q -->
    <div class="ppl-screen" id="ppl-cq">
      <div class="ppl-hd" style="padding:16px 0 10px"><h1 style="font-size:1.3rem;letter-spacing:6px">PUPIL</h1></div>
      <div class="ppl-qc">
        <div class="ppl-ql t">테스트 질문 설정</div>
        <p style="font-size:.85rem;line-height:1.7;margin:12px 0 16px">
          확인하고 싶은 질문을 입력하세요.<br>
          동공 반응을 기준선과 비교하여 분석합니다.
        </p>
        <div class="ppl-cqa">
          <label style="font-size:.7rem;color:#ff3366;font-family:'JetBrains Mono',monospace;letter-spacing:1px">★ 핵심 질문 (거짓말 여부를 확인할 질문)</label>
          <textarea id="pplQMain" rows="2" placeholder="예: 어제 밤 10시에 집에 있었나요?" style="margin-top:6px"></textarea>
        </div>
      </div>
      <div style="flex:1"></div>
      <div class="ppl-method-badge" style="text-align:center;display:block;margin-bottom:12px">BASELINE COMPARISON · PIR METRIC · 800-1500ms WINDOW</div>
      <button class="ppl-btn ppl-bd" onclick="pplBeginTest()">테스트 시작</button>
    </div>

    <!-- TEST -->
    <div class="ppl-screen" id="ppl-test">
      <div class="ppl-hd" style="padding:16px 0 10px"><h1 style="font-size:1.3rem;letter-spacing:6px;color:#ff3366">PUPIL</h1></div>
      <div class="ppl-pi" id="pplTPh"></div>
      <div class="ppl-vc ppl-vc-expand">
        <video id="pplVid3" autoplay playsinline></video>
        <canvas id="pplOvl3" class="ppl-overlay"></canvas>
        <div class="ppl-flash" id="pplFl2"></div><div class="ppl-cdo" id="pplCd2"></div>
        <div class="ppl-ew" id="pplEw3"><div class="ppl-wi">⚠️</div><div class="ppl-wt">얼굴이 감지되지 않습니다</div></div>
        <div class="ppl-cam-ui" id="pplCamUi2">
          <div class="ppl-cam-ql t" id="pplTqlbl">핵심 질문</div>
          <div class="ppl-cam-qt" id="pplTqtxt"></div>
          <div class="ppl-cam-qi" id="pplTqins">솔직하게 대답해주세요</div>
          <div class="ppl-byn" id="pplYn2" style="display:none">
            <button class="ppl-btn ppl-bd" id="pplTbY" onclick="pplAnsTest('yes')" disabled>예</button>
            <button class="ppl-btn ppl-bg" id="pplTbN" onclick="pplAnsTest('no')" disabled>아니오</button>
          </div>
          <div class="ppl-voice-ind" id="pplVoice2" style="display:none"><div class="ppl-vtop"><span>🎤</span><div class="ppl-vbar"><div class="ppl-vfill"></div></div></div><div class="ppl-vrec">"맞아요" 또는 "아니요"</div></div>
        </div>
      </div>
      <div class="ppl-sb" id="pplSb3"><div class="ppl-sd" id="pplSd3"></div><span class="ppl-st" id="pplSt3">테스트</span></div>
      <div class="ppl-eq"><span class="ppl-eq-l">눈 감지 품질</span><div class="ppl-eq-b"><div class="ppl-eq-f" id="pplEf3"></div></div><span class="ppl-eq-v" id="pplEv3">—</span></div>
      <div class="ppl-str" id="pplStr2"></div>
      <div class="ppl-rb" id="pplRb2"><span>🔄</span><span class="ppl-rt" id="pplRbt2"></span></div>
    </div>

    <!-- ANALYZE -->
    <div class="ppl-screen" id="ppl-az">
      <div class="ppl-hd"><h1 style="font-size:1.3rem;letter-spacing:6px">PUPIL</h1></div>
      <div style="flex:1;display:flex;align-items:center;justify-content:center">
        <div class="ppl-az ppl-fi"><div class="ppl-sp"></div><h3>ANALYZING</h3><div class="ppl-dt" id="pplAzD">동공 데이터 수집 완료...</div></div>
      </div>
    </div>

    <!-- RESULT -->
    <div class="ppl-screen" id="ppl-res">
      <div class="ppl-hd" style="padding:16px 0 10px"><h1 style="font-size:1.3rem;letter-spacing:6px">PUPIL</h1></div>
      <div class="ppl-rc ppl-fi">
        <div class="ppl-dqb h" id="pplDqb">DATA QUALITY: HIGH</div>
        <div class="ppl-rm">
          <svg width="160" height="160" viewBox="0 0 160 160">
            <circle cx="80" cy="80" r="68" fill="none" stroke="rgba(255,255,255,.06)" stroke-width="7"/>
            <circle id="pplRArc" cx="80" cy="80" r="68" fill="none" stroke="#ff3366" stroke-width="7" stroke-dasharray="0 428" stroke-linecap="round" style="transition:stroke-dasharray 2s ease"/>
          </svg>
          <div class="ppl-vl" id="pplRPct">0%</div>
        </div>
        <div class="ppl-rl" id="pplRLbl">분석 완료</div>
      </div>
      <div class="ppl-cmp ppl-fi">
        <div class="ppl-cc"><h4 class="ppl-bl">기준선 PIR</h4><div class="ppl-cv ppl-bl" id="pplBpD">0.00</div></div>
        <div class="ppl-cc"><h4 class="ppl-tl">핵심질문 PIR</h4><div class="ppl-cv ppl-tl" id="pplTpD">0.00</div></div>
      </div>
      <div class="ppl-rc ppl-fi">
        <div class="ppl-rd">
          <div class="ppl-dr"><span class="ppl-mn">동공/홍채 비율 변화</span><span><span class="ppl-mv" id="pplMD">+0.0%</span><span class="ppl-db"><span class="ppl-fill" id="pplBD" style="width:0;background:#ff3366"></span></span></span></div>
          <div class="ppl-dr"><span class="ppl-mn">동공 확장 속도</span><span><span class="ppl-mv" id="pplMS">0.00</span><span class="ppl-db"><span class="ppl-fill" id="pplBS" style="width:0;background:#00f0ff"></span></span></span></div>
          <div class="ppl-dr"><span class="ppl-mn">깜빡임 빈도 변화</span><span><span class="ppl-mv" id="pplMB">0.00</span><span class="ppl-db"><span class="ppl-fill" id="pplBB" style="width:0;background:#00ff88"></span></span></span></div>
          <div class="ppl-dr"><span class="ppl-mn">응답 시간 (ms)</span><span><span class="ppl-mv" id="pplMR">0</span><span class="ppl-db"><span class="ppl-fill" id="pplBR" style="width:0;background:#ffaa00"></span></span></span></div>
          <div class="ppl-dr"><span class="ppl-mn">시선 안정성</span><span><span class="ppl-mv" id="pplMG">0.00</span><span class="ppl-db"><span class="ppl-fill" id="pplBG2" style="width:0;background:#9966ff"></span></span></span></div>
          <div class="ppl-dr"><span class="ppl-mn">좌우 비대칭</span><span><span class="ppl-mv" id="pplMA">0.00</span><span class="ppl-db"><span class="ppl-fill" id="pplBA" style="width:0;background:#ff9944"></span></span></span></div>
        </div>
      </div>
      <div class="ppl-method-badge" style="text-align:center;display:block;margin-bottom:12px" id="pplMethodNote">
        BASELINE COMPARISON · Z-SCORE NORM · LOGISTIC REGRESSION
      </div>
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="ppl-btn" onclick="pplRetestSame()">같은 사람 재질문</button>
        <button class="ppl-btn ppl-bd" onclick="pplResetAll()">다른 사람 시작</button>
      </div>
      <button class="ppl-btn ppl-bg" onclick="pplLeavePupil()" style="margin-top:4px">나가기</button>
      <div class="ppl-disc">이 결과는 참고용이며 과학적 거짓말 탐지 결과가 아닙니다.<br>동공 변화는 조명, 감정, 약물, 피로 등 다양한 요인에 영향받습니다.</div>
    </div>

    <!-- Voice Recognition Debug Panel -->
    <div class="ppl-debug" id="pplDebug" style="display:none">
      <div class="ppl-debug-hdr">
        <span>STT DEBUG</span>
        <span class="ppl-debug-st" id="pplDebugSt">OFF</span>
        <button class="ppl-debug-clr" onclick="pplDebugClear()">CLR</button>
      </div>
      <div class="ppl-debug-log" id="pplDebugLog"></div>
    </div>

  </div>
</div>

<!-- BLACKJACK -->
<div class="screen" id="blackjackGame">
  <div class="bj-top-bar">
    <div class="bj-top-info">
      <div class="bj-chip-display">
        <span>🪙</span>
        <span id="bjMyChips">0</span>
      </div>
      <span class="bj-phase-badge" id="bjPhaseBadge">베팅</span>
      <button onclick="toggleHandRanking('blackjack')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">규칙</button>
    </div>
    <button class="bj-close-btn" onclick="leaveGame()">✕</button>
  </div>

  <div class="bj-dealer-area">
    <div class="bj-dealer-label">🃏 딜러</div>
    <div class="bj-dealer-cards" id="bjDealerCards"></div>
    <div class="bj-dealer-total" id="bjDealerTotal" style="display:none;"></div>
    <div class="bj-dealer-status" id="bjDealerStatus"></div>
  </div>

  <div class="bj-opponents" id="bjOpponents"></div>

  <div class="bj-my-area">
    <div class="bj-my-cards" id="bjMyCards"></div>
    <div class="bj-my-total" id="bjMyTotal"></div>
    <div class="bj-my-status" id="bjMyStatus"></div>
  </div>

  <div class="bj-bottom-panel">
    <div class="bj-bet-area" id="bjBetArea" style="display:flex;">
      <div class="bj-bet-quick">
        <button class="bj-bet-quick-btn" onclick="bjQuickBet(0.5)">½×</button>
        <button class="bj-bet-quick-btn" onclick="bjQuickBet(1)">1×</button>
        <button class="bj-bet-quick-btn" onclick="bjQuickBet(2)">2×</button>
        <button class="bj-bet-quick-btn" onclick="bjQuickBet(5)">5×</button>
      </div>
      <div class="bj-bet-row">
        <input type="number" class="bj-bet-input" id="bjBetAmount" placeholder="베팅 금액" min="1">
        <button class="bj-bet-confirm" onclick="bjPlaceBet()">베팅</button>
      </div>
    </div>

    <button class="bj-deal-btn" id="bjDealBtn" onclick="bjDeal()">🃏 카드 배분</button>

    <div class="bj-action-area" id="bjActionArea">
      <button class="bj-action-btn bj-btn-hit" onclick="bjHit()">히트</button>
      <button class="bj-action-btn bj-btn-stand" onclick="bjStand()">스탠드</button>
      <button class="bj-action-btn bj-btn-double" id="bjDoubleBtn" onclick="bjDouble()">더블</button>
    </div>
  </div>
</div>

<!-- BLACKJACK RESULT -->
<div class="bj-result-overlay" id="bjResultOverlay">
  <div class="bj-result-title">🃏 블랙잭 결과</div>
  <div class="bj-result-dealer">
    <div class="bj-result-dealer-label">딜러</div>
    <div class="bj-result-dealer-cards" id="bjResultDealerCards"></div>
    <div class="bj-result-dealer-total" id="bjResultDealerTotal"></div>
  </div>
  <div class="bj-result-list" id="bjResultList"></div>
  <div class="bj-result-btns">
    <button class="btn btn-primary" onclick="closeBJResult()" style="flex:1;">다음 라운드</button>
    <button class="btn btn-secondary" onclick="closeBJResultToLobby()" style="flex:1;font-size:13px;">로비로</button>
  </div>
</div>

<!-- RESULT -->
<div class="result-overlay" id="resultOverlay">
  <div class="result-title" id="resultTitle">🏆 승리!</div>
  <div class="winner-info">
    <div id="winnerName" style="font-size:20px;font-weight:900;"></div>
    <div class="result-cards" id="resultCards"></div>
    <div class="result-hand" id="resultHand"></div>
    <div class="result-pot" id="resultPot"></div>
  </div>
  <div style="display:flex;gap:8px;max-width:320px;width:100%;">
    <button class="btn btn-primary" onclick="closeResult()" style="flex:1;">다음 라운드</button>
    <button class="btn btn-secondary" onclick="closeResultToLobby()" style="flex:1;font-size:13px;">로비로</button>
  </div>
</div>

<!-- TAMAGOTCHI -->
<div class="screen" id="tamagotchiGame">

  <!-- FTUE: Tribe Selection -->
  <div class="tama-ftue-screen active" id="tamaTribeSelect">
    <div class="tama-ftue-title">종족을 선택하세요</div>
    <div class="tama-ftue-sub">각 종족마다 고유한 성장 특성이 있습니다</div>
    <div class="tama-tribe-grid">
      <div class="tama-tribe-btn" data-tribe="fire" onclick="tamaSelectTribe('fire')">
        <span class="tama-tribe-emoji">🐉</span>
        <span class="tama-tribe-name">화염</span>
        <span class="tama-tribe-desc">공격 특화</span>
      </div>
      <div class="tama-tribe-btn" data-tribe="rock" onclick="tamaSelectTribe('rock')">
        <span class="tama-tribe-emoji">🗿</span>
        <span class="tama-tribe-name">암석</span>
        <span class="tama-tribe-desc">방어 특화</span>
      </div>
      <div class="tama-tribe-btn" data-tribe="wind" onclick="tamaSelectTribe('wind')">
        <span class="tama-tribe-emoji">🦅</span>
        <span class="tama-tribe-name">풍래</span>
        <span class="tama-tribe-desc">속도 특화</span>
      </div>
      <div class="tama-tribe-btn" data-tribe="thunder" onclick="tamaSelectTribe('thunder')">
        <span class="tama-tribe-emoji">🐯</span>
        <span class="tama-tribe-name">뇌전</span>
        <span class="tama-tribe-desc">밸런스형</span>
      </div>
      <div class="tama-tribe-btn" data-tribe="spirit" onclick="tamaSelectTribe('spirit')">
        <span class="tama-tribe-emoji">🔮</span>
        <span class="tama-tribe-name">영혼</span>
        <span class="tama-tribe-desc">전술 특화</span>
      </div>
    </div>
    <button class="tama-btn" id="tamaTribeConfirm" onclick="tamaConfirmTribe()" disabled>선택 완료</button>
  </div>

  <!-- FTUE: Egg Hatch -->
  <div class="tama-ftue-screen" id="tamaEggHatch">
    <div class="tama-ftue-title">알을 부화시키세요!</div>
    <div class="tama-ftue-sub">알을 탭해서 부화시키세요</div>
    <div class="tama-egg-area" onclick="tamaTapEgg()">
      <span class="tama-egg">🥚</span>
      <span class="tama-egg-crack" id="tamaEggCrack"></span>
    </div>
    <div class="tama-egg-progress"><div class="tama-egg-progress-bar" id="tamaEggProgressBar"></div></div>
    <div class="tama-tap-hint">탭하여 부화!</div>
  </div>

  <!-- Hatch Flash -->
  <div class="tama-hatch-flash" id="tamaHatchFlash">
    <div class="tama-hatch-baby"></div>
  </div>

  <!-- FTUE: Name -->
  <div class="tama-ftue-screen" id="tamaNameScreen">
    <div class="tama-ftue-title">이름을 지어주세요</div>
    <div class="tama-name-preview" id="tamaNamePreview">🔥</div>
    <input class="tama-name-input" id="tamaNameInput" placeholder="이름 입력" maxlength="8">
    <button class="tama-btn" onclick="tamaConfirmName()">완료!</button>
  </div>

  <!-- FTUE: First Feed -->
  <div class="tama-ftue-screen" id="tamaFtueFeed">
    <div class="tama-ftue-title">첫 먹이를 줍시다!</div>
    <div class="tama-ftue-sub">아기가 배고파하고 있어요</div>
    <div class="tama-ftue-pet-display" id="tamaFtueFeedPet">🔥</div>
    <button class="tama-btn" onclick="tamaFtueFirstFeed()">🍖 먹이 주기</button>
  </div>

  <!-- HOME SCREEN -->
  <div class="tama-home" id="tamaHomeScreen">

    <!-- Header -->
    <div class="tama-header">
      <div class="tama-header-left">
        <button class="tama-back-btn" onclick="tamaGoBack()">←</button>
        <span class="tama-pet-name" id="tamaPetNameLabel">이름</span>
      </div>
      <div class="tama-header-right">
        <span class="tama-personality" id="tamaPersonalityLabel"></span>
        <span class="tama-pet-age" id="tamaPetAge"></span>
        <div class="tama-gold-display">🪙 <span id="tamaGoldValue">0</span></div>
      </div>
    </div>

    <!-- Level Bar -->
    <div class="tama-level-bar">
      <span class="tama-level-badge" id="tamaLevelBadge">Lv.1</span>
      <div class="tama-exp-track"><div class="tama-exp-fill" id="tamaExpFill" style="width:0%"></div></div>
      <span class="tama-exp-text" id="tamaExpText">0/100</span>
      <span class="tama-stage-label" id="tamaStageLabel">유아</span>
    </div>

    <!-- Pet Display -->
    <div class="tama-pet-area" id="tamaPetArea">
      <div class="tama-speech" id="tamaSpeechBubble"></div>
      <div class="tama-sprite idle-bounce" id="tamaSpriteMain">🥚</div>
      <div class="tama-mood" id="tamaMoodDisplay">😊 좋음</div>
    </div>

    <!-- Needs Bars -->
    <div class="tama-needs">
      <div class="tama-need-item">
        <span class="tama-need-icon">🍖</span>
        <div class="tama-need-info">
          <div class="tama-need-label">포만감</div>
          <div class="tama-need-track"><div class="tama-need-fill high" id="tamaNeed_hunger" style="width:80%"></div></div>
        </div>
        <span class="tama-need-val" id="tamaNeedVal_hunger">80</span>
      </div>
      <div class="tama-need-item">
        <span class="tama-need-icon">😊</span>
        <div class="tama-need-info">
          <div class="tama-need-label">행복감</div>
          <div class="tama-need-track"><div class="tama-need-fill high" id="tamaNeed_happiness" style="width:80%"></div></div>
        </div>
        <span class="tama-need-val" id="tamaNeedVal_happiness">80</span>
      </div>
      <div class="tama-need-item">
        <span class="tama-need-icon">🛁</span>
        <div class="tama-need-info">
          <div class="tama-need-label">위생</div>
          <div class="tama-need-track"><div class="tama-need-fill high" id="tamaNeed_hygiene" style="width:80%"></div></div>
        </div>
        <span class="tama-need-val" id="tamaNeedVal_hygiene">80</span>
      </div>
      <div class="tama-need-item">
        <span class="tama-need-icon">⚡</span>
        <div class="tama-need-info">
          <div class="tama-need-label">에너지</div>
          <div class="tama-need-track"><div class="tama-need-fill high" id="tamaNeed_energy" style="width:80%"></div></div>
        </div>
        <span class="tama-need-val" id="tamaNeedVal_energy">80</span>
      </div>
    </div>

    <!-- Affinity -->
    <div class="tama-affinity-section">
      <div class="tama-affinity-row">
        <span class="tama-affinity-label" id="tamaAffinityLabel">💛 호감도</span>
        <div class="tama-affinity-track"><div class="tama-affinity-fill" id="tamaAffinityFill" style="width:0%"></div></div>
        <span class="tama-affinity-tier" id="tamaAffinityTierLabel">경계</span>
        <span class="tama-affinity-val" id="tamaAffinityVal">0</span>
      </div>
    </div>

    <!-- Stats -->
    <div class="tama-stats-row" id="tamaStatsRow"></div>

    <!-- Action Buttons -->
    <div class="tama-actions">
      <button class="tama-action-btn" onclick="tamaOpenFeed()">
        <span class="icon">🍖</span><span class="label">먹이</span>
      </button>
      <button class="tama-action-btn" id="tamaBathBtn" onclick="tamaBathe()">
        <span class="icon">🛁</span><span class="label">씻기기</span><span class="cooldown"></span>
      </button>
      <button class="tama-action-btn" onclick="tamaPlay()">
        <span class="icon">🎮</span><span class="label">놀아주기</span>
      </button>
      <button class="tama-action-btn" onclick="tamaSleep()">
        <span class="icon">😴</span><span class="label">재우기</span>
      </button>
      <button class="tama-action-btn" id="tamaStatAllocBtn" onclick="tamaShowStats()" style="display:none">
        <span class="icon">📊</span><span class="label">SP: 0</span>
      </button>
      <button class="tama-action-btn" onclick="tamaShowInfo()">
        <span class="icon">ℹ️</span><span class="label">정보</span>
      </button>
    </div>

  </div>

  <!-- OVERLAYS -->

  <!-- Feed Overlay -->
  <div class="tama-overlay" id="tamaFeedOverlay">
    <div class="tama-overlay-header">
      <span class="tama-overlay-title">🍖 먹이 주기</span>
      <button class="tama-overlay-close" onclick="tamaCloseOvl('tamaFeedOverlay')">✕</button>
    </div>
    <div class="tama-food-tabs">
      <button class="tama-food-tab active" data-cat="all" onclick="tamaSetFoodCat('all')">전체</button>
      <button class="tama-food-tab" data-cat="basic" onclick="tamaSetFoodCat('basic')">기본식</button>
      <button class="tama-food-tab" data-cat="healthy" onclick="tamaSetFoodCat('healthy')">건강식</button>
      <button class="tama-food-tab" data-cat="snack" onclick="tamaSetFoodCat('snack')">간식</button>
    </div>
    <div class="tama-food-grid"></div>
  </div>

  <!-- Stat Allocation Overlay -->
  <div class="tama-overlay" id="tamaStatOverlay"></div>

  <!-- Evolution Overlay -->
  <div class="tama-overlay tama-evolve-overlay" id="tamaEvolveOverlay"></div>

  <!-- Sleep Overlay -->
  <div class="tama-overlay tama-sleep-overlay" id="tamaSleepOverlay" onclick="tamaCancelSleep()">
    <div class="tama-sleep-zzz">💤</div>
    <div class="tama-sleep-sprite">😴</div>
    <div class="tama-sleep-timer">30초 남음 (탭하여 취소)</div>
  </div>

  <!-- Train Overlay -->
  <div class="tama-overlay" id="tamaTrainOverlay">
    <div class="tama-overlay-header">
      <span class="tama-overlay-title">🎮 놀아주기</span>
      <button class="tama-overlay-close" onclick="tamaCloseOvl('tamaTrainOverlay')">✕</button>
    </div>
    <div class="tama-train-area">
      <div class="tama-train-counter">0 / 10</div>
      <div class="tama-train-target">🐉</div>
      <div class="tama-train-progress"><div class="tama-train-progress-bar" style="width:0%"></div></div>
      <div style="font-size:13px;color:#888;">펫을 탭해서 놀아주세요!</div>
    </div>
  </div>

  <!-- Offline Return Overlay -->
  <div class="tama-overlay tama-offline-overlay" id="tamaOfflineOverlay">
    <div class="offline-icon">😊</div>
    <div class="offline-msg">다시 와줬구나!</div>
    <div class="offline-bonus"></div>
    <button class="tama-btn" onclick="tamaDismissOffline()">돌아왔어!</button>
  </div>

  <!-- Info Overlay (dynamically filled by JS) -->
  <div class="tama-overlay" id="tamaInfoOverlay"></div>

  <!-- Level Up Flash -->
  <div class="tama-levelup-flash" id="tamaLevelUpFlash">
    <div class="lu-text">Level Up!</div>
    <div class="lu-sub"></div>
  </div>

  <!-- Affinity Flash -->
  <div class="tama-affinity-flash" id="tamaAffinityFlash">
    <div class="af-text">호감도 UP!</div>
  </div>

</div>

<!-- Game Catalog Overlay -->
<div id="gameCatalogOverlay" class="game-catalog-overlay" style="display:none;" onclick="closeGameCatalog()">
  <div class="game-catalog-container" onclick="event.stopPropagation()">
    <div class="game-catalog-header">
      <div style="font-size:18px;font-weight:900;color:#fff;">🎮 게임 목록</div>
      <button onclick="closeGameCatalog()" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">✕</button>
    </div>
    <div class="game-options" id="catalogGameOptions">
      <div class="game-option selected" data-game="poker" onclick="selectGame(this)">
        <span class="game-emoji">🃏</span>홀덤
      </div>
      <div class="game-option" data-game="mafia" onclick="selectGame(this)">
        <span class="game-emoji">🕵️</span>마피아
      </div>
      <div class="game-option" data-game="sutda" onclick="selectGame(this)">
        <span class="game-emoji">🎴</span>섯다
      </div>
      <div class="game-option" data-game="quickdraw" onclick="selectGame(this)">
        <span class="game-emoji">🤠</span>총잡이
      </div>
      <div class="game-option" data-game="roulette" onclick="selectGame(this)">
        <span class="game-emoji">🔫</span>룰렛
      </div>
      <div class="game-option" data-game="lottery" onclick="selectGame(this)">
        <span class="game-emoji">🎰</span>뽑기
      </div>
      <div class="game-option" data-game="ecard" onclick="selectGame(this)">
        <span class="game-emoji">👑</span>E카드
      </div>
      <div class="game-option" data-game="yahtzee" onclick="selectGame(this)">
        <span class="game-emoji">🎲</span>야추
      </div>
      <div class="game-option" data-game="updown" onclick="selectGame(this)">
        <span class="game-emoji">🃏</span>업다운
      </div>
      <div class="game-option" data-game="truth" onclick="selectGame(this)">
        <span class="game-emoji">⭕</span>진실게임
      </div>
      <div class="game-option" data-game="fortress" onclick="selectGame(this)">
        <span class="game-emoji">🏰</span>요새
      </div>
      <div class="game-option" data-game="bombshot" onclick="selectGame(this)">
        <span class="game-emoji">🍺</span>폭탄주
      </div>
      <div class="game-option" data-game="blackjack" onclick="selectGame(this)">
        <span class="game-emoji">🃏</span>블랙잭
      </div>
      <div class="game-option disabled" data-game="stairs" onclick="selectGame(this)">
        <span class="game-emoji">🪜</span>무한계단<span class="game-disabled-tag">저작권 검토중</span>
      </div>
      <div class="game-option disabled" data-game="tetris" onclick="selectGame(this)">
        <span class="game-emoji">🧩</span>테트리스<span class="game-disabled-tag">저작권 검토중</span>
      </div>
      <div class="game-option" data-game="jewel" onclick="selectGame(this)">
        <span class="game-emoji">💎</span>보석맞추기
      </div>
      <div class="game-option" data-game="colorchain" onclick="selectGame(this)">
        <span class="game-emoji">🔗</span>컬러체인
      </div>
      <div class="game-option" data-game="slinkystairs" onclick="selectGame(this)">
        <span class="game-emoji">🌀</span>슬링키
      </div>
      <div class="game-option" data-game="pupil" onclick="selectGame(this)">
        <span class="game-emoji">👁</span>동공탐지
      </div>
      <div class="game-option" data-game="idol" onclick="selectGame(this)">
        <span class="game-emoji">🎤</span>아이돌
      </div>
      <div class="game-option" data-game="drinkpoker" onclick="selectGame(this)">
        <span class="game-emoji">🍶</span>술피하기
      </div>
      <div class="game-option" data-game="kingstagram" onclick="selectGame(this)">
        <span class="game-emoji">👑</span>킹스타그램
      </div>
    </div>
    <div class="game-info-panel" id="gameInfoPanel" style="display:none;margin-top:8px;padding:10px 12px;background:rgba(255,255,255,0.05);border-radius:10px;border:1px solid rgba(255,255,255,0.1);">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
        <span id="gameInfoEmoji" style="font-size:24px;"></span>
        <span id="gameInfoName" style="font-size:16px;font-weight:700;color:#fff;"></span>
      </div>
      <div id="gameInfoDesc" style="font-size:12px;color:#aaa;line-height:1.5;margin-bottom:6px;"></div>
      <div style="display:flex;gap:12px;font-size:11px;color:#888;">
        <span id="gameInfoPlayers"></span>
        <span id="gameInfoTime"></span>
        <span id="gameInfoType"></span>
      </div>
    </div>
    <button class="btn btn-primary" id="catalogSelectBtn" style="display:none;width:100%;margin-top:12px;" onclick="confirmGameFromCatalog()">이 게임 선택</button>
    <div id="catalogReadOnlyMsg" style="display:none;text-align:center;font-size:12px;color:#888;margin-top:10px;">호스트만 게임을 선택할 수 있습니다</div>
  </div>
</div>

<!-- Diamond Shop Modal -->
<div id="diamondShopOverlay" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.85);padding:20px;" onclick="closeDiamondShop()">
  <div style="max-width:320px;margin:60px auto;background:var(--bg-card,#14142a);border-radius:16px;padding:24px;text-align:center;" onclick="event.stopPropagation()">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
      <div style="font-size:18px;font-weight:900;color:#fff;">💎 다이아 상점</div>
      <button onclick="closeDiamondShop()" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">✕</button>
    </div>
    <div style="font-size:14px;color:#aaa;margin-bottom:16px;">현재 보유: 💎 <span id="diamondShopBalance">0</span>개</div>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <button class="btn btn-primary" onclick="buyDiamond(1)" style="width:100%;">💎 1개 획득 (테스트)</button>
      <button class="btn btn-primary" onclick="buyDiamond(5)" style="width:100%;">💎 5개 획득 (테스트)</button>
      <button class="btn btn-primary" onclick="buyDiamond(10)" style="width:100%;">💎 10개 획득 (테스트)</button>
    </div>
    <div style="font-size:11px;color:#666;margin-top:14px;">* 결제 시스템 연동 전 테스트 버전</div>
  </div>
</div>

<!-- Hand Ranking Overlay -->
<div id="handRankingOverlay" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.85);overflow-y:auto;padding:20px;" onclick="this.style.display='none'">
  <div style="max-width:360px;margin:0 auto;background:var(--bg-card,#14142a);border-radius:16px;padding:20px;" onclick="event.stopPropagation()">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div style="font-size:18px;font-weight:900;color:#fff;" id="handRankingTitle">족보</div>
      <button onclick="document.getElementById('handRankingOverlay').style.display='none'" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">✕</button>
    </div>
    <div id="handRankingContent" style="font-size:13px;color:#ccc;line-height:1.8;"></div>
  </div>
</div>

<!-- IDOL MANAGEMENT GAME -->
<div class="screen" id="idolGame">
  <div class="idol-header">
    <button class="pk-close-btn" onclick="leaveGame()" style="font-size:18px;background:none;border:none;color:#fff;cursor:pointer;">✕</button>
    <div class="idol-header-title">🎤 아이돌 매니지먼트</div>
    <div class="idol-turn-badge" id="idolTurnBadge">1 / 25턴</div>
  </div>

  <div class="idol-resource-bar" id="idolResourceBar" role="region" aria-label="아이돌 상태 요약"></div>

  <div class="idol-board-wrapper" id="idolBoardWrapper">
    <!-- 카메라 컨트롤 -->
    <div class="idol-cam-controls" id="idolCamControls">
      <button class="idol-cam-btn" onclick="idolCamZoomIn()" title="줌인">+</button>
      <button class="idol-cam-btn idol-cam-btn-reset" onclick="idolCamReset()" title="전체보기">⊙</button>
      <button class="idol-cam-btn" onclick="idolCamZoomOut()" title="줌아웃">−</button>
    </div>
    <!-- 줌/팬 뷰포트 -->
    <div class="idol-board-viewport" id="idolBoardViewport">
      <div class="idol-board" id="idolBoard" role="grid" aria-label="아이돌 보드"></div>
      <!-- ISO 보드 중앙 패널: 평상시 플레이어 스탯, 오버라이드 시 이벤트 표시 -->
      <div id="idolCenterPanel" class="idol-iso-center-panel"></div>
      <div id="idolCenterOverlay" class="idol-iso-center-overlay" style="display:none;"></div>
    </div>
  </div>

  <div class="idol-action-panel" id="idolActionPanel" role="region" aria-live="polite" aria-label="행동 안내">
    <div class="idol-action-title" style="color:#888;">게임 로딩 중...</div>
  </div>

  <!-- 전광판 테스트 버튼 (임시) -->
  <button onclick="idolEventScreenShow()" style="position:absolute;top:8px;right:8px;z-index:500;padding:6px 12px;background:#333;color:#fff;border:1px solid #666;border-radius:6px;font-size:13px;cursor:pointer;">📺 전광판</button>

  <!-- 3D 다이스 오버레이 (주사위 굴릴 때만 표시) -->
  <div id="idolDiceOverlay" class="idol-dice-overlay" style="display:none;" aria-hidden="true">
    <div class="idol-dice-3d-wrap">
      <canvas id="idolDiceCanvas"></canvas>
    </div>
    <div id="idolDiceResultBadge" class="idol-dice-result-badge"></div>
  </div>
</div>

<!-- DRINK-DODGE POKER -->
<div class="screen" id="drinkpokerGame">
  <div class="dp-header">
    <button class="dp-back-btn" onclick="leaveGame()">←</button>
    <div class="dp-header-title">🍶 술피하기 포커</div>
    <button class="dp-tracker-btn" onclick="dpShowTracker()">📊</button>
  </div>
  <div class="dp-turn-indicator" id="dpTurnIndicator"></div>
  <div class="dp-opponents" id="dpOpponents"></div>
  <div class="dp-center" id="dpCenter"></div>
  <div class="dp-my-faceup" id="dpMyFaceUp"></div>
  <div class="dp-my-hand" id="dpMyHand"></div>
  <div class="dp-actions" id="dpActions"></div>
  <!-- Game Over -->
  <div class="dp-gameover" id="dpGameOver" style="display:none;">
    <div class="dp-gameover-title" id="dpGameOverTitle"></div>
    <div class="dp-rankings" id="dpRankings"></div>
    <div class="dp-gameover-actions">
      <button class="dp-btn dp-btn-close" onclick="closeDPGame()">나가기</button>
    </div>
  </div>
  <!-- Send Modal (content fully managed by dpSend()) -->
  <div class="dp-modal dp-send-modal" id="dpSendModal" style="display:none;"></div>
  <!-- Peek-Pass Modal (content fully managed by dpPeekPass()) -->
  <div class="dp-modal dp-peek-modal" id="dpPeekPassModal" style="display:none;"></div>
  <!-- Tracker Overlay -->
  <div class="dp-tracker-overlay" id="dpTrackerOverlay" style="display:none;" onclick="dpCloseTracker()">
    <div class="dp-tracker-box" onclick="event.stopPropagation()">
      <div class="dp-tracker-title">📊 앞면 카드 현황</div>
      <div class="dp-tracker-content" id="dpTrackerContent"></div>
      <button class="dp-btn dp-btn-cancel" onclick="dpCloseTracker()">닫기</button>
    </div>
  </div>
</div>

<!-- KINGSTAGRAM -->
<div class="screen" id="kingstagramGame">
  <!-- Content fully rendered by renderKingView() -->
</div>

<!-- QR Code library -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="js/core.js?v=3"></script>
<script src="js/games/poker.js?v=2"></script>
<script src="js/games/mafia.js?v=4"></script>
<script src="js/games/truth.js?v=2"></script>
<script src="js/games/quickdraw.js?v=2"></script>
<script src="js/games/roulette.js?v=2"></script>
<script src="js/games/lottery.js?v=2"></script>
<script src="js/games/updown.js?v=2"></script>
<script src="js/games/yahtzee.js?v=2"></script>
<script src="js/games/ecard.js?v=2"></script>
<script src="js/games/sutda.js?v=2"></script>
<script src="js/games/fortress.js?v=14"></script>
<script src="js/games/bombshot.js?v=1"></script>
<script src="js/games/blackjack.js?v=1"></script>
<script src="js/games/stairs.js?v=1"></script>
<script src="js/games/tetris.js?v=1"></script>
<script src="js/games/jewel.js?v=1"></script>
<script src="js/games/colorchain.js?v=1"></script>
<script src="js/games/slinkystairs.js?v=1"></script>
<script src="js/games/pupil.js?v=1"></script>
<script src="js/games/tamagotchi.js?v=2"></script>
<script src="js/games/idol-data.js"></script>
<script src="js/games/idol-board-iso.js?v=20260301b"></script>
<script src="js/games/idol-event-screen.js"></script>
<script src="js/games/idol.js?v=20260301e"></script>
<script src="js/games/idol-festival.js?v=20260301a"></script>
<script src="js/games/idol-perf.js?v=20260301b"></script>
<script src="js/games/drinkpoker.js"></script>
<script src="js/games/kingstagram.js"></script>
<script src="js/ai.js?v=3"></script>
<!-- Three.js + yahtzee-three.js: 야추 게임 시작 시 동적 로딩 (loadYahtzeeThree) -->
</body>
</html>
