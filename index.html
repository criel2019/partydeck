<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>파티덱 - P2P 미니게임</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a0a12">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700;900&family=Oswald:wght@500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/games/mafia.css">
<link rel="stylesheet" href="css/games/truth.css">
<link rel="stylesheet" href="css/games/quickdraw.css">
<link rel="stylesheet" href="css/games/roulette.css">
<link rel="stylesheet" href="css/games/lottery.css">
<link rel="stylesheet" href="css/games/updown.css">
<link rel="stylesheet" href="css/games/yahtzee.css">
<link rel="stylesheet" href="css/games/ecard.css">
<link rel="stylesheet" href="css/games/sutda.css">
<link rel="stylesheet" href="css/games/mobile.css">
</head>
<body>

<div class="toast" id="toast"></div>

<!-- LOADING -->
<div class="screen active" id="loadingScreen">
  <div class="logo-icon">🎲</div>
  <div class="logo-title">파티덱</div>
  <div class="loading-text" id="loadingText">연결 준비 중...</div>
  <div class="loading-bar"><div class="loading-bar-inner" id="loadingBar"></div></div>
</div>

<!-- MAIN MENU -->
<div class="screen" id="mainMenu">
  <div class="logo-area">
    <div class="logo-icon">🎲</div>
    <div class="logo-title">파티덱</div>
    <div class="logo-sub">서버 없이 즐기는 P2P 미니게임</div>
  </div>

  <div class="menu-card">
    <div class="profile-section">
      <div class="avatar" id="myAvatar" onclick="cycleAvatar()">😎</div>
      <div class="profile-info">
        <input class="input-field" id="nameInput" placeholder="닉네임 입력" maxlength="8" style="padding:10px 12px; font-size:15px; font-weight:700;">
        <div class="profile-stats" id="profileStats">전적 로딩 중...</div>
      </div>
    </div>
  </div>

  <button class="btn btn-primary" onclick="createRoom()">🏠 방 만들기</button>

  <div class="join-row">
    <input class="input-field" id="joinCodeInput" placeholder="방 코드 입력" maxlength="6" style="text-transform:uppercase; text-align:center; letter-spacing:4px; font-weight:700; flex:1;">
    <button class="btn btn-accent2 btn-small" onclick="joinRoom()" style="width:auto; padding:14px 20px;">참가</button>
  </div>

  <button class="btn btn-accent2" onclick="startPracticeMode()" style="max-width:380px;">🤖 연습 모드 (AI 대전)</button>

  <button class="btn btn-secondary" onclick="shareApp()" style="max-width:380px;">📱 앱 공유 (QR 코드)</button>

  <!-- Debug Preview Toggle -->
  <button class="btn btn-debug-toggle" id="debugToggleBtn" onclick="toggleDebugMode()">🛠 디버그 미리보기</button>
  <div class="debug-game-selector" id="debugGameSelector" style="display:none;">
    <div class="debug-selector-title">게임 선택 (1인 미리보기)</div>
    <div class="debug-game-grid">
      <button class="debug-game-btn" onclick="debugGame('poker')">🃏 포커</button>
      <button class="debug-game-btn" onclick="debugGame('mafia')">🕵️ 마피아</button>
      <button class="debug-game-btn" onclick="debugGame('sutda')">🎴 섯다</button>
      <button class="debug-game-btn" onclick="debugGame('quickdraw')">🤠 총잡이</button>
      <button class="debug-game-btn" onclick="debugGame('roulette')">🔫 룰렛</button>
      <button class="debug-game-btn" onclick="debugGame('lottery')">🎰 뽑기</button>
      <button class="debug-game-btn" onclick="debugGame('ecard')">👑 E카드</button>
      <button class="debug-game-btn" onclick="debugGame('yahtzee')">🎲 야추</button>
      <button class="debug-game-btn" onclick="debugGame('updown')">🃏 업다운</button>
      <button class="debug-game-btn" onclick="debugGame('truth')">⭕ 진실게임</button>
    </div>
  </div>

  <div class="ad-banner">📢 광고 영역 (AdSense / AdMob)</div>
</div>

<!-- PRACTICE MODE SELECT -->
<div class="screen" id="practiceSelect">
  <div class="lobby-header">
    <button class="back-btn" onclick="leavePracticeMode()">←</button>
    <div style="font-family:'Black Han Sans'; font-size:20px;">🤖 연습 모드</div>
    <div style="width:40px;"></div>
  </div>
  <div class="practice-content">
    <div class="practice-desc">AI 상대와 연습 플레이</div>
    <div class="practice-game-grid">
      <button class="practice-game-btn" onclick="startPracticeGame('poker')">🃏 포커</button>
      <button class="practice-game-btn" onclick="startPracticeGame('mafia')">🕵️ 마피아</button>
      <button class="practice-game-btn" onclick="startPracticeGame('sutda')">🎴 섯다</button>
      <button class="practice-game-btn" onclick="startPracticeGame('quickdraw')">🤠 총잡이</button>
      <button class="practice-game-btn" onclick="startPracticeGame('roulette')">🔫 룰렛</button>
      <button class="practice-game-btn" onclick="startPracticeGame('lottery')">🎰 뽑기</button>
      <button class="practice-game-btn" onclick="startPracticeGame('ecard')">👑 E카드</button>
      <button class="practice-game-btn" onclick="startPracticeGame('yahtzee')">🎲 야추</button>
      <button class="practice-game-btn" onclick="startPracticeGame('updown')">🃏 업다운</button>
      <button class="practice-game-btn" onclick="startPracticeGame('truth')">⭕ 진실게임</button>
    </div>
  </div>
</div>

<!-- LOBBY -->
<div class="screen" id="lobby">
  <div class="lobby-header">
    <button class="back-btn" onclick="leaveLobby()">←</button>
    <div style="font-family:'Black Han Sans'; font-size:20px;">대기실</div>
    <div style="width:40px;"></div>
  </div>

  <div class="lobby-content">
    <div class="room-code-display">
      <div class="room-code-label">방 코드를 친구에게 공유하세요</div>
      <div class="room-code" id="roomCodeDisplay" onclick="copyRoomCode()">------</div>
      <div class="room-code-hint">탭하여 복사</div>
      <div class="share-btn-row">
        <button class="share-btn" onclick="copyRoomCode()">📋 코드 복사</button>
        <button class="share-btn" onclick="shareLink()">🔗 링크 공유</button>
      </div>
      <div id="qrCodeDisplay" style="margin:8px auto;width:100px;height:100px;"></div>
    </div>

  <div class="players-section">
    <div class="players-title">플레이어 (<span id="playerCount">0</span>/14)</div>
    <div class="player-list" id="playerList"></div>
  </div>

  <div class="game-select" id="gameSelectArea" style="display:none;">
    <div class="game-select-title">게임 선택 (호스트만 가능)</div>
    <div class="game-options">
      <div class="game-option selected" data-game="poker" onclick="selectGame(this)">
        <span class="game-emoji">🃏</span>포커
      </div>
      <div class="game-option" data-game="mafia" onclick="selectGame(this)">
        <span class="game-emoji">🕵️</span>마피아
      </div>
      <div class="game-option" data-game="sutda" onclick="selectGame(this)">
        <span class="game-emoji">🎴</span>섯다
      </div>
      <div class="game-option" data-game="quickdraw" onclick="selectGame(this)">
        <span class="game-emoji">🤠</span>총잡이
      </div>
      <div class="game-option" data-game="roulette" onclick="selectGame(this)">
        <span class="game-emoji">🔫</span>룰렛
      </div>
      <div class="game-option" data-game="lottery" onclick="selectGame(this)">
        <span class="game-emoji">🎰</span>뽑기
      </div>
      <div class="game-option" data-game="ecard" onclick="selectGame(this)">
        <span class="game-emoji">👑</span>E카드
      </div>
      <div class="game-option" data-game="yahtzee" onclick="selectGame(this)">
        <span class="game-emoji">🎲</span>야추
      </div>
      <div class="game-option" data-game="updown" onclick="selectGame(this)">
        <span class="game-emoji">🃏</span>업다운
      </div>
      <div class="game-option" data-game="truth" onclick="selectGame(this)">
        <span class="game-emoji">⭕</span>진실게임
      </div>
    </div>
  </div>

  <div id="waitingMsg" style="text-align:center; color:var(--text-dim); font-size:13px; padding:16px 0;">
    <div class="spinner"></div>
    <div style="margin-top:8px;" id="waitingText">호스트가 게임을 시작하길 대기 중...</div>
  </div>
  <div id="connectionStatus" style="text-align:center; padding:8px; font-size:12px; border-radius:8px; margin-top:4px; display:none;"></div>
  </div>

  <div class="lobby-footer">
    <button class="btn btn-primary" id="startGameBtn" style="display:none;" onclick="startGame()">🎮 게임 시작</button>
  </div>
</div>

<!-- POKER -->
<div class="screen" id="pokerGame">
  <div class="pk-felt"></div>

  <div class="pk-content">
    <!-- Opponent area - top left, small -->
    <div class="pk-opponent-area" id="opponentsArea"></div>

    <!-- Community cards - top center -->
    <div class="pk-community" id="communityCards"></div>

    <!-- My cards - LARGE, center -->
    <div class="pk-my-area">
      <div class="pk-card-glow"></div>
      <div class="pk-my-cards" id="myCardsDisplay"></div>
      <div class="pk-hand-name" id="handRankDisplay"></div>
    </div>

    <!-- Right panel: money + actions -->
    <div class="pk-right-panel">
      <div class="pk-money-box">
        <div class="pk-money-row">
          <span class="pk-money-label">내 금액</span>
          <span class="pk-money-value" id="myChipsDisplay">0</span>
        </div>
        <div class="pk-money-row">
          <span class="pk-money-label">판돈</span>
          <span class="pk-money-value" id="potAmount">0</span>
        </div>
      </div>

      <div class="pk-raise-area" id="raiseSliderArea">
        <input type="range" class="pk-raise-slider" id="raiseSlider" min="0" max="1000" value="100">
        <div class="pk-raise-amount" id="raiseAmountDisplay">100</div>
        <button class="pk-raise-confirm" onclick="confirmRaise()">확인</button>
      </div>

      <div class="pk-actions" id="actionBar">
        <button class="pk-action-btn pk-btn-call" id="checkCallBtn" onclick="pokerAction('check')">체크</button>
        <button class="pk-action-btn pk-btn-raise" onclick="showRaiseSlider()">레이즈</button>
        <button class="pk-action-btn pk-btn-allin" onclick="pokerAction('allin')">올인</button>
        <button class="pk-action-btn pk-btn-fold" onclick="pokerAction('fold')">폴드</button>
      </div>
    </div>

    <!-- Round info + close -->
    <div class="pk-bottom-bar">
      <span class="pk-round-badge" id="roundDisplay">프리플랍</span>
      <button class="pk-close-btn" onclick="leaveGame()">✕</button>
    </div>
  </div>
</div>

<!-- MAFIA FULL VERSION -->
<div class="screen" id="mafiaGame">
  <!-- Top Bar -->
  <div class="mf-topbar">
    <div class="mf-topbar-left">
      <button class="mf-back-btn" onclick="mfLeaveGame()">✕</button>
      <div class="mf-phase-badge day" id="mfPhaseBadge">
        <span id="mfPhaseIcon">☀️</span>
        <span id="mfPhaseText">낮</span>
      </div>
    </div>
    <div class="mf-day-counter" id="mfDayCounter">1일차</div>
    <div class="mf-timer-box" id="mfTimerBox">
      <span>⏱</span>
      <span id="mfTimer">180</span>
    </div>
  </div>

  <!-- Role Banner -->
  <div class="mf-role-banner team-citizen" id="mfRoleBanner">
    <div class="mf-role-emoji" id="mfRoleEmoji">👤</div>
    <div class="mf-role-info">
      <div class="mf-role-name citizen-color" id="mfRoleName">시민</div>
      <div class="mf-role-desc" id="mfRoleDesc">마피아를 찾아 투표하세요</div>
    </div>
  </div>

  <!-- Main Scrollable Content -->
  <div class="mf-content" id="mfContent">
    <!-- Dynamic content injected by JS:
         - Player grid
         - Night action panel
         - Chat panel (mafia/spy)
         - Vote status panel
         - Events list
         - Spectator mode
         - Lover reveal
         etc.
    -->
  </div>

  <!-- Bottom Action Area -->
  <div class="mf-action-area" id="mfActionArea">
    <div class="mf-message-box" id="mfMessageBox"></div>
    <div class="mf-btn-row" id="mfBtnRow">
      <!-- Buttons injected dynamically -->
    </div>
  </div>

  <!-- Result Overlay (hidden by default) -->
  <div class="mf-result-overlay" id="mfResultOverlay" style="display:none;">
    <div class="mf-result-title" id="mfResultTitle"></div>
    <div class="mf-result-subtitle" id="mfResultSubtitle"></div>
    <div class="mf-result-roles" id="mfResultRoles"></div>
    <button class="mf-result-close-btn" onclick="mfCloseResult()">로비로 돌아가기</button>
  </div>
</div>

<!-- TRUTH GAME -->
<div class="screen" id="truthGame">
  <!-- 상단 바 -->
  <div class="truth-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="truth-round-display">
      <span class="truth-round-badge" id="truthRoundBadge">ROUND 1</span>
    </div>
    <div class="truth-questioner-display" id="truthQuestionerDisplay">질문자: ---</div>
  </div>

  <!-- 메인 콘텐츠 영역 -->
  <div class="truth-content">

    <!-- Phase: question (질문자 입력) -->
    <div class="truth-phase-area" id="truthQuestionInputArea" style="display:none;">
      <div class="truth-your-turn-badge">✨ 당신의 차례입니다</div>
      <div class="truth-question-box">
        <textarea
          class="truth-textarea"
          id="truthQuestionInput"
          placeholder="질문을 입력하세요...&#10;예: 여기서 OO를 이성적으로 좋아하는 사람이 있다?"
          maxlength="200"
          rows="3"
        ></textarea>
        <div class="truth-char-count"><span id="truthCharCount">0</span>/200</div>
      </div>
      <button class="btn btn-primary truth-submit-btn" onclick="submitTruthQuestion()">
        📨 질문 제출
      </button>
    </div>

    <!-- Phase: question (대기 화면 - 질문자가 아닌 경우) -->
    <div class="truth-phase-area" id="truthWaitQuestionArea" style="display:none;">
      <div class="truth-waiting-icon">🤔</div>
      <div class="truth-waiting-text" id="truthWaitingText">질문을 기다리는 중...</div>
      <div class="truth-waiting-sub" id="truthWaitingSubText">질문자가 질문을 작성하고 있습니다</div>
      <div class="truth-dots-loader">
        <span></span><span></span><span></span>
      </div>
    </div>

    <!-- Phase: voting (질문 표시 + O/X 투표) -->
    <div class="truth-phase-area" id="truthVotingArea" style="display:none;">
      <div class="truth-question-display">
        <div class="truth-question-label">Q.</div>
        <div class="truth-question-text" id="truthQuestionText">질문 내용</div>
      </div>

      <!-- 투표 버튼 영역 -->
      <div class="truth-vote-buttons" id="truthVoteButtons">
        <button class="truth-vote-btn truth-vote-o" id="truthBtnO" onclick="castTruthVote('O')">
          <span class="truth-vote-symbol">O</span>
          <span class="truth-vote-label">예</span>
        </button>
        <button class="truth-vote-btn truth-vote-x" id="truthBtnX" onclick="castTruthVote('X')">
          <span class="truth-vote-symbol">✕</span>
          <span class="truth-vote-label">아니오</span>
        </button>
      </div>

      <!-- 투표 완료 후 대기 -->
      <div class="truth-vote-waiting" id="truthVoteWaiting" style="display:none;">
        <div class="truth-voted-badge" id="truthVotedBadge">✅ 투표 완료</div>
        <div class="truth-vote-progress">
          <div class="truth-progress-bar">
            <div class="truth-progress-fill" id="truthProgressFill" style="width:0%"></div>
          </div>
          <div class="truth-progress-text" id="truthProgressText">투표 중... (0/0명 완료)</div>
        </div>
      </div>
    </div>

    <!-- Phase: result (결과 표시) -->
    <div class="truth-phase-area" id="truthResultArea" style="display:none;">
      <div class="truth-question-display truth-question-display-small">
        <div class="truth-question-label">Q.</div>
        <div class="truth-question-text" id="truthResultQuestionText">질문 내용</div>
      </div>

      <div class="truth-result-container">
        <div class="truth-result-title">투표 결과</div>

        <!-- O 결과 -->
        <div class="truth-result-row">
          <div class="truth-result-icon truth-result-icon-o">O</div>
          <div class="truth-result-info">
            <div class="truth-result-count" id="truthResultOCount">0명</div>
            <div class="truth-result-dots" id="truthResultODots"></div>
          </div>
        </div>

        <!-- X 결과 -->
        <div class="truth-result-row">
          <div class="truth-result-icon truth-result-icon-x">✕</div>
          <div class="truth-result-info">
            <div class="truth-result-count" id="truthResultXCount">0명</div>
            <div class="truth-result-dots" id="truthResultXDots"></div>
          </div>
        </div>

        <!-- 총원 -->
        <div class="truth-result-total" id="truthResultTotal">총 0명 참여</div>
      </div>

      <!-- 다음 질문 버튼 (질문자 또는 호스트) -->
      <button class="btn btn-accent2 truth-next-btn" id="truthNextBtn" onclick="truthNextRound()" style="display:none;">
        ➡️ 다음 질문
      </button>
      <div class="truth-next-waiting" id="truthNextWaiting" style="display:none;">
        다음 질문을 기다리는 중...
      </div>
    </div>

  </div>

  <!-- 하단 플레이어 표시 -->
  <div class="truth-players-bar" id="truthPlayersBar"></div>
</div>

<!-- QUICK DRAW GAME -->
<div class="screen" id="quickDrawGame">
  <div class="qd-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="qd-title">🤠 서부 총잡이</div>
    <div class="qd-round">라운드 <span id="qdRoundNum">1</span></div>
  </div>

  <div class="qd-main-area">
    <div class="qd-tap-zone" id="qdTapZone" onclick="qdTap()">
      <div class="qd-status-text" id="qdStatusText">준비...</div>
      <div class="qd-reaction-time" id="qdReactionTime"></div>
    </div>
  </div>

  <div class="qd-rankings">
    <div class="qd-rankings-title">순위</div>
    <div class="qd-rankings-list" id="qdRankingsList"></div>
  </div>

  <button class="btn btn-primary qd-restart-btn" id="qdRestartBtn" style="display:none;" onclick="restartQuickDraw()">다시 하기</button>
</div>

<!-- RUSSIAN ROULETTE -->
<div class="screen" id="rouletteGame">
  <div class="roulette-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="roulette-title">🔫 러시안 룰렛</div>
    <div class="roulette-survivors">
      <span id="rouletteSurvivors">6</span>/<span id="rouletteTotalPlayers">6</span>
    </div>
  </div>

  <!-- 게임 시작 전 설정 (호스트만) -->
  <div class="roulette-setup" id="rouletteSetup" style="display:none;">
    <div class="setup-card">
      <div class="setup-label">총알 개수</div>
      <div class="setup-slider-row">
        <input type="range" class="setup-slider" id="bulletsSlider" min="1" max="3" value="1">
        <div class="setup-value" id="bulletsValue">1</div>
      </div>
    </div>
    <div class="setup-card">
      <div class="setup-label">실린더 칸 수</div>
      <div class="setup-slider-row">
        <input type="range" class="setup-slider" id="chambersSlider" min="6" max="8" value="6">
        <div class="setup-value" id="chambersValue">6</div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="confirmRouletteSetup()" style="margin-top:12px;">설정 완료 및 시작</button>
  </div>

  <!-- 실린더 시각화 -->
  <div class="cylinder-area">
    <div class="current-turn-display" id="currentTurnDisplay">
      <span id="currentTurnName">플레이어</span>의 차례
    </div>

    <div class="cylinder-container">
      <div class="cylinder" id="cylinder">
        <!-- 동적 생성: 6~8개 칸 -->
      </div>
      <div class="cylinder-center">🎯</div>
    </div>

    <div class="cylinder-info" id="cylinderInfo">
      실린더를 돌려주세요
    </div>
  </div>

  <!-- 생존자 리스트 -->
  <div class="survivors-list" id="survivorsList">
    <!-- 동적 생성 -->
  </div>

  <!-- 액션 버튼 -->
  <div class="roulette-actions" id="rouletteActions">
    <button class="btn btn-secondary" id="spinBtn" onclick="spinCylinder()" style="display:none;">
      🔄 실린더 돌리기
    </button>
    <button class="btn btn-danger" id="triggerBtn" onclick="pullTrigger()" style="display:none;">
      💥 방아쇠 당기기
    </button>
    <button class="btn btn-primary" id="restartBtn" onclick="restartRoulette()" style="display:none;">
      🔁 다시 하기
    </button>
  </div>
</div>

<!-- 결과 플래시 오버레이 -->
<div class="roulette-flash" id="rouletteFlash">
  <div class="flash-content" id="flashContent">
    <div class="flash-icon" id="flashIcon">💥</div>
    <div class="flash-text" id="flashText">탕!</div>
  </div>
</div>

<!-- LOTTERY & ROULETTE GAME -->
<div class="screen" id="lotteryGame">
  <!-- Top Bar -->
  <div class="lottery-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="lottery-title">🎰 뽑기 & 룰렛</div>
    <div style="width:40px;"></div>
  </div>

  <!-- Mode Tabs -->
  <div class="mode-tabs">
    <div class="mode-tab active" data-mode="lottery" onclick="switchLotteryMode('lottery')">
      📋 종이뽑기
    </div>
    <div class="mode-tab" data-mode="roulette" onclick="switchLotteryMode('roulette')">
      🎡 룰렛
    </div>
  </div>

  <!-- LOTTERY MODE -->
  <div class="lottery-mode-container" id="lotteryModeContainer">
    <!-- Setup Panel (Host Only) -->
    <div class="lottery-setup-panel" id="lotterySetupPanel" style="display:none;">
      <div class="setup-title">🎯 뽑기 항목 설정 (호스트만 가능)</div>
      <textarea class="lottery-items-input" id="lotteryItemsInput" placeholder="항목을 줄바꿈으로 구분하여 입력하세요&#10;예:&#10;당첨!&#10;꽝&#10;벌칙: 원샷&#10;벌칙: 춤추기&#10;행운!&#10;다시 뽑기"></textarea>
      <div class="setup-row">
        <label style="color:var(--text);font-size:14px;font-weight:700;">칸 개수:</label>
        <select class="grid-size-select" id="gridSizeSelect">
          <option value="4">4x4 (16칸)</option>
          <option value="5">5x5 (25칸)</option>
          <option value="6">6x6 (36칸)</option>
          <option value="8">8x8 (64칸)</option>
          <option value="10" selected>10x10 (100칸)</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="startLotteryGame()">🎮 뽑기 시작</button>
    </div>

    <!-- Lottery Grid -->
    <div class="lottery-grid-container" id="lotteryGridContainer" style="display:none;">
      <div class="lottery-status">
        <div class="status-text">🎯 칸을 터치하여 뽑기!</div>
        <div class="picked-count">뽑은 개수: <span id="pickedCount">0</span> / <span id="totalCount">100</span></div>
      </div>
      <div class="lottery-grid" id="lotteryGrid"></div>
    </div>

    <!-- My Result Display -->
    <div class="my-result-panel" id="myLotteryResult" style="display:none;">
      <div class="result-label">🎁 내가 뽑은 결과</div>
      <div class="result-list" id="myResultList"></div>
    </div>
  </div>

  <!-- ROULETTE MODE -->
  <div class="roulette-mode-container" id="rouletteModeContainer" style="display:none;">
    <!-- Setup Panel (Host Only) -->
    <div class="roulette-setup-panel" id="rouletteSetupPanel" style="display:none;">
      <div class="setup-title">🎡 룰렛 항목 설정 (호스트만 가능)</div>
      <textarea class="lottery-items-input" id="rouletteItemsInput" placeholder="룰렛 항목을 줄바꿈으로 구분 (2~12개)&#10;예:&#10;당첨!&#10;벌칙 1&#10;꽝&#10;원샷&#10;행운&#10;다시!"></textarea>
      <button class="btn btn-primary" onclick="startRouletteGame()">🎡 룰렛 시작</button>
    </div>

    <!-- Roulette Display -->
    <div class="roulette-display-container" id="rouletteDisplayContainer" style="display:none;">
      <div class="roulette-status">
        <div class="status-text">🎰 돌리기 버튼을 눌러주세요!</div>
      </div>

      <div class="roulette-wheel-container">
        <div class="roulette-pointer">▼</div>
        <div class="roulette-wheel" id="rouletteWheel">
          <canvas id="rouletteCanvas" width="300" height="300"></canvas>
        </div>
      </div>

      <button class="btn btn-primary roulette-spin-btn" id="rouletteSpinBtn" onclick="spinRoulette()">
        🎡 돌리기!
      </button>

      <!-- Result Display -->
      <div class="roulette-result-display" id="rouletteResultDisplay" style="display:none;">
        <div class="result-emoji">🎉</div>
        <div class="result-text" id="rouletteResultText">당첨!</div>
      </div>
    </div>
  </div>
</div>

<!-- ========================================= -->
<!-- UP DOWN GAME -->
<!-- ========================================= -->
<div class="screen" id="updownGame">
  <div class="ud-felt"></div>

  <div class="ud-content">
    <!-- Top bar: compact -->
    <div class="ud-top-bar">
      <div class="ud-turn-name" id="updownTurnName">플레이어</div>
      <div class="ud-deck-count" id="updownDeckCount">남은 카드: 52</div>
      <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    </div>

    <!-- Cards area: previous (small) + current (hero) -->
    <div class="ud-cards-area">
      <div class="ud-prev-slot" id="updownPrevCard">
        <div class="ud-card-label">이전</div>
        <div class="ud-prev-placeholder"></div>
      </div>

      <div class="ud-hero-slot" id="updownCurrentCard">
        <div class="ud-card-label">현재 카드</div>
        <div class="ud-hero-card ud-card-back">
          <div class="ud-hero-inner">
            <div class="ud-hero-back-pattern"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Result text -->
    <div class="ud-result" id="updownResult"></div>

    <!-- Bottom panel: buttons + bet + penalty -->
    <div class="ud-bottom-panel">
      <div class="ud-choice-buttons" id="updownChoiceButtons">
        <button class="ud-btn ud-btn-up" onclick="udChoice('up')">
          <span class="ud-btn-arrow">&#9650;</span>
          <span class="ud-btn-label">UP</span>
        </button>
        <button class="ud-btn ud-btn-down" onclick="udChoice('down')">
          <span class="ud-btn-label">DOWN</span>
          <span class="ud-btn-arrow">&#9660;</span>
        </button>
      </div>

      <div class="ud-bet-area">
        <input type="text" class="ud-bet-input" id="updownBetInput" placeholder="벌칙 내용 입력..." maxlength="30">
        <button class="ud-btn-bet" onclick="udAddBet()">+Bet</button>
      </div>

      <div class="ud-penalty-list" id="updownPenaltyList">
        <div class="ud-penalty-header">벌칙 목록</div>
        <div id="updownPenaltyItems"></div>
      </div>
    </div>
  </div>

  <!-- Special Card Areas -->
  <div class="ud-special-area ud-special-jq" id="updownSpecialJQ" style="display:none;">
    <div class="ud-special-title">흑기사 요청</div>
    <div class="ud-special-desc">다른 플레이어에게 벌칙을 대신 받을 것을 요청할 수 있습니다. 거절하면 나머지 모두가 벌칙!</div>
    <div class="ud-player-select" id="updownJQPlayerSelect"></div>
    <button class="ud-btn-special" onclick="udBlackKnight()">흑기사 요청</button>
  </div>

  <div class="ud-special-area ud-special-k" id="updownSpecialK" style="display:none;">
    <div class="ud-special-title">왕의 명령</div>
    <div class="ud-special-desc">3명에게 벌칙을 내릴 수 있습니다!</div>
    <div class="ud-player-select" id="updownKPlayerSelect"></div>
    <button class="ud-btn-special ud-btn-king" onclick="udKingPenalty()">왕 벌칙 부여</button>
  </div>

  <!-- Penalty Modal -->
  <div class="ud-penalty-modal" id="updownPenaltyModal">
    <div class="ud-penalty-content">
      <div class="ud-penalty-title">벌칙!</div>
      <div class="ud-penalty-text" id="updownPenaltyText">소주 1잔</div>
      <div class="ud-penalty-who" id="updownPenaltyWho">플레이어님의 차례</div>
      <button class="ud-btn-accept" onclick="udAcceptPenalty()">수행하기</button>
      <button class="ud-btn-reject" onclick="udRejectPenalty()">거절 (술 마시기)</button>
    </div>
  </div>

  <!-- Black Knight Request Modal -->
  <div class="ud-penalty-modal" id="updownBKModal">
    <div class="ud-penalty-content">
      <div class="ud-penalty-title">흑기사 요청</div>
      <div class="ud-penalty-text" id="updownBKText">벌칙 내용</div>
      <div class="ud-penalty-who" id="updownBKWho">누가 요청했습니다</div>
      <button class="ud-btn-accept" onclick="udAcceptBK()">수락 (대신 받기)</button>
      <button class="ud-btn-reject" onclick="udRejectBK()">거절 (나머지 모두 벌칙)</button>
    </div>
  </div>
</div>

<!-- ============================== -->
<!-- YAHTZEE GAME -->
<!-- ============================== -->
<div class="screen" id="yahtzeeGame">
  <div class="yahtzee-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <div class="yahtzee-turn-info">
      <div class="yahtzee-turn-text" id="yahTurnText">턴 1/13</div>
      <div class="yahtzee-current-player" id="yahCurrentPlayer">플레이어 차례</div>
    </div>
    <div class="yahtzee-rolls-left" id="yahRollsLeft">3 left</div>
  </div>

  <div class="yahtzee-players-bar" id="yahtzeePlayersBar">
  </div>

  <div class="yahtzee-dice-area">
    <!-- Three.js 3D viewport (left) -->
    <div id="yahtzeeThreeContainer">
      <canvas id="yahtzeeCanvas"></canvas>
      <div class="yahtzee-combo-label" id="yahtzeeComboLabel"></div>
    </div>

    <!-- Controls panel (right side) -->
    <div class="yahtzee-controls-panel">
      <div class="yahtzee-controls-title">DICE</div>
      <div class="yahtzee-hold-bar" id="yahtzeeHoldBar">
        <!-- Dynamically populated: clickable held-die elements -->
      </div>
      <div class="yahtzee-roll-hint">탭하여 선택/해제</div>
      <div class="yahtzee-rolls-indicator" id="yahtzeeRollsIndicator">
        <span class="roll-pip active"></span>
        <span class="roll-pip active"></span>
        <span class="roll-pip active"></span>
      </div>
      <button class="btn btn-primary yahtzee-roll-btn" id="yahtzeeRollBtn" onclick="yahRoll()">주사위 굴리기</button>
    </div>
  </div>

  <div class="yahtzee-scorecard-area">
    <div class="yahtzee-scorecard-title">점수표</div>
    <div class="yahtzee-scorecard" id="yahtzeeScorecard">
      <!-- Dynamically generated by renderYahtzeeScorecard() -->
    </div>
    <button class="btn yahtzee-score-btn" id="yahtzeeScoreBtn" onclick="yahScore()" style="display:none;">점수 확정</button>
  </div>

  <div class="yahtzee-game-over" id="yahtzeeGameOver" style="display:none;">
    <div class="yahtzee-final-scores">
      <div class="yahtzee-final-title">게임 종료!</div>
      <div class="yahtzee-rankings" id="yahtzeeRankings">
      </div>
    </div>
    <button class="btn btn-primary" onclick="closeYahtzeeGame()" style="max-width:280px;">대기실로</button>
  </div>
</div>


<!-- ===== E CARD GAME ===== -->
<div class="screen" id="ecardGame">
  <!-- Compact Header: combines top bar + score + role + opponent -->
  <div class="ecard-compact-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <div class="ecard-header-round">R<span id="ecardRound">1</span>/5</div>
    <div class="ecard-header-score">
      <span class="ecard-hscore-emperor">&#128081;</span>
      <span class="ecard-hscore-val" id="ecardScoreEmperor">0</span>
      <span class="ecard-hscore-div">:</span>
      <span class="ecard-hscore-val" id="ecardScoreSlave">0</span>
      <span class="ecard-hscore-slave">&#9939;&#65039;</span>
    </div>
    <div class="ecard-header-role" id="ecardRoleBadge">
      <span id="ecardRoleIcon">&#128081;</span>
      <span id="ecardRoleName">황제</span>
    </div>
    <div class="ecard-header-opp">
      <div class="opponent-avatar" id="ecardOppAvatar" style="background: linear-gradient(135deg, #00e5ff, #00b8d4);">&#128526;</div>
      <span class="opponent-name" id="ecardOppName">상대</span>
      <span class="opponent-cards-count"><span id="ecardOppCardsCount">5</span>장</span>
      <div class="opponent-played-card" id="ecardOppPlayedCard"></div>
    </div>
  </div>

  <!-- Result / Status Text -->
  <div class="ecard-result-text" id="ecardResultText"></div>

  <!-- My Cards Area - takes most of the screen -->
  <div class="ecard-my-cards-area">
    <div class="my-cards-label">내 카드 (<span id="ecardMyCardsCount">5</span>장)</div>
    <div class="ecard-cards-hand" id="ecardMyCards"></div>
  </div>

  <!-- Battle Overlay (absolute positioned) -->
  <div class="ecard-battle-overlay" id="ecardBattleArea" style="display:none;">
    <div class="ecard-battle-inner">
      <div class="battle-card" id="ecardBattleOpp"></div>
      <div class="battle-vs">VS</div>
      <div class="battle-card" id="ecardBattleMy"></div>
    </div>
  </div>

  <!-- Betting Area -->
  <div class="ecard-bet-area" id="ecardBetArea" style="display:none;">
    <div class="bet-label">배팅 금액 제안</div>
    <div class="bet-controls">
      <input type="range" class="bet-slider" id="ecardBetSlider" min="10" max="500" value="100" step="10">
      <div class="bet-amount" id="ecardBetAmount">100</div>
    </div>
    <button class="btn btn-primary" id="ecardBetSubmit" onclick="ecardSubmitBet()">배팅 제안</button>
  </div>

  <!-- Bet Response -->
  <div class="ecard-bet-response" id="ecardBetResponse" style="display:none;">
    <div class="bet-proposal">상대방이 <span id="ecardBetProposed">100</span> 배팅을 제안했습니다</div>
    <div class="bet-buttons">
      <button class="btn btn-secondary" onclick="ecardRejectBet()">거절</button>
      <button class="btn btn-primary" onclick="ecardAcceptBet()">수락</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="ecard-action-buttons" id="ecardActionButtons">
    <button class="btn btn-primary" id="ecardSubmitBtn" onclick="ecardSubmitCard()" disabled>카드 제출</button>
  </div>

  <!-- Waiting -->
  <div class="ecard-waiting" id="ecardWaiting" style="display:none;">
    <div class="spinner"></div>
    <div style="margin-top:8px;font-size:14px;color:var(--text-dim);" id="ecardWaitingText">상대방을 기다리는 중...</div>
  </div>
</div>

<!-- SUTDA GAME -->
<div class="screen" id="sutdaGame">
  <!-- 상단 바 -->
  <div class="sutda-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <div class="sutda-title-area">
      <span class="sutda-title-text">장땡 섯다</span>
      <span class="sutda-pot-badge" id="sutdaPotBadge">0</span>
    </div>
    <div class="sutda-my-balance" id="sutdaMyBalance">0</div>
  </div>

  <!-- 상대방 영역 -->
  <div class="sutda-opponents" id="sutdaOpponents"></div>

  <!-- 테이블 중앙 -->
  <div class="sutda-table">
    <div class="sutda-table-felt">
      <div class="sutda-pot-center">
        <div class="sutda-pot-label">판돈</div>
        <div class="sutda-pot-amount" id="sutdaPotAmount">0</div>
      </div>
      <div class="sutda-turn-indicator" id="sutdaTurnIndicator"></div>
    </div>
  </div>

  <!-- 내 패 영역 -->
  <div class="sutda-my-area">
    <div class="sutda-my-info">
      <div class="sutda-my-name" id="sutdaMyName">나</div>
      <div class="sutda-my-chips" id="sutdaMyChips">0</div>
    </div>
    <div class="sutda-my-cards" id="sutdaMyCards"></div>
    <div class="sutda-my-rank" id="sutdaMyRank"></div>
  </div>

  <!-- 세륙 선택 패널 -->
  <div class="sutda-seryuk-panel" id="sutdaSeryukPanel" style="display:none;">
    <div class="sutda-seryuk-title">세륙 (6+4) 선택</div>
    <div class="sutda-seryuk-desc">밀기: 10끗으로 계산 | 깽판: 패 재분배</div>
    <div class="sutda-seryuk-buttons">
      <button class="sutda-seryuk-btn sutda-seryuk-push" onclick="sutdaSeryukChoice('push')">
        <span class="sutda-seryuk-icon">&#x1F4AA;</span>
        <span>밀기</span>
        <span class="sutda-seryuk-sub">10끗</span>
      </button>
      <button class="sutda-seryuk-btn sutda-seryuk-chaos" onclick="sutdaSeryukChoice('chaos')">
        <span class="sutda-seryuk-icon">&#x1F300;</span>
        <span>깽판</span>
        <span class="sutda-seryuk-sub">패 재분배</span>
      </button>
    </div>
  </div>

  <!-- 배팅 버튼 -->
  <div class="sutda-action-bar" id="sutdaActionBar">
    <button class="sutda-bet-btn sutda-bet-10k" onclick="sutdaBet('raise',10000)" id="sutdaBtn10k">+1만</button>
    <button class="sutda-bet-btn sutda-bet-50k" onclick="sutdaBet('raise',50000)" id="sutdaBtn50k">+5만</button>
    <button class="sutda-bet-btn sutda-bet-100k" onclick="sutdaBet('raise',100000)" id="sutdaBtn100k">+10만</button>
    <button class="sutda-bet-btn sutda-bet-call" onclick="sutdaBet('call',0)" id="sutdaBtnCall">콜</button>
    <button class="sutda-bet-btn sutda-bet-die" onclick="sutdaBet('die',0)" id="sutdaBtnDie">다이</button>
    <button class="sutda-bet-btn sutda-bet-allin" onclick="sutdaBet('allin',0)" id="sutdaBtnAllin">올인</button>
  </div>

  <!-- 결과 오버레이 -->
  <div class="sutda-result-overlay" id="sutdaResultOverlay">
    <div class="sutda-result-box">
      <div class="sutda-result-title" id="sutdaResultTitle">승리!</div>
      <div class="sutda-result-winner" id="sutdaResultWinner"></div>
      <div class="sutda-result-rank" id="sutdaResultRank"></div>
      <div class="sutda-result-cards" id="sutdaResultCards"></div>
      <div class="sutda-result-pot" id="sutdaResultPot"></div>
      <div class="sutda-result-all-hands" id="sutdaResultAllHands"></div>
      <button class="btn btn-primary" onclick="closeSutdaResult()" style="margin-top:16px;">확인</button>
    </div>
  </div>
</div>


<!-- RESULT -->
<div class="result-overlay" id="resultOverlay">
  <div class="result-title" id="resultTitle">🏆 승리!</div>
  <div class="winner-info">
    <div id="winnerName" style="font-size:20px;font-weight:900;"></div>
    <div class="result-cards" id="resultCards"></div>
    <div class="result-hand" id="resultHand"></div>
    <div class="result-pot" id="resultPot"></div>
  </div>
  <button class="btn btn-primary" onclick="closeResult()" style="max-width:280px;">다음 라운드</button>
</div>

<!-- QR Code library -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="js/core.js"></script>
<script src="js/games/poker.js"></script>
<script src="js/games/mafia.js"></script>
<script src="js/games/truth.js"></script>
<script src="js/games/quickdraw.js"></script>
<script src="js/games/roulette.js"></script>
<script src="js/games/lottery.js"></script>
<script src="js/games/updown.js"></script>
<script src="js/games/yahtzee.js"></script>
<script src="js/games/ecard.js"></script>
<script src="js/games/sutda.js"></script>
<script src="js/ai.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="js/yahtzee-three.js"></script>
</body>
</html>
