<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover">
<title>파티덱 - P2P 미니게임</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a0a12">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700;900&family=Oswald:wght@500;600;700&family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/games/mafia.css?v=3">
<link rel="stylesheet" href="css/games/truth.css">
<link rel="stylesheet" href="css/games/quickdraw.css">
<link rel="stylesheet" href="css/games/roulette.css">
<link rel="stylesheet" href="css/games/lottery.css">
<link rel="stylesheet" href="css/games/updown.css">
<link rel="stylesheet" href="css/games/yahtzee.css">
<link rel="stylesheet" href="css/games/ecard.css">
<link rel="stylesheet" href="css/games/sutda.css">
<link rel="stylesheet" href="css/games/fortress.css?v=7">
<link rel="stylesheet" href="css/games/bombshot.css">
<link rel="stylesheet" href="css/games/stairs.css">
<link rel="stylesheet" href="css/games/tetris.css">
<link rel="stylesheet" href="css/games/jewel.css">
<link rel="stylesheet" href="css/games/colorchain.css">
<link rel="stylesheet" href="css/games/mobile.css">
</head>
<body>

<div class="toast" id="toast"></div>

<!-- LOADING -->
<div class="screen active" id="loadingScreen">
  <div class="logo-icon">🎲</div>
  <div class="logo-title">파티덱</div>
  <div class="loading-text" id="loadingText">연결 준비 중...</div>
  <div class="loading-bar"><div class="loading-bar-inner" id="loadingBar"></div></div>
</div>

<!-- MAIN MENU -->
<div class="screen" id="mainMenu">
  <div class="logo-area">
    <div class="logo-icon">🎲</div>
    <div class="logo-title">파티덱</div>
    <div class="logo-sub">서버 없이 즐기는 P2P 미니게임</div>
  </div>

  <div class="menu-card">
    <div class="profile-section">
      <div class="avatar" id="myAvatar" onclick="cycleAvatar()">😎</div>
      <div class="profile-info">
        <input class="input-field" id="nameInput" placeholder="닉네임 입력" maxlength="8" style="padding:10px 12px; font-size:15px; font-weight:700;">
        <div class="profile-stats" id="profileStats">전적 로딩 중...</div>
      </div>
    </div>

    <div class="economy-bar">
      <div class="eco-item eco-gold"><span class="eco-icon">🪙</span><span class="eco-value" id="mmGold">0</span></div>
      <div class="eco-item eco-energy"><span class="eco-icon">⚡</span><span class="eco-value" id="mmEnergy">0/10</span><span class="eco-countdown" id="energyCountdown">MAX</span></div>
      <div class="eco-item eco-diamond"><span class="eco-icon">💎</span><span class="eco-value" id="mmDiamond">0</span></div>
    </div>
  </div>

  <button class="btn btn-primary" onclick="createRoom()">🏠 방 만들기</button>

  <div class="join-row">
    <input class="input-field" id="joinCodeInput" placeholder="방 코드 입력" maxlength="6" style="text-transform:uppercase; text-align:center; letter-spacing:4px; font-weight:700; flex:1;">
    <button class="btn btn-accent2 btn-small" onclick="joinRoom()" style="width:auto; padding:14px 20px;">참가</button>
  </div>

  <button class="btn btn-accent2" onclick="startPracticeMode()" style="max-width:380px;">🤖 연습 모드 (AI 대전)</button>

  <button class="btn btn-secondary" onclick="shareApp()" style="max-width:380px;">📱 앱 공유 (QR 코드)</button>

  <!-- Debug Preview Toggle -->
  <button class="btn btn-debug-toggle" id="debugToggleBtn" onclick="toggleDebugMode()">🛠 디버그 미리보기</button>
  <div class="debug-game-selector" id="debugGameSelector" style="display:none;">
    <div class="debug-selector-title">게임 선택 (1인 미리보기)</div>
    <div class="debug-game-grid">
      <button class="debug-game-btn" onclick="debugGame('poker')">🃏 포커</button>
      <button class="debug-game-btn" onclick="debugGame('mafia')">🕵️ 마피아</button>
      <button class="debug-game-btn" onclick="debugGame('sutda')">🎴 섯다</button>
      <button class="debug-game-btn" onclick="debugGame('quickdraw')">🤠 총잡이</button>
      <button class="debug-game-btn" onclick="debugGame('roulette')">🔫 룰렛</button>
      <button class="debug-game-btn" onclick="debugGame('lottery')">🎰 뽑기</button>
      <button class="debug-game-btn" onclick="debugGame('ecard')">👑 E카드</button>
      <button class="debug-game-btn" onclick="debugGame('yahtzee')">🎲 야추</button>
      <button class="debug-game-btn" onclick="debugGame('updown')">🃏 업다운</button>
      <button class="debug-game-btn" onclick="debugGame('truth')">⭕ 진실게임</button>
      <button class="debug-game-btn" onclick="debugGame('fortress')">🏰 요새</button>
      <button class="debug-game-btn" onclick="debugGame('stairs')">🪜 무한계단</button>
      <button class="debug-game-btn" onclick="debugGame('tetris')">🧩 테트리스</button>
      <button class="debug-game-btn" onclick="debugGame('jewel')">💎 보석맞추기</button>
      <button class="debug-game-btn" onclick="debugGame('colorchain')">🔗 컬러체인</button>
    </div>
  </div>

  <div class="ad-banner">📢 광고 영역 (AdSense / AdMob)</div>

  <div id="buildFooter" class="build-footer"></div>
</div>

<!-- PRACTICE MODE SELECT -->
<div class="screen" id="practiceSelect">
  <div class="lobby-header">
    <button class="back-btn" onclick="leavePracticeMode()">←</button>
    <div style="font-family:'Black Han Sans'; font-size:20px;">🤖 연습 모드</div>
    <div style="width:40px;"></div>
  </div>
  <div class="practice-content">
    <div class="practice-desc">AI 상대와 연습 플레이</div>
    <div class="practice-game-grid">
      <button class="practice-game-btn" onclick="startPracticeGame('poker')">🃏 포커</button>
      <button class="practice-game-btn" onclick="startPracticeGame('mafia')">🕵️ 마피아</button>
      <button class="practice-game-btn" onclick="startPracticeGame('sutda')">🎴 섯다</button>
      <button class="practice-game-btn" onclick="startPracticeGame('quickdraw')">🤠 총잡이</button>
      <button class="practice-game-btn" onclick="startPracticeGame('roulette')">🔫 룰렛</button>
      <button class="practice-game-btn" onclick="startPracticeGame('lottery')">🎰 뽑기</button>
      <button class="practice-game-btn" onclick="startPracticeGame('ecard')">👑 E카드</button>
      <button class="practice-game-btn" onclick="startPracticeGame('yahtzee')">🎲 야추</button>
      <button class="practice-game-btn" onclick="startPracticeGame('updown')">🃏 업다운</button>
      <button class="practice-game-btn" onclick="startPracticeGame('truth')">⭕ 진실게임</button>
      <button class="practice-game-btn" onclick="startPracticeGame('fortress')">🏰 요새</button>
      <button class="practice-game-btn" onclick="startPracticeGame('bombshot')">🍺 폭탄주</button>
      <button class="practice-game-btn" onclick="startPracticeGame('stairs')">🪜 무한계단</button>
      <button class="practice-game-btn" onclick="startPracticeGame('tetris')">🧩 테트리스</button>
      <button class="practice-game-btn" onclick="startPracticeGame('jewel')">💎 보석맞추기</button>
      <button class="practice-game-btn" onclick="startPracticeGame('colorchain')">🔗 컬러체인</button>
    </div>
  </div>
</div>

<!-- LOBBY -->
<div class="screen" id="lobby">
  <div class="lobby-header">
    <button class="back-btn" onclick="leaveLobby()">←</button>
    <div style="font-family:'Black Han Sans'; font-size:20px;">대기실</div>
    <div style="width:40px;"></div>
  </div>

  <div class="lobby-content">
    <div class="lobby-currency-bar">
      <div class="eco-item eco-gold eco-sm"><span class="eco-icon">🪙</span><span class="eco-value" id="lobbyGold">0</span></div>
      <div class="eco-item eco-energy eco-sm"><span class="eco-icon">⚡</span><span class="eco-value" id="lobbyEnergy">0/10</span></div>
    </div>
    <div class="room-code-display">
      <div class="room-code-label">방 코드를 친구에게 공유하세요</div>
      <div class="room-code" id="roomCodeDisplay" onclick="copyRoomCode()">------</div>
      <div class="room-code-hint">탭하여 복사</div>
      <div class="share-btn-row">
        <button class="share-btn" onclick="copyRoomCode()">📋 코드 복사</button>
        <button class="share-btn" onclick="shareLink()">🔗 링크 공유</button>
      </div>
      <div id="qrCodeDisplay" style="margin:8px auto;width:100px;height:100px;"></div>
    </div>

  <div class="players-section">
    <div class="players-title">플레이어 (<span id="playerCount">0</span>/14)</div>
    <div class="player-list" id="playerList"></div>
  </div>

  <div class="game-select" id="gameSelectArea" style="display:none;">
    <div class="game-select-title">게임 선택 (호스트만 가능)</div>
    <div class="game-options">
      <div class="game-option selected" data-game="poker" onclick="selectGame(this)">
        <span class="game-emoji">🃏</span>포커
      </div>
      <div class="game-option" data-game="mafia" onclick="selectGame(this)">
        <span class="game-emoji">🕵️</span>마피아
      </div>
      <div class="game-option" data-game="sutda" onclick="selectGame(this)">
        <span class="game-emoji">🎴</span>섯다
      </div>
      <div class="game-option" data-game="quickdraw" onclick="selectGame(this)">
        <span class="game-emoji">🤠</span>총잡이
      </div>
      <div class="game-option" data-game="roulette" onclick="selectGame(this)">
        <span class="game-emoji">🔫</span>룰렛
      </div>
      <div class="game-option" data-game="lottery" onclick="selectGame(this)">
        <span class="game-emoji">🎰</span>뽑기
      </div>
      <div class="game-option" data-game="ecard" onclick="selectGame(this)">
        <span class="game-emoji">👑</span>E카드
      </div>
      <div class="game-option" data-game="yahtzee" onclick="selectGame(this)">
        <span class="game-emoji">🎲</span>야추
      </div>
      <div class="game-option" data-game="updown" onclick="selectGame(this)">
        <span class="game-emoji">🃏</span>업다운
      </div>
      <div class="game-option" data-game="truth" onclick="selectGame(this)">
        <span class="game-emoji">⭕</span>진실게임
      </div>
      <div class="game-option" data-game="fortress" onclick="selectGame(this)">
        <span class="game-emoji">🏰</span>요새
      </div>
      <div class="game-option" data-game="bombshot" onclick="selectGame(this)">
        <span class="game-emoji">🍺</span>폭탄주
      </div>
      <div class="game-option" data-game="stairs" onclick="selectGame(this)">
        <span class="game-emoji">🪜</span>무한계단
      </div>
      <div class="game-option" data-game="tetris" onclick="selectGame(this)">
        <span class="game-emoji">🧩</span>테트리스
      </div>
      <div class="game-option" data-game="jewel" onclick="selectGame(this)">
        <span class="game-emoji">💎</span>보석맞추기
      </div>
      <div class="game-option" data-game="colorchain" onclick="selectGame(this)">
        <span class="game-emoji">🔗</span>컬러체인
      </div>
    </div>
    <div class="game-info-panel" id="gameInfoPanel" style="display:none;margin-top:8px;padding:10px 12px;background:rgba(255,255,255,0.05);border-radius:10px;border:1px solid rgba(255,255,255,0.1);">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
        <span id="gameInfoEmoji" style="font-size:24px;"></span>
        <span id="gameInfoName" style="font-size:16px;font-weight:700;color:#fff;"></span>
      </div>
      <div id="gameInfoDesc" style="font-size:12px;color:#aaa;line-height:1.5;margin-bottom:6px;"></div>
      <div style="display:flex;gap:12px;font-size:11px;color:#888;">
        <span id="gameInfoPlayers"></span>
        <span id="gameInfoTime"></span>
        <span id="gameInfoType"></span>
      </div>
    </div>
  </div>

  <!-- Mafia: Host setup button + config display for all players -->
  <div id="mfLobbyArea" style="display:none;">
    <button class="btn mf-lobby-setup-btn" id="mfSetupBtn" style="display:none;" onclick="mfOpenSetup()">🎭 직업 설정</button>
    <div id="mfConfigDisplay" class="mf-config-display" style="display:none;">
      <!-- Populated dynamically by mfShowConfigInLobby() -->
    </div>
  </div>

  <!-- Bombshot: Host penalty setup + config display for all -->
  <div id="bsLobbyArea" style="display:none;">
    <button class="btn mf-lobby-setup-btn" id="bsSetupBtn" style="display:none;" onclick="bsOpenSetup()">🍺 벌칙 설정</button>
    <div id="bsConfigDisplay" class="mf-config-display" style="display:none;"></div>
  </div>

  <div id="waitingMsg" style="text-align:center; color:var(--text-dim); font-size:13px; padding:16px 0;">
    <div class="spinner"></div>
    <div style="margin-top:8px;" id="waitingText">호스트가 게임을 시작하길 대기 중...</div>
  </div>
  <div id="connectionStatus" style="text-align:center; padding:8px; font-size:12px; border-radius:8px; margin-top:4px; display:none;"></div>
  </div>

  <div class="lobby-footer">
    <button class="btn btn-primary" id="startGameBtn" style="display:none;" onclick="startGame()">🎮 게임 시작</button>
  </div>
</div>

<!-- POKER -->
<div class="screen" id="pokerGame">
  <div class="pk-felt"></div>

  <div class="pk-content">
    <!-- Top bar: money info + round + close -->
    <div class="pk-top-bar">
      <div class="pk-top-info">
        <div class="pk-chip-display">
          <span class="pk-chip-icon">🪙</span>
          <span class="pk-chip-value" id="myChipsDisplay">0</span>
        </div>
        <div class="pk-pot-display">
          <span class="pk-pot-label">POT</span>
          <span class="pk-pot-value" id="potAmount">0</span>
        </div>
      </div>
      <span class="pk-round-badge" id="roundDisplay">프리플랍</span>
      <button class="pk-hand-btn" onclick="toggleHandRanking('poker')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">족보</button>
      <button class="pk-close-btn" onclick="leaveGame()">✕</button>
    </div>

    <!-- Opponent area - top left, small -->
    <div class="pk-opponent-area" id="opponentsArea"></div>

    <!-- Community cards - top center -->
    <div class="pk-community" id="communityCards"></div>

    <!-- My cards - LARGE, center -->
    <div class="pk-my-area">
      <div class="pk-card-glow"></div>
      <div class="pk-my-cards" id="myCardsDisplay"></div>
      <div class="pk-hand-name" id="handRankDisplay"></div>
    </div>

    <!-- Bottom: actions / raise -->
    <div class="pk-bottom-panel">
      <div class="pk-actions" id="actionBar">
        <button class="pk-action-btn pk-btn-call" id="checkCallBtn" onclick="pokerAction('check')">체크</button>
        <button class="pk-action-btn pk-btn-raise" onclick="showRaiseSlider()">레이즈</button>
        <button class="pk-action-btn pk-btn-allin" onclick="pokerAction('allin')">올인</button>
        <button class="pk-action-btn pk-btn-fold" onclick="pokerAction('fold')">폴드</button>
      </div>
      <div class="pk-raise-area" id="raiseSliderArea">
        <div class="pk-raise-amount-row">
          <span class="pk-raise-amount" id="raiseAmountDisplay">100</span>
        </div>
        <div class="pk-raise-row">
          <input type="range" class="pk-raise-slider" id="raiseSlider" min="0" max="1000" value="100">
        </div>
        <div class="pk-raise-btns">
          <button class="pk-action-btn pk-btn-raise" onclick="confirmRaise()">레이즈 확인</button>
          <button class="pk-action-btn pk-btn-fold" onclick="cancelRaise()">취소</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MAFIA SETUP OVERLAY -->
<div class="mf-setup-overlay" id="mfSetupOverlay" style="display:none;">
  <div class="mf-setup-modal">
    <div class="mf-setup-header">
      <div class="mf-setup-title">마피아 설정</div>
      <div class="mf-setup-role-counter">
        <span id="mfSetupRoleCount">1</span>
        <span id="mfSetupPlayerCount">/ 4명</span>
      </div>
    </div>
    <div class="mf-setup-scroll" id="mfSetupContent">
      <!-- Role rows rendered dynamically by mfRenderSetup() -->
    </div>
    <div class="mf-setup-footer">
      <button class="mf-setup-btn cancel" onclick="mfCloseSetup()">취소</button>
      <button class="mf-setup-btn confirm" onclick="mfConfirmSetup()">확인</button>
    </div>
  </div>
</div>

<!-- BOMBSHOT SETUP OVERLAY -->
<div class="mf-setup-overlay" id="bsSetupOverlay" style="display:none;">
  <div class="mf-setup-modal" style="max-width:360px;">
    <div class="mf-setup-header">
      <div class="mf-setup-title">🍺 폭탄주 벌칙 설정</div>
      <div class="mf-setup-role-counter" style="font-size:12px;">
        룰렛: 폭탄주 2칸 / 벌칙 2칸 / 세이프 2칸
      </div>
    </div>
    <div class="mf-setup-scroll" style="padding:12px 16px;">
      <div style="margin-bottom:12px;">
        <div style="font-size:13px;font-weight:600;margin-bottom:8px;">🍸 바텐더 선택</div>
        <div style="display:flex;gap:8px;" id="bsBartenderSelect">
          <div class="bs-bartender-option selected" onclick="bsSelectBartender('default')" data-type="default">
            <div style="font-size:28px;">🤵</div>
            <div style="font-size:11px;">기본</div>
          </div>
          <div class="bs-bartender-option" onclick="bsSelectBartender('rabbit')" data-type="rabbit">
            <div style="font-size:28px;">🐰</div>
            <div style="font-size:11px;">토끼</div>
          </div>
        </div>
      </div>
      <div style="font-size:13px;color:var(--text-dim);margin-bottom:10px;">
        벌칙 칸(2칸)에 표시할 벌칙을 1~3개 설정하세요.<br>
        <span style="font-size:11px;opacity:0.7;">2칸에 랜덤 배치됩니다.</span>
      </div>
      <div id="bsPenaltyInputs">
        <div class="bs-penalty-row" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <span style="font-size:13px;min-width:50px;">벌칙 1</span>
          <input type="text" class="bs-penalty-input" id="bsPenalty1" value="원샷" maxlength="8" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid #444;background:#1a1a2e;color:#fff;font-size:14px;">
        </div>
        <div class="bs-penalty-row" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <span style="font-size:13px;min-width:50px;">벌칙 2</span>
          <input type="text" class="bs-penalty-input" id="bsPenalty2" value="" maxlength="8" placeholder="(선택)" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid #444;background:#1a1a2e;color:#fff;font-size:14px;">
        </div>
        <div class="bs-penalty-row" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
          <span style="font-size:13px;min-width:50px;">벌칙 3</span>
          <input type="text" class="bs-penalty-input" id="bsPenalty3" value="" maxlength="8" placeholder="(선택)" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid #444;background:#1a1a2e;color:#fff;font-size:14px;">
        </div>
      </div>
    </div>
    <div class="mf-setup-footer">
      <button class="mf-setup-btn cancel" onclick="bsCloseSetup()">취소</button>
      <button class="mf-setup-btn confirm" onclick="bsConfirmSetup()">확인</button>
    </div>
  </div>
</div>

<!-- MAFIA FULL VERSION -->
<div class="screen" id="mafiaGame">
  <!-- Top Bar -->
  <div class="mf-topbar">
    <div class="mf-topbar-left">
      <button class="mf-back-btn" onclick="mfLeaveGame()">✕</button>
      <div class="mf-phase-badge day" id="mfPhaseBadge">
        <span id="mfPhaseIcon">☀️</span>
        <span id="mfPhaseText">낮</span>
      </div>
    </div>
    <div class="mf-day-counter" id="mfDayCounter">1일차</div>
    <div class="mf-topbar-right">
      <button class="mf-roles-btn" onclick="mfToggleRolesPanel()">🎭</button>
      <div class="mf-timer-box" id="mfTimerBox">
        <span>⏱</span>
        <span id="mfTimer">180</span>
      </div>
    </div>
  </div>

  <!-- Roles Info Panel (toggle overlay) -->
  <div class="mf-roles-panel" id="mfRolesPanel" style="display:none;">
    <div class="mf-roles-panel-header">
      <span>🎭 이번 게임 직업 구성</span>
      <button class="mf-roles-panel-close" onclick="mfToggleRolesPanel()">✕</button>
    </div>
    <div class="mf-roles-panel-body" id="mfRolesPanelBody">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- Role Banner -->
  <div class="mf-role-banner team-citizen" id="mfRoleBanner">
    <div class="mf-role-emoji" id="mfRoleEmoji">👤</div>
    <div class="mf-role-info">
      <div class="mf-role-name citizen-color" id="mfRoleName">시민</div>
      <div class="mf-role-desc" id="mfRoleDesc">마피아를 찾아 투표하세요</div>
    </div>
  </div>

  <!-- Main Scrollable Content -->
  <div class="mf-content" id="mfContent">
    <!-- Dynamic content injected by JS:
         - Player grid
         - Night action panel
         - Chat panel (mafia/spy)
         - Vote status panel
         - Events list
         - Spectator mode
         - Lover reveal
         etc.
    -->
  </div>

  <!-- Bottom Action Area -->
  <div class="mf-action-area" id="mfActionArea">
    <div class="mf-message-box" id="mfMessageBox"></div>
    <div class="mf-btn-row" id="mfBtnRow">
      <!-- Buttons injected dynamically -->
    </div>
  </div>

  <!-- Result Overlay (hidden by default) -->
  <div class="mf-result-overlay" id="mfResultOverlay" style="display:none;">
    <div class="mf-result-title" id="mfResultTitle"></div>
    <div class="mf-result-subtitle" id="mfResultSubtitle"></div>
    <div class="mf-result-roles" id="mfResultRoles"></div>
    <button class="mf-result-close-btn" onclick="mfCloseResult()">로비로 돌아가기</button>
  </div>
</div>

<!-- TRUTH GAME -->
<div class="screen" id="truthGame">
  <!-- 상단 바 -->
  <div class="truth-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="truth-round-display">
      <span class="truth-round-badge" id="truthRoundBadge">ROUND 1</span>
    </div>
    <div class="truth-questioner-display" id="truthQuestionerDisplay">질문자: ---</div>
  </div>

  <!-- 메인 콘텐츠 영역 -->
  <div class="truth-content">

    <!-- Phase: question (질문자 입력) -->
    <div class="truth-phase-area" id="truthQuestionInputArea" style="display:none;">
      <div class="truth-your-turn-badge">✨ 당신의 차례입니다</div>
      <div class="truth-question-box">
        <textarea
          class="truth-textarea"
          id="truthQuestionInput"
          placeholder="질문을 입력하세요...&#10;예: 여기서 OO를 이성적으로 좋아하는 사람이 있다?"
          maxlength="200"
          rows="3"
        ></textarea>
        <div class="truth-char-count"><span id="truthCharCount">0</span>/200</div>
      </div>
      <button class="btn btn-primary truth-submit-btn" onclick="submitTruthQuestion()">
        📨 질문 제출
      </button>
    </div>

    <!-- Phase: question (대기 화면 - 질문자가 아닌 경우) -->
    <div class="truth-phase-area" id="truthWaitQuestionArea" style="display:none;">
      <div class="truth-waiting-icon">🤔</div>
      <div class="truth-waiting-text" id="truthWaitingText">질문을 기다리는 중...</div>
      <div class="truth-waiting-sub" id="truthWaitingSubText">질문자가 질문을 작성하고 있습니다</div>
      <div class="truth-dots-loader">
        <span></span><span></span><span></span>
      </div>
    </div>

    <!-- Phase: voting (질문 표시 + O/X 투표) -->
    <div class="truth-phase-area" id="truthVotingArea" style="display:none;">
      <div class="truth-question-display">
        <div class="truth-question-label">Q.</div>
        <div class="truth-question-text" id="truthQuestionText">질문 내용</div>
      </div>

      <!-- 투표 버튼 영역 -->
      <div class="truth-vote-buttons" id="truthVoteButtons">
        <button class="truth-vote-btn truth-vote-o" id="truthBtnO" onclick="castTruthVote('O')">
          <span class="truth-vote-symbol">O</span>
          <span class="truth-vote-label">예</span>
        </button>
        <button class="truth-vote-btn truth-vote-x" id="truthBtnX" onclick="castTruthVote('X')">
          <span class="truth-vote-symbol">✕</span>
          <span class="truth-vote-label">아니오</span>
        </button>
      </div>

      <!-- 투표 완료 후 대기 -->
      <div class="truth-vote-waiting" id="truthVoteWaiting" style="display:none;">
        <div class="truth-voted-badge" id="truthVotedBadge">✅ 투표 완료</div>
        <div class="truth-vote-progress">
          <div class="truth-progress-bar">
            <div class="truth-progress-fill" id="truthProgressFill" style="width:0%"></div>
          </div>
          <div class="truth-progress-text" id="truthProgressText">투표 중... (0/0명 완료)</div>
        </div>
      </div>
    </div>

    <!-- Phase: result (결과 표시) -->
    <div class="truth-phase-area" id="truthResultArea" style="display:none;">
      <div class="truth-question-display truth-question-display-small">
        <div class="truth-question-label">Q.</div>
        <div class="truth-question-text" id="truthResultQuestionText">질문 내용</div>
      </div>

      <div class="truth-result-container">
        <div class="truth-result-title">투표 결과</div>

        <!-- O 결과 -->
        <div class="truth-result-row">
          <div class="truth-result-icon truth-result-icon-o">O</div>
          <div class="truth-result-info">
            <div class="truth-result-count" id="truthResultOCount">0명</div>
            <div class="truth-result-dots" id="truthResultODots"></div>
          </div>
        </div>

        <!-- X 결과 -->
        <div class="truth-result-row">
          <div class="truth-result-icon truth-result-icon-x">✕</div>
          <div class="truth-result-info">
            <div class="truth-result-count" id="truthResultXCount">0명</div>
            <div class="truth-result-dots" id="truthResultXDots"></div>
          </div>
        </div>

        <!-- 총원 -->
        <div class="truth-result-total" id="truthResultTotal">총 0명 참여</div>
      </div>

      <!-- 다음 질문 버튼 (질문자 또는 호스트) -->
      <button class="btn btn-accent2 truth-next-btn" id="truthNextBtn" onclick="truthNextRound()" style="display:none;">
        ➡️ 다음 질문
      </button>
      <div class="truth-next-waiting" id="truthNextWaiting" style="display:none;">
        다음 질문을 기다리는 중...
      </div>
    </div>

  </div>

  <!-- 하단 플레이어 표시 -->
  <div class="truth-players-bar" id="truthPlayersBar"></div>
</div>

<!-- QUICK DRAW GAME -->
<div class="screen" id="quickDrawGame">
  <div class="qd-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="qd-title">🤠 서부 총잡이</div>
    <div class="qd-round">라운드 <span id="qdRoundNum">1</span></div>
  </div>

  <div class="qd-main-area">
    <div style="font-size:11px;color:#666;text-align:center;margin-bottom:4px;">총을 들고 기다리세요... 소리에 반응!</div>
    <div class="qd-tap-zone" id="qdTapZone" onclick="qdTap()">
      <div class="qd-status-text" id="qdStatusText">준비...</div>
      <div class="qd-reaction-time" id="qdReactionTime"></div>
    </div>
  </div>

  <div class="qd-rankings">
    <div class="qd-rankings-title">순위</div>
    <div class="qd-rankings-list" id="qdRankingsList"></div>
  </div>

  <button class="btn btn-primary qd-restart-btn" id="qdRestartBtn" style="display:none;" onclick="restartQuickDraw()">다시 하기</button>
</div>

<!-- RUSSIAN ROULETTE -->
<div class="screen" id="rouletteGame">
  <div class="roulette-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="roulette-title">🔫 러시안 룰렛</div>
    <div class="roulette-survivors">
      <span id="rouletteSurvivors">6</span>/<span id="rouletteTotalPlayers">6</span>
    </div>
  </div>

  <!-- 게임 시작 전 설정 (호스트만) -->
  <div class="roulette-setup" id="rouletteSetup" style="display:none;">
    <div class="setup-card">
      <div class="setup-label">총알 개수</div>
      <div class="setup-slider-row">
        <input type="range" class="setup-slider" id="bulletsSlider" min="1" max="3" value="1">
        <div class="setup-value" id="bulletsValue">1</div>
      </div>
    </div>
    <div class="setup-card">
      <div class="setup-label">실린더 칸 수</div>
      <div class="setup-slider-row">
        <input type="range" class="setup-slider" id="chambersSlider" min="6" max="8" value="6">
        <div class="setup-value" id="chambersValue">6</div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="confirmRouletteSetup()" style="margin-top:12px;">설정 완료 및 시작</button>
  </div>

  <!-- 실린더 시각화 (총 그립 느낌) -->
  <div class="cylinder-area" style="position:relative;">
    <div class="current-turn-display" id="currentTurnDisplay">
      <span id="currentTurnName">플레이어</span>의 차례
    </div>

    <!-- 총 실루엣 배경 -->
    <div style="position:relative;display:flex;flex-direction:column;align-items:center;">
      <div style="font-size:11px;color:#666;margin-bottom:4px;letter-spacing:1px;">세로로 잡고 조준하세요</div>
      <div class="cylinder-container" style="position:relative;">
        <div class="cylinder" id="cylinder">
          <!-- 동적 생성: 6~8개 칸 -->
        </div>
        <div class="cylinder-center">🎯</div>
      </div>
    </div>

    <div class="cylinder-info" id="cylinderInfo">
      실린더를 돌려주세요
    </div>
  </div>

  <!-- 생존자 리스트 -->
  <div class="survivors-list" id="survivorsList">
    <!-- 동적 생성 -->
  </div>

  <!-- 액션 버튼 (총 스타일) -->
  <div class="roulette-actions" id="rouletteActions">
    <button class="btn btn-secondary" id="spinBtn" onclick="spinCylinder()" style="display:none;font-size:18px;padding:16px 32px;">
      🔄 실린더 돌리기
    </button>
    <button class="btn btn-danger rr-trigger-btn" id="triggerBtn" onclick="pullTrigger()" style="display:none;font-size:22px;padding:20px 40px;border-radius:50%;width:100px;height:100px;box-shadow:0 0 30px rgba(255,0,0,0.4);animation:rr-pulse 1.5s ease-in-out infinite alternate;">
      🔫<br><span style="font-size:12px;">발사</span>
    </button>
    <button class="btn btn-primary" id="restartBtn" onclick="restartRoulette()" style="display:none;">
      🔁 다시 하기
    </button>
  </div>
</div>

<!-- 결과 플래시 오버레이 -->
<div class="roulette-flash" id="rouletteFlash">
  <div class="flash-content" id="flashContent">
    <div class="flash-icon" id="flashIcon">💥</div>
    <div class="flash-text" id="flashText">탕!</div>
  </div>
</div>

<!-- LOTTERY & ROULETTE GAME -->
<div class="screen" id="lotteryGame">
  <!-- Top Bar -->
  <div class="lottery-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">✕</button>
    <div class="lottery-title">🎰 뽑기 & 룰렛</div>
    <div style="width:40px;"></div>
  </div>

  <!-- Mode Tabs -->
  <div class="mode-tabs">
    <div class="mode-tab active" data-mode="lottery" onclick="switchLotteryMode('lottery')">
      📋 종이뽑기
    </div>
    <div class="mode-tab" data-mode="roulette" onclick="switchLotteryMode('roulette')">
      🎡 룰렛
    </div>
  </div>

  <!-- LOTTERY MODE -->
  <div class="lottery-mode-container" id="lotteryModeContainer">
    <!-- Setup Panel (Host Only) -->
    <div class="lottery-setup-panel" id="lotterySetupPanel" style="display:none;">
      <div class="setup-title">🎯 뽑기 항목 설정 (호스트만 가능)</div>
      <textarea class="lottery-items-input" id="lotteryItemsInput" placeholder="항목을 줄바꿈으로 구분하여 입력하세요&#10;예:&#10;당첨!&#10;꽝&#10;벌칙: 원샷&#10;벌칙: 춤추기&#10;행운!&#10;다시 뽑기"></textarea>
      <div class="setup-row">
        <label style="color:var(--text);font-size:14px;font-weight:700;">칸 개수:</label>
        <select class="grid-size-select" id="gridSizeSelect">
          <option value="4">4x4 (16칸)</option>
          <option value="5">5x5 (25칸)</option>
          <option value="6">6x6 (36칸)</option>
          <option value="8">8x8 (64칸)</option>
          <option value="10" selected>10x10 (100칸)</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="startLotteryGame()">🎮 뽑기 시작</button>
    </div>

    <!-- Lottery Grid -->
    <div class="lottery-grid-container" id="lotteryGridContainer" style="display:none;">
      <div class="lottery-status">
        <div class="status-text">🎯 칸을 터치하여 뽑기!</div>
        <div class="picked-count">뽑은 개수: <span id="pickedCount">0</span> / <span id="totalCount">100</span></div>
      </div>
      <div class="lottery-grid" id="lotteryGrid"></div>
    </div>

    <!-- My Result Display -->
    <div class="my-result-panel" id="myLotteryResult" style="display:none;">
      <div class="result-label">🎁 내가 뽑은 결과</div>
      <div class="result-list" id="myResultList"></div>
    </div>
  </div>

  <!-- ROULETTE MODE -->
  <div class="roulette-mode-container" id="rouletteModeContainer" style="display:none;">
    <!-- Setup Panel (Host Only) -->
    <div class="roulette-setup-panel" id="rouletteSetupPanel" style="display:none;">
      <div class="setup-title">🎡 룰렛 항목 설정 (호스트만 가능)</div>
      <textarea class="lottery-items-input" id="rouletteItemsInput" placeholder="룰렛 항목을 줄바꿈으로 구분 (2~12개)&#10;예:&#10;당첨!&#10;벌칙 1&#10;꽝&#10;원샷&#10;행운&#10;다시!"></textarea>
      <button class="btn btn-primary" onclick="startRouletteGame()">🎡 룰렛 시작</button>
    </div>

    <!-- Roulette Display -->
    <div class="roulette-display-container" id="rouletteDisplayContainer" style="display:none;">
      <div class="roulette-status">
        <div class="status-text">🎰 돌리기 버튼을 눌러주세요!</div>
      </div>

      <div class="roulette-wheel-container">
        <div class="roulette-pointer">▼</div>
        <div class="roulette-wheel" id="rouletteWheel">
          <canvas id="rouletteCanvas" width="300" height="300"></canvas>
        </div>
      </div>

      <button class="btn btn-primary roulette-spin-btn" id="rouletteSpinBtn" onclick="spinRoulette()">
        🎡 돌리기!
      </button>

      <!-- Result Display -->
      <div class="roulette-result-display" id="rouletteResultDisplay" style="display:none;">
        <div class="result-emoji">🎉</div>
        <div class="result-text" id="rouletteResultText">당첨!</div>
      </div>
    </div>
  </div>
</div>

<!-- ========================================= -->
<!-- UP DOWN GAME -->
<!-- ========================================= -->
<div class="screen" id="updownGame">
  <div class="ud-felt"></div>

  <div class="ud-content">
    <!-- Top bar: compact -->
    <div class="ud-top-bar">
      <div class="ud-turn-name" id="updownTurnName">플레이어</div>
      <div class="ud-deck-count" id="updownDeckCount">남은 카드: 52</div>
      <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    </div>

    <!-- Cards area: previous (small) + current (hero) -->
    <div class="ud-cards-area">
      <div class="ud-prev-slot" id="updownPrevCard">
        <div class="ud-card-label">이전</div>
        <div class="ud-prev-placeholder"></div>
      </div>

      <div class="ud-hero-slot" id="updownCurrentCard">
        <div class="ud-card-label">현재 카드</div>
        <div class="ud-hero-card ud-card-back">
          <div class="ud-hero-inner">
            <div class="ud-hero-back-pattern"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Result text -->
    <div class="ud-result" id="updownResult"></div>

    <!-- Bottom panel: buttons + bet + penalty -->
    <div class="ud-bottom-panel">
      <div class="ud-choice-buttons" id="updownChoiceButtons">
        <button class="ud-btn ud-btn-up" onclick="udChoice('up')">
          <span class="ud-btn-arrow">&#9650;</span>
          <span class="ud-btn-label">UP</span>
        </button>
        <button class="ud-btn ud-btn-down" onclick="udChoice('down')">
          <span class="ud-btn-label">DOWN</span>
          <span class="ud-btn-arrow">&#9660;</span>
        </button>
      </div>

      <div class="ud-bet-area">
        <input type="text" class="ud-bet-input" id="updownBetInput" placeholder="벌칙 내용 입력..." maxlength="30">
        <button class="ud-btn-bet" onclick="udAddBet()">+Bet</button>
      </div>

      <div class="ud-penalty-list" id="updownPenaltyList">
        <div class="ud-penalty-header">벌칙 목록</div>
        <div id="updownPenaltyItems"></div>
      </div>
    </div>
  </div>

  <!-- Special Card Areas -->
  <div class="ud-special-area ud-special-jq" id="updownSpecialJQ" style="display:none;">
    <div class="ud-special-title">흑기사 요청</div>
    <div class="ud-special-desc">다른 플레이어에게 벌칙을 대신 받을 것을 요청할 수 있습니다. 거절하면 나머지 모두가 벌칙!</div>
    <div class="ud-player-select" id="updownJQPlayerSelect"></div>
    <button class="ud-btn-special" onclick="udBlackKnight()">흑기사 요청</button>
  </div>

  <div class="ud-special-area ud-special-k" id="updownSpecialK" style="display:none;">
    <div class="ud-special-title">왕의 명령</div>
    <div class="ud-special-desc">3명에게 벌칙을 내릴 수 있습니다!</div>
    <div class="ud-player-select" id="updownKPlayerSelect"></div>
    <button class="ud-btn-special ud-btn-king" onclick="udKingPenalty()">왕 벌칙 부여</button>
  </div>

  <!-- Penalty Modal -->
  <div class="ud-penalty-modal" id="updownPenaltyModal">
    <div class="ud-penalty-content">
      <div class="ud-penalty-title">벌칙!</div>
      <div class="ud-penalty-text" id="updownPenaltyText">소주 1잔</div>
      <div class="ud-penalty-who" id="updownPenaltyWho">플레이어님의 차례</div>
      <button class="ud-btn-accept" onclick="udAcceptPenalty()">수행하기</button>
      <button class="ud-btn-reject" onclick="udRejectPenalty()">거절 (술 마시기)</button>
    </div>
  </div>

  <!-- Black Knight Request Modal -->
  <div class="ud-penalty-modal" id="updownBKModal">
    <div class="ud-penalty-content">
      <div class="ud-penalty-title">흑기사 요청</div>
      <div class="ud-penalty-text" id="updownBKText">벌칙 내용</div>
      <div class="ud-penalty-who" id="updownBKWho">누가 요청했습니다</div>
      <button class="ud-btn-accept" onclick="udAcceptBK()">수락 (대신 받기)</button>
      <button class="ud-btn-reject" onclick="udRejectBK()">거절 (나머지 모두 벌칙)</button>
    </div>
  </div>
</div>

<!-- ============================== -->
<!-- YAHTZEE GAME -->
<!-- ============================== -->
<div class="screen" id="yahtzeeGame">
  <div class="yahtzee-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <div class="yahtzee-turn-info">
      <div class="yahtzee-turn-text" id="yahTurnText">턴 1/13</div>
      <div class="yahtzee-current-player" id="yahCurrentPlayer">플레이어 차례</div>
    </div>
    <div class="yahtzee-rolls-left" id="yahRollsLeft">3 left</div>
  </div>

  <div class="yahtzee-players-bar" id="yahtzeePlayersBar">
  </div>

  <div class="yahtzee-dice-area">
    <!-- Three.js 3D viewport (left) -->
    <div id="yahtzeeThreeContainer">
      <canvas id="yahtzeeCanvas"></canvas>
      <div class="yahtzee-combo-label" id="yahtzeeComboLabel"></div>
    </div>

    <!-- Controls panel (right side) -->
    <div class="yahtzee-controls-panel">
      <div class="yahtzee-controls-title">DICE</div>
      <div class="yahtzee-hold-bar" id="yahtzeeHoldBar">
        <!-- Dynamically populated: clickable held-die elements -->
      </div>
      <div class="yahtzee-roll-hint">탭하여 선택/해제</div>
      <div class="yahtzee-rolls-indicator" id="yahtzeeRollsIndicator">
        <span class="roll-pip active"></span>
        <span class="roll-pip active"></span>
        <span class="roll-pip active"></span>
      </div>
      <button class="btn btn-primary yahtzee-roll-btn" id="yahtzeeRollBtn" onclick="yahRoll()">주사위 굴리기</button>
    </div>
  </div>

  <div class="yahtzee-scorecard-area">
    <div class="yahtzee-scorecard-title">점수표</div>
    <div class="yahtzee-scorecard" id="yahtzeeScorecard">
      <!-- Dynamically generated by renderYahtzeeScorecard() -->
    </div>
    <button class="btn yahtzee-score-btn" id="yahtzeeScoreBtn" onclick="yahScore()" style="display:none;">점수 확정</button>
  </div>

  <div class="yahtzee-game-over" id="yahtzeeGameOver" style="display:none;">
    <div class="yahtzee-final-scores">
      <div class="yahtzee-final-title">게임 종료!</div>
      <div class="yahtzee-rankings" id="yahtzeeRankings">
      </div>
    </div>
    <button class="btn btn-primary" onclick="restartCurrentGame()" style="max-width:280px;">🔄 다시하기</button>
    <button class="btn" onclick="closeYahtzeeGame()" style="max-width:280px;margin-top:8px;opacity:0.7;">대기실로</button>
  </div>
</div>


<!-- ===== E CARD GAME ===== -->
<div class="screen" id="ecardGame">
  <!-- Compact Header: combines top bar + score + role + opponent -->
  <div class="ecard-compact-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <button onclick="toggleHandRanking('ecard')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">규칙</button>
    <div class="ecard-header-round">R<span id="ecardRound">1</span>/5</div>
    <div class="ecard-header-score">
      <span class="ecard-hscore-emperor">&#128081;</span>
      <span class="ecard-hscore-val" id="ecardScoreEmperor">0</span>
      <span class="ecard-hscore-div">:</span>
      <span class="ecard-hscore-val" id="ecardScoreSlave">0</span>
      <span class="ecard-hscore-slave">&#9939;&#65039;</span>
    </div>
    <div class="ecard-header-role" id="ecardRoleBadge">
      <span id="ecardRoleIcon">&#128081;</span>
      <span id="ecardRoleName">황제</span>
    </div>
    <div class="ecard-header-opp">
      <div class="opponent-avatar" id="ecardOppAvatar" style="background: linear-gradient(135deg, #00e5ff, #00b8d4);">&#128526;</div>
      <span class="opponent-name" id="ecardOppName">상대</span>
      <span class="opponent-cards-count"><span id="ecardOppCardsCount">5</span>장</span>
      <div class="opponent-played-card" id="ecardOppPlayedCard"></div>
    </div>
  </div>

  <!-- Result / Status Text -->
  <div class="ecard-result-text" id="ecardResultText"></div>

  <!-- My Cards Area - takes most of the screen -->
  <div class="ecard-my-cards-area">
    <div class="my-cards-label">내 카드 (<span id="ecardMyCardsCount">5</span>장)</div>
    <div class="ecard-cards-hand" id="ecardMyCards"></div>
  </div>

  <!-- Battle Overlay (absolute positioned) -->
  <div class="ecard-battle-overlay" id="ecardBattleArea" style="display:none;">
    <div class="ecard-battle-inner">
      <div class="battle-card" id="ecardBattleOpp"></div>
      <div class="battle-vs">VS</div>
      <div class="battle-card" id="ecardBattleMy"></div>
    </div>
  </div>

  <!-- Betting Area -->
  <div class="ecard-bet-area" id="ecardBetArea" style="display:none;">
    <div class="bet-label">배팅 금액 제안</div>
    <div class="bet-controls">
      <input type="range" class="bet-slider" id="ecardBetSlider" min="10" max="500" value="100" step="10">
      <div class="bet-amount" id="ecardBetAmount">100</div>
    </div>
    <button class="btn btn-primary" id="ecardBetSubmit" onclick="ecardSubmitBet()">배팅 제안</button>
  </div>

  <!-- Bet Response -->
  <div class="ecard-bet-response" id="ecardBetResponse" style="display:none;">
    <div class="bet-proposal">상대방이 <span id="ecardBetProposed">100</span> 배팅을 제안했습니다</div>
    <div class="bet-buttons">
      <button class="btn btn-secondary" onclick="ecardRejectBet()">거절</button>
      <button class="btn btn-primary" onclick="ecardAcceptBet()">수락</button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="ecard-action-buttons" id="ecardActionButtons">
    <button class="btn btn-primary" id="ecardSubmitBtn" onclick="ecardSubmitCard()" disabled>카드 제출</button>
  </div>

  <!-- Waiting -->
  <div class="ecard-waiting" id="ecardWaiting" style="display:none;">
    <div class="spinner"></div>
    <div style="margin-top:8px;font-size:14px;color:var(--text-dim);" id="ecardWaitingText">상대방을 기다리는 중...</div>
  </div>
</div>

<!-- SUTDA GAME -->
<div class="screen" id="sutdaGame">
  <!-- 상단 바 -->
  <div class="sutda-top-bar">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <div class="sutda-title-area">
      <span class="sutda-title-text">장땡 섯다</span>
      <span class="sutda-pot-badge" id="sutdaPotBadge">0</span>
    </div>
    <button onclick="toggleHandRanking('sutda')" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:8px;padding:2px 8px;font-size:12px;cursor:pointer;">족보</button>
    <div class="sutda-my-balance" id="sutdaMyBalance">0</div>
  </div>

  <!-- 상대방 영역 -->
  <div class="sutda-opponents" id="sutdaOpponents"></div>

  <!-- 테이블 중앙 -->
  <div class="sutda-table">
    <div class="sutda-table-felt">
      <div class="sutda-pot-center">
        <div class="sutda-pot-label">판돈</div>
        <div class="sutda-pot-amount" id="sutdaPotAmount">0</div>
      </div>
      <div class="sutda-turn-indicator" id="sutdaTurnIndicator"></div>
    </div>
  </div>

  <!-- 내 패 영역 -->
  <div class="sutda-my-area">
    <div class="sutda-my-info">
      <div class="sutda-my-name" id="sutdaMyName">나</div>
      <div class="sutda-my-chips" id="sutdaMyChips">0</div>
    </div>
    <div class="sutda-my-cards" id="sutdaMyCards"></div>
    <div class="sutda-my-rank" id="sutdaMyRank"></div>
  </div>

  <!-- 세륙 선택 패널 -->
  <div class="sutda-seryuk-panel" id="sutdaSeryukPanel" style="display:none;">
    <div class="sutda-seryuk-title">세륙 (6+4) 선택</div>
    <div class="sutda-seryuk-desc">밀기: 10끗으로 계산 | 깽판: 패 재분배</div>
    <div class="sutda-seryuk-buttons">
      <button class="sutda-seryuk-btn sutda-seryuk-push" onclick="sutdaSeryukChoice('push')">
        <span class="sutda-seryuk-icon">&#x1F4AA;</span>
        <span>밀기</span>
        <span class="sutda-seryuk-sub">10끗</span>
      </button>
      <button class="sutda-seryuk-btn sutda-seryuk-chaos" onclick="sutdaSeryukChoice('chaos')">
        <span class="sutda-seryuk-icon">&#x1F300;</span>
        <span>깽판</span>
        <span class="sutda-seryuk-sub">패 재분배</span>
      </button>
    </div>
  </div>

  <!-- 배팅 버튼 -->
  <div class="sutda-action-bar" id="sutdaActionBar">
    <button class="sutda-bet-btn sutda-bet-10k" onclick="sutdaBet('raise',10000)" id="sutdaBtn10k">+1만</button>
    <button class="sutda-bet-btn sutda-bet-50k" onclick="sutdaBet('raise',50000)" id="sutdaBtn50k">+5만</button>
    <button class="sutda-bet-btn sutda-bet-100k" onclick="sutdaBet('raise',100000)" id="sutdaBtn100k">+10만</button>
    <button class="sutda-bet-btn sutda-bet-call" onclick="sutdaBet('call',0)" id="sutdaBtnCall">콜</button>
    <button class="sutda-bet-btn sutda-bet-die" onclick="sutdaBet('die',0)" id="sutdaBtnDie">다이</button>
    <button class="sutda-bet-btn sutda-bet-allin" onclick="sutdaBet('allin',0)" id="sutdaBtnAllin">올인</button>
  </div>

  <!-- 결과 오버레이 -->
  <div class="sutda-result-overlay" id="sutdaResultOverlay">
    <div class="sutda-result-box">
      <div class="sutda-result-title" id="sutdaResultTitle">승리!</div>
      <div class="sutda-result-winner" id="sutdaResultWinner"></div>
      <div class="sutda-result-rank" id="sutdaResultRank"></div>
      <div class="sutda-result-cards" id="sutdaResultCards"></div>
      <div class="sutda-result-pot" id="sutdaResultPot"></div>
      <div class="sutda-result-all-hands" id="sutdaResultAllHands"></div>
      <button class="btn btn-primary" onclick="closeSutdaResult()" style="margin-top:16px;">확인</button>
    </div>
  </div>
</div>


<!-- FORTRESS GAME -->
<div class="screen" id="fortressGame">
  <div class="fort-header">
    <button class="back-btn" style="font-size:18px;padding:4px;" onclick="leaveGame()">&#10005;</button>
    <div class="fort-header-info">
      <span class="fort-round-badge" id="fortRoundBadge">ROUND 1</span>
      <span class="fort-turn-name" id="fortTurnName">플레이어의 차례</span>
    </div>
    <div class="fort-wind-badge" id="fortWindBadge">
      <span id="fortWindArrow">→</span>
      <span id="fortWindValue">0</span>
    </div>
  </div>
  <div class="fort-players-bar" id="fortPlayersBar"></div>
  <div class="fort-canvas-container">
    <canvas id="fortressCanvas" width="800" height="500"></canvas>
  </div>
  <div class="fort-controls" id="fortControls">
    <div class="fort-ctrl-grp">
      <button class="fort-ctrl-btn" id="fortMoveLeft" ontouchstart="fortStartMove(-1)" ontouchend="fortStopMove()" onmousedown="fortStartMove(-1)" onmouseup="fortStopMove()" onmouseleave="fortStopMove()">◀</button>
      <div class="fort-fuel-mini"><div class="fort-fuel-fill" id="fortFuelFill" style="width:100%"></div></div>
      <button class="fort-ctrl-btn" id="fortMoveRight" ontouchstart="fortStartMove(1)" ontouchend="fortStopMove()" onmousedown="fortStartMove(1)" onmouseup="fortStopMove()" onmouseleave="fortStopMove()">▶</button>
    </div>
    <div class="fort-ctrl-sep"></div>
    <div class="fort-ctrl-grp">
      <button class="fort-ctrl-btn" ontouchstart="fortAngleStart(-1)" ontouchend="fortAngleStop()" onmousedown="fortAngleStart(-1)" onmouseup="fortAngleStop()" onmouseleave="fortAngleStop()">‹</button>
      <div class="fort-val"><span class="fort-val-lbl">각도</span><span id="fortAngleValue" class="fort-val-num">45</span></div>
      <button class="fort-ctrl-btn" ontouchstart="fortAngleStart(1)" ontouchend="fortAngleStop()" onmousedown="fortAngleStart(1)" onmouseup="fortAngleStop()" onmouseleave="fortAngleStop()">›</button>
    </div>
    <div class="fort-ctrl-grp">
      <button class="fort-ctrl-btn" ontouchstart="fortPowerStart(-1)" ontouchend="fortPowerStop()" onmousedown="fortPowerStart(-1)" onmouseup="fortPowerStop()" onmouseleave="fortPowerStop()">‹</button>
      <div class="fort-val"><span class="fort-val-lbl">파워</span><span id="fortPowerValue" class="fort-val-num">50</span></div>
      <button class="fort-ctrl-btn" ontouchstart="fortPowerStart(1)" ontouchend="fortPowerStop()" onmousedown="fortPowerStart(1)" onmouseup="fortPowerStop()" onmouseleave="fortPowerStop()">›</button>
    </div>
    <div id="fortChargeGauge" style="display:none;position:relative;width:100%;height:14px;background:#222;border-radius:7px;overflow:hidden;margin-bottom:4px;">
      <div class="fort-charge-fill" style="height:100%;width:0%;border-radius:7px;transition:width 0.04s linear;"></div>
      <span class="fort-charge-label" style="position:absolute;width:100%;text-align:center;font-size:10px;font-weight:700;color:#fff;line-height:14px;top:0;left:0;"></span>
    </div>
    <button class="fort-fire-btn" id="fortFireBtn"
      ontouchstart="fortFireChargeStart(event)" ontouchend="fortFireChargeEnd(event)" ontouchcancel="fortFireChargeEnd(event)"
      onmousedown="fortFireChargeStart(event)" onmouseup="fortFireChargeEnd(event)" onmouseleave="fortFireChargeEnd(event)">꾹 눌러 발사</button>
  </div>
  <div class="fort-gameover" id="fortGameOver" style="display:none;">
    <div class="fort-gameover-box">
      <div class="fort-gameover-title" id="fortGameOverTitle">게임 종료!</div>
      <div class="fort-rankings" id="fortRankings"></div>
      <button class="btn btn-primary" onclick="restartCurrentGame()" style="max-width:280px;">🔄 다시하기</button>
      <button class="btn" onclick="closeFortressGame()" style="max-width:280px;margin-top:8px;opacity:0.7;">대기실로</button>
    </div>
  </div>
</div>

<!-- BOMB SHOT BLUFF -->
<div class="screen" id="bombshotGame">
  <div class="bs-top-bar">
    <button class="back-btn" onclick="closeBombShotGame()">←</button>
    <div class="bs-drink-badge beer" id="bsDrinkBadge">
      <span class="bs-drink-icon" id="bsDrinkIcon">🍺</span>
      <span id="bsDrinkName">지정: 맥주</span>
    </div>
    <div class="bs-glass-info">🥃 <span id="bsGlassCount">누적: 0장</span></div>
  </div>

  <div class="bs-opponents" id="bsOpponents"></div>

  <div class="bs-last-submit" id="bsLastSubmit" style="display:none;"></div>

  <div class="bs-my-turn-banner" id="bsMyTurnBanner"></div>

  <div class="bs-canvas-wrap">
    <canvas id="bsCanvas"></canvas>
  </div>

  <div class="bs-roulette-status-wrap" id="bsRouletteStatus" style="display:none;"></div>

  <div class="bs-joker-guide">
    <span class="bs-joker-icon">💧</span>
    <span>탄산수 = 조커 (어떤 술로든 사용 가능)</span>
  </div>

  <div class="bs-hand-area">
    <div class="bs-hand" id="bsMyHand"></div>
  </div>

  <div id="bsMyRoulette" style="text-align:center;padding:2px 0;"></div>

  <div class="bs-status" id="bsStatus"></div>

  <div class="bs-action-bar">
    <button class="bs-btn bs-btn-submit" id="bsSubmitBtn" onclick="bsSubmitCards()" disabled>
      카드 제출 (<span id="bsSelectedCount">0</span>장)
    </button>
    <button class="bs-btn bs-btn-liar" id="bsLiarBtn" onclick="bsCallLiar()" disabled>
      🚨 라이어!
    </button>
  </div>

  <div class="bs-reveal" id="bsReveal" style="display:none;">
    <div class="bs-reveal-box">
      <div class="bs-reveal-title" id="bsRevealTitle">카드 공개!</div>
      <div class="bs-reveal-cards" id="bsRevealCards"></div>
      <div class="bs-reveal-result" id="bsRevealResult"></div>
    </div>
  </div>

  <div class="bs-gameover" id="bsGameOver" style="display:none;">
    <div class="bs-gameover-box">
      <div class="bs-gameover-title" id="bsGameOverTitle">게임 종료!</div>
      <div class="bs-rankings" id="bsRankings"></div>
      <button class="btn btn-primary" onclick="restartCurrentGame()" style="max-width:280px;">🔄 다시하기</button>
      <button class="btn" onclick="closeBombShotGame()" style="max-width:280px;margin-top:8px;opacity:0.7;">대기실로</button>
    </div>
  </div>
</div>

<!-- INFINITE STAIRS -->
<div class="screen" id="stairsGame">
  <!-- HUD -->
  <div class="st-hud">
    <div class="st-score-box">
      <div class="st-score-label">SCORE</div>
      <div class="st-score-value" id="stScore">0</div>
    </div>
    <div class="st-hud-right">
      <button class="back-btn" style="font-size:16px;padding:4px;" onclick="leaveGame()">&#10005;</button>
      <div class="st-combo" id="stCombo">🔥 x1.5</div>
      <div class="st-step-display" id="stStep">0층</div>
    </div>
  </div>

  <!-- Stamina Bar -->
  <div class="st-stamina-wrap">
    <div class="st-stamina-outer">
      <div class="st-stamina-fill" id="stStaminaFill"></div>
    </div>
    <div class="st-stamina-info">
      <span>STAMINA</span>
      <span id="stStaminaText">100%</span>
    </div>
  </div>

  <!-- Players bar (multiplayer) -->
  <div class="st-players-bar" id="stPlayersBar"></div>

  <!-- Game Canvas -->
  <div class="st-canvas-wrap">
    <canvas id="stCanvas"></canvas>
    <div class="st-vignette" id="stVignette"></div>
  </div>

  <!-- Countdown Overlay -->
  <div class="st-countdown-overlay" id="stCountdownOverlay" style="display:none;">
    <div class="st-countdown-num" id="stCountdownNum">3</div>
  </div>

  <!-- Death Overlay -->
  <div class="st-death-overlay" id="stDeathOverlay" style="display:none;">
    <div class="st-death-title">GAME OVER</div>
    <div class="st-death-reason" id="stDeathReason">추락!</div>
    <div class="st-death-score-box">
      <div class="st-death-score" id="stDeathScore">0</div>
      <div class="st-death-score-label">FINAL SCORE</div>
    </div>
    <div class="st-death-stats">
      <div class="st-death-stat"><div class="st-death-stat-val" id="stDeathStep">0층</div><div class="st-death-stat-label">STEP</div></div>
      <div class="st-death-stat"><div class="st-death-stat-val" id="stDeathBest">0</div><div class="st-death-stat-label">BEST</div></div>
      <div class="st-death-stat"><div class="st-death-stat-val" id="stDeathCombo">x0</div><div class="st-death-stat-label">MAX COMBO</div></div>
    </div>
    <div class="st-death-waiting" id="stDeathWaiting" style="display:none;">다른 플레이어를 기다리는 중...</div>
  </div>

  <!-- Results Overlay -->
  <div class="st-results-overlay" id="stResultsOverlay" style="display:none;">
    <div class="st-results-title">🏆 결과</div>
    <div class="st-results-list" id="stResultsList"></div>
    <button class="btn btn-primary st-results-btn" onclick="restartCurrentGame()">🔄 다시하기</button>
    <button class="btn st-results-btn" onclick="closeStairsGame()" style="margin-top:8px;opacity:0.7;">대기실로</button>
  </div>

  <!-- Controls -->
  <div class="st-controls" id="stControls" style="display:none;">
    <button class="st-btn st-btn-left" onclick="stTapLeft()">
      <span class="st-btn-arrow">←</span> 왼쪽
      <span class="st-btn-sub">LEFT / X</span>
    </button>
    <button class="st-btn st-btn-right" onclick="stTapRight()">
      오른쪽 <span class="st-btn-arrow">→</span>
      <span class="st-btn-sub">RIGHT / Z</span>
    </button>
  </div>
</div>

<!-- JEWEL MATCH (보석맞추기) -->
<div class="screen" id="jewelGame">
  <!-- Title / Mode Select Overlay -->
  <div class="jwl-title-overlay" style="display:flex;">
    <div class="jwl-title-name">보석<br>맞추기</div>
    <div class="jwl-title-sub">JEWEL MATCH</div>
    <div class="jwl-title-gems">
      <div class="jwl-title-gem jwl-gem-0" style="animation-delay:0s;">💎</div>
      <div class="jwl-title-gem jwl-gem-1" style="animation-delay:.3s;">💎</div>
      <div class="jwl-title-gem jwl-gem-2" style="animation-delay:.6s;">💎</div>
      <div class="jwl-title-gem jwl-gem-3" style="animation-delay:.9s;">💎</div>
      <div class="jwl-title-gem jwl-gem-4" style="animation-delay:1.2s;">💎</div>
    </div>
    <button class="jwl-title-btn jwl-title-btn-primary" onclick="jwlStartMode('classic')">CLASSIC</button>
    <button class="jwl-title-btn jwl-title-btn-secondary" onclick="jwlStartMode('moves')">MOVES (30)</button>
    <button class="jwl-title-btn jwl-title-btn-secondary" onclick="jwlStartMode('timed')">TIMED (2:00)</button>
    <button class="jwl-title-btn jwl-title-btn-secondary" onclick="jwlStartMode('zen')">ZEN ∞</button>
  </div>

  <!-- HUD -->
  <div class="jwl-hud">
    <div class="jwl-hud-left">
      <div class="jwl-score-label">SCORE</div>
      <div class="jwl-score-value" id="jwlScoreValue">0</div>
    </div>
    <div class="jwl-hud-center">
      <div class="jwl-combo-badge" id="jwlComboBadge">⛓️ x1</div>
    </div>
    <div class="jwl-hud-right">
      <button class="jwl-pause-btn" onclick="jwlPause()">⏸</button>
    </div>
  </div>

  <!-- Level Progress -->
  <div class="jwl-progress-bar">
    <div class="jwl-progress-labels">
      <span id="jwlLevelLabel">LEVEL 1</span>
      <span id="jwlProgressPct">0%</span>
    </div>
    <div class="jwl-progress-track">
      <div class="jwl-progress-fill" id="jwlProgressFill"></div>
    </div>
  </div>

  <!-- Mode Info -->
  <div class="jwl-mode-info" id="jwlModeInfo">
    <span class="jwl-mode-badge jwl-mode-classic">CLASSIC</span>
  </div>

  <!-- Timer Bar (Timed mode) -->
  <div class="jwl-timer-bar" id="jwlTimerBar" style="display:none;">
    <div class="jwl-timer-labels"><span>TIME</span><span id="jwlTimerText">2:00</span></div>
    <div class="jwl-timer-track">
      <div class="jwl-timer-fill" id="jwlTimerFill"></div>
    </div>
  </div>

  <!-- 8x8 Grid -->
  <div class="jwl-grid-area">
    <!-- Gem Jar -->
    <div class="jwl-jar-wrap" id="jwlJarWrap" style="display:none;">
      <div class="jwl-jar">
        <div class="jwl-jar-fill" id="jwlJarFill"></div>
        <div class="jwl-jar-gems" id="jwlJarGems"></div>
      </div>
      <div class="jwl-jar-label" id="jwlJarLabel">0</div>
    </div>
    <div class="jwl-grid-container">
      <div class="jwl-grid" id="jwlGrid"></div>
    </div>
  </div>

  <!-- Bottom -->
  <div class="jwl-bottom">
    <div class="jwl-hint-btn" onclick="jwlManualHint()">💡 HINT</div>
  </div>

  <!-- Game Over Overlay -->
  <div class="jwl-gameover-overlay">
    <div class="jwl-go-title">WELL DONE!</div>
    <div class="jwl-go-sub">레벨 1 · CLASSIC</div>
    <div class="jwl-go-new-best">⭐ NEW BEST! ⭐</div>
    <div class="jwl-go-score-box">
      <div class="jwl-go-score">0</div>
      <div class="jwl-go-score-label">FINAL SCORE</div>
    </div>
    <div class="jwl-go-stats">
      <div class="jwl-go-stat"><div class="jwl-go-stat-val">🏆 0</div><div class="jwl-go-stat-label">BEST</div></div>
      <div class="jwl-go-stat"><div class="jwl-go-stat-val">⛓️ x0</div><div class="jwl-go-stat-label">MAX COMBO</div></div>
      <div class="jwl-go-stat"><div class="jwl-go-stat-val">💎 0</div><div class="jwl-go-stat-label">GEMS</div></div>
    </div>
    <button class="jwl-go-btn jwl-go-btn-retry" onclick="jwlRetry()">🔄 RETRY</button>
    <button class="jwl-go-btn jwl-go-btn-home" onclick="jwlHome()">🏠 HOME</button>
  </div>

  <!-- Pause Overlay -->
  <div class="jwl-pause-overlay">
    <div class="jwl-pause-title">⏸ PAUSED</div>
    <button class="jwl-pause-btn jwl-pause-resume" onclick="jwlResume()">▶ RESUME</button>
    <button class="jwl-pause-btn jwl-pause-quit" onclick="jwlQuit()">🏠 QUIT</button>
  </div>
</div>

<!-- TETRIS -->
<div class="screen" id="tetrisGame">
  <!-- HUD -->
  <div class="tet-hud">
    <div class="tet-hud-item">
      <div class="tet-hud-label">SCORE</div>
      <div class="tet-hud-value" id="tetScoreValue">0</div>
    </div>
    <div class="tet-hud-item">
      <span class="tet-mode-badge" id="tetModeBadge">MARATHON</span>
    </div>
    <div class="tet-hud-item">
      <div class="tet-hud-label">LEVEL</div>
      <div class="tet-hud-value" id="tetLevelValue">1</div>
    </div>
    <button class="tet-hud-close" onclick="tetPause()">⏸</button>
  </div>

  <!-- Players bar (multiplayer) -->
  <div class="tet-players-bar" id="tetPlayersBar"></div>

  <!-- Play area -->
  <div class="tet-play-area">
    <!-- Hold side -->
    <div class="tet-side">
      <div class="tet-side-box">
        <div class="tet-side-label">HOLD</div>
        <canvas class="tet-side-canvas" id="tetHoldCanvas" width="48" height="32"></canvas>
      </div>
      <div class="tet-side-info">
        LINES
        <span class="tet-side-info-val" id="tetLinesValue">0</span>
      </div>
      <div class="tet-side-info">
        TIME
        <span class="tet-side-info-val" id="tetTimerValue">0:00.00</span>
      </div>
      <div class="tet-timer-bar" id="tetTimerBar" style="display:none;">
        <div class="tet-timer-bar-track">
          <div class="tet-timer-bar-fill" id="tetTimerFill"></div>
        </div>
      </div>
    </div>

    <!-- Board -->
    <div class="tet-board-wrap">
      <canvas class="tet-board-canvas" id="tetCanvas"></canvas>
    </div>

    <!-- Next side -->
    <div class="tet-side">
      <div class="tet-side-box">
        <div class="tet-side-label">NEXT</div>
        <canvas class="tet-side-canvas" id="tetNextCanvas0" width="48" height="32"></canvas>
      </div>
      <div class="tet-side-box">
        <canvas class="tet-side-canvas" id="tetNextCanvas1" width="48" height="32"></canvas>
      </div>
      <div class="tet-side-box">
        <canvas class="tet-side-canvas" id="tetNextCanvas2" width="48" height="32"></canvas>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="tet-controls">
    <div class="tet-dpad">
      <div class="tet-dpad-empty"></div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('down');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchDown()">&#9660;</div>
      <div class="tet-dpad-empty"></div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('left');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchLeft()">&#9664;</div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('down');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchDown()">&#9660;</div>
      <div class="tet-dpad-btn" ontouchstart="tetTouchStart('right');event.preventDefault();" ontouchend="tetTouchEnd()" onmousedown="tetTouchRight()">&#9654;</div>
    </div>
    <div class="tet-action-btns">
      <div class="tet-act tet-act-hold" onclick="tetTouchHold()">HOLD</div>
      <div class="tet-act tet-act-rotate" onclick="tetTouchRotate()">&#8635;</div>
      <div class="tet-act tet-act-drop" onclick="tetTouchHardDrop()">&#11015;</div>
    </div>
  </div>

  <!-- Mode Select Overlay -->
  <div class="tet-mode-overlay" id="tetModeOverlay" style="display:flex;">
    <div class="tet-mode-title">TETRIS</div>
    <div class="tet-mode-sub">BLOCK PUZZLE</div>
    <div class="tet-mode-list">
      <button class="tet-mode-btn tet-mode-primary" onclick="tetSelectMode('marathon')">&#127956;&#65039; MARATHON</button>
      <button class="tet-mode-btn tet-mode-sec" onclick="tetSelectMode('sprint')">&#9889; SPRINT (40L)</button>
      <button class="tet-mode-btn tet-mode-sec" onclick="tetSelectMode('ultra')">&#9201;&#65039; ULTRA (2:00)</button>
      <button class="tet-mode-btn tet-mode-sec" onclick="tetSelectMode('endless')">&#8734; ENDLESS</button>
    </div>
    <button class="tet-mode-back" onclick="tetGoHome()">&#8592; 나가기</button>
  </div>

  <!-- Countdown Overlay -->
  <div class="tet-countdown" id="tetCountdown" style="display:none;">
    <div class="tet-countdown-num" id="tetCountdownNum">3</div>
  </div>

  <!-- Pause Overlay -->
  <div class="tet-pause" id="tetPause" style="display:none;">
    <div class="tet-pause-title">PAUSED</div>
    <button class="tet-pause-btn tet-pause-resume" onclick="tetResume()">&#9654;&#65039; 계속하기</button>
    <button class="tet-pause-btn tet-pause-quit" onclick="tetGoHome()">&#127968; 나가기</button>
  </div>

  <!-- Game Over Overlay -->
  <div class="tet-gameover" id="tetGameOver" style="display:none;">
    <div class="tet-go-title" id="tetGoTitle">GAME OVER</div>
    <div class="tet-go-subtitle" id="tetGoSubtitle">레벨 5에서 종료</div>
    <div class="tet-go-score-box">
      <div class="tet-go-score" id="tetGoScore">0</div>
      <div class="tet-go-score-label">FINAL SCORE</div>
    </div>
    <div class="tet-go-stats">
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoLevel">Lv.1</div><div class="tet-go-stat-label">LEVEL</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoLines">0</div><div class="tet-go-stat-label">LINES</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoCombo">x0</div><div class="tet-go-stat-label">MAX COMBO</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoTetris">0</div><div class="tet-go-stat-label">TETRIS</div></div>
      <div class="tet-go-stat"><div class="tet-go-stat-val" id="tetGoTime">0:00</div><div class="tet-go-stat-label">TIME</div></div>
    </div>
    <div class="tet-go-best" id="tetGoBest" style="display:none;"></div>
    <button class="tet-go-btn tet-go-retry" onclick="tetRetry()">&#128260; RETRY</button>
    <button class="tet-go-btn tet-go-home" onclick="tetGoHome()">&#127968; HOME</button>
  </div>
</div>

<!-- COLOR CHAIN -->
<div class="screen" id="colorchainGame">
  <!-- HUD -->
  <div class="cc-hud">
    <div class="cc-hud-item">
      <div class="cc-hud-label">SCORE</div>
      <div class="cc-hud-value" id="ccScoreValue">0</div>
    </div>
    <div class="cc-hud-item">
      <div class="cc-hud-label">TURN</div>
      <div class="cc-hud-value" id="ccTurnValue">0</div>
    </div>
    <div class="cc-hud-item">
      <div class="cc-combo" id="ccComboDisplay"></div>
    </div>
    <button class="cc-hud-help" onclick="ccShowRulebook()">?</button>
    <button class="cc-hud-close" onclick="ccPause()">&#9208;</button>
  </div>

  <!-- Players bar -->
  <div class="cc-players-bar" id="ccPlayersBar"></div>

  <!-- Play area -->
  <div class="cc-play-area">
    <!-- Hold side -->
    <div class="cc-side">
      <div class="cc-side-box">
        <div class="cc-side-label">HOLD</div>
        <canvas class="cc-side-canvas" id="ccHoldCanvas" width="60" height="60"></canvas>
      </div>
      <div class="cc-side-info">
        HEAT
        <div class="cc-heat-bar"><div class="cc-heat-fill" id="ccHeatFill" style="width:0%"></div></div>
      </div>
    </div>

    <!-- Board -->
    <div class="cc-board-wrap">
      <canvas class="cc-board-canvas" id="ccCanvas"></canvas>
    </div>

    <!-- Next side -->
    <div class="cc-side">
      <div class="cc-side-box">
        <div class="cc-side-label">NEXT</div>
        <canvas class="cc-side-canvas" id="ccNextCanvas" width="60" height="60"></canvas>
      </div>
    </div>
  </div>

  <!-- Controls hint (desktop) -->
  <div class="cc-controls-hint">&larr; &rarr; 이동 | Z X 회전 | &darr; 소프트드롭 | Space 하드드롭 | C 홀드</div>

  <!-- Touch controls (mobile) -->
  <div class="cc-controls">
    <div class="cc-ctrl-row">
      <div class="cc-btn" data-action="left">&#9664;</div>
      <div class="cc-btn" data-action="rotL">&#8634;</div>
      <div class="cc-btn" data-action="down">&#9660;</div>
      <div class="cc-btn" data-action="rotR">&#8635;</div>
      <div class="cc-btn" data-action="right">&#9654;</div>
    </div>
    <div class="cc-ctrl-row">
      <div class="cc-btn cc-btn-wide" data-action="drop">DROP</div>
      <div class="cc-btn cc-btn-wide" data-action="hold">HOLD</div>
    </div>
  </div>

  <!-- Countdown -->
  <div class="cc-countdown" id="ccCountdown" style="display:none;">
    <div class="cc-countdown-num" id="ccCountdownNum">3</div>
  </div>

  <!-- Pause -->
  <div class="cc-pause-overlay" id="ccPauseOverlay" style="display:none;">
    <div class="cc-pause-title">PAUSED</div>
    <button class="cc-pause-btn cc-pause-rulebook" onclick="ccShowRulebook()">&#128214; 룰북 보기</button>
    <button class="cc-pause-btn cc-pause-resume" onclick="ccResume()">&#9654;&#65039; 계속하기</button>
    <button class="cc-pause-btn cc-pause-quit" onclick="ccGoHome()">&#127968; 나가기</button>
  </div>

  <!-- Rulebook -->
  <div class="cc-rulebook" id="ccRulebook" style="display:none;">
    <div class="cc-rulebook-inner">
      <div class="cc-rb-title">RULEBOOK</div>

      <div class="cc-rb-section">조작법</div>
      <div class="cc-rb-text">
        <b>키보드</b><br>
        <span class="cc-rb-key">&larr;</span> <span class="cc-rb-key">&rarr;</span> 이동 &nbsp;
        <span class="cc-rb-key">Z</span> <span class="cc-rb-key">X</span> 회전<br>
        <span class="cc-rb-key">&darr;</span> 소프트드롭 &nbsp;
        <span class="cc-rb-key">Space</span> 하드드롭<br>
        <span class="cc-rb-key">C</span> 홀드
      </div>
      <div class="cc-rb-text">
        <b>모바일</b><br>
        화면 하단 터치 버튼으로 조작
      </div>

      <div class="cc-rb-section">목표</div>
      <div class="cc-rb-text">
        블록을 합쳐 레벨을 올리고 폭발시켜 점수를 획득하세요. 블록이 천장에 닿으면 게임 오버!
      </div>

      <div class="cc-rb-section">합체 (Merge)</div>
      <div class="cc-rb-text">
        같은 레벨의 블록이 상하좌우로 인접하면 자동으로 합체되며 레벨이 1 올라갑니다.
      </div>

      <div class="cc-rb-section">폭발</div>
      <div class="cc-rb-text">
        레벨 5를 초과(6+)하면 폭발! 주변 블록의 레벨이 1 올라가고 인접한 정크 블록이 제거됩니다.
      </div>

      <div class="cc-rb-section">체인 콤보</div>
      <div class="cc-rb-text">
        폭발이 연쇄적으로 일어나면 콤보! 콤보가 높을수록 점수 배율이 증가합니다.
      </div>

      <div class="cc-rb-section">히트 (Heat)</div>
      <div class="cc-rb-text">
        10턴마다 보드 위의 모든 블록 레벨이 1 올라갑니다. HEAT 게이지로 타이밍을 확인하세요.
      </div>

      <div class="cc-rb-section">정크 블록</div>
      <div class="cc-rb-text">
        일정 턴마다 경고 표시 후 회색 정크 블록이 등장합니다. 정크는 합체가 불가능하며 인접한 폭발로만 제거할 수 있습니다.
      </div>

      <div class="cc-rb-section">홀드</div>
      <div class="cc-rb-text">
        <span class="cc-rb-key">C</span> 키(또는 HOLD 버튼)로 현재 피스를 보관하고 나중에 교환할 수 있습니다. 한 턴에 한 번만 사용 가능합니다.
      </div>

      <button class="cc-rb-close" onclick="ccCloseRulebook()">닫기</button>
    </div>
  </div>

  <!-- Game Over -->
  <div class="cc-gameover" id="ccGameOver" style="display:none;">
    <div class="cc-go-title">GAME OVER</div>
    <div class="cc-go-score-box">
      <div class="cc-go-score" id="ccGoScore">0</div>
      <div class="cc-go-score-label">FINAL SCORE</div>
    </div>
    <div class="cc-go-stats">
      <div class="cc-go-stat">
        <div class="cc-go-stat-val" id="ccGoTurn">0</div>
        <div class="cc-go-stat-label">TURNS</div>
      </div>
      <div class="cc-go-stat">
        <div class="cc-go-stat-val" id="ccGoBest">0</div>
        <div class="cc-go-stat-label">BEST</div>
      </div>
    </div>
    <button class="cc-go-btn cc-go-retry" onclick="ccRetry()">&#128260; RETRY</button>
    <button class="cc-go-btn cc-go-home" onclick="ccGoHome()">&#127968; HOME</button>
  </div>
</div>

<!-- RESULT -->
<div class="result-overlay" id="resultOverlay">
  <div class="result-title" id="resultTitle">🏆 승리!</div>
  <div class="winner-info">
    <div id="winnerName" style="font-size:20px;font-weight:900;"></div>
    <div class="result-cards" id="resultCards"></div>
    <div class="result-hand" id="resultHand"></div>
    <div class="result-pot" id="resultPot"></div>
  </div>
  <button class="btn btn-primary" onclick="closeResult()" style="max-width:280px;">다음 라운드</button>
</div>

<!-- Hand Ranking Overlay -->
<div id="handRankingOverlay" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.85);overflow-y:auto;padding:20px;" onclick="this.style.display='none'">
  <div style="max-width:360px;margin:0 auto;background:var(--bg-card,#14142a);border-radius:16px;padding:20px;" onclick="event.stopPropagation()">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div style="font-size:18px;font-weight:900;color:#fff;" id="handRankingTitle">족보</div>
      <button onclick="document.getElementById('handRankingOverlay').style.display='none'" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">✕</button>
    </div>
    <div id="handRankingContent" style="font-size:13px;color:#ccc;line-height:1.8;"></div>
  </div>
</div>

<!-- QR Code library -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="js/core.js?v=3"></script>
<script src="js/games/poker.js?v=2"></script>
<script src="js/games/mafia.js?v=4"></script>
<script src="js/games/truth.js?v=2"></script>
<script src="js/games/quickdraw.js?v=2"></script>
<script src="js/games/roulette.js?v=2"></script>
<script src="js/games/lottery.js?v=2"></script>
<script src="js/games/updown.js?v=2"></script>
<script src="js/games/yahtzee.js?v=2"></script>
<script src="js/games/ecard.js?v=2"></script>
<script src="js/games/sutda.js?v=2"></script>
<script src="js/games/fortress.js?v=14"></script>
<script src="js/games/bombshot.js?v=1"></script>
<script src="js/games/stairs.js?v=1"></script>
<script src="js/games/tetris.js?v=1"></script>
<script src="js/games/jewel.js?v=1"></script>
<script src="js/games/colorchain.js?v=1"></script>
<script src="js/ai.js?v=3"></script>
<!-- Three.js + yahtzee-three.js: 야추 게임 시작 시 동적 로딩 (loadYahtzeeThree) -->
</body>
</html>
